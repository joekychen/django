<!DOCTYPE html>
<html><head><title>joekychen/django » tests › runtests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>runtests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">contrib</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>databrowse is deprecated, but we still want to run its tests</p></td><td class="code"><div class="highlight"><pre><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">,</span> <span class="s">&quot;The Databrowse contrib app is deprecated&quot;</span><span class="p">,</span>
                        <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="s">&#39;django.contrib.databrowse&#39;</span><span class="p">)</span>

<span class="n">CONTRIB_DIR_NAME</span> <span class="o">=</span> <span class="s">&#39;django.contrib&#39;</span>
<span class="n">MODEL_TESTS_DIR_NAME</span> <span class="o">=</span> <span class="s">&#39;modeltests&#39;</span>
<span class="n">REGRESSION_TESTS_DIR_NAME</span> <span class="o">=</span> <span class="s">&#39;regressiontests&#39;</span>

<span class="n">TEST_TEMPLATE_DIR</span> <span class="o">=</span> <span class="s">&#39;templates&#39;</span>

<span class="n">RUNTESTS_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">CONTRIB_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">contrib</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">MODEL_TEST_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RUNTESTS_DIR</span><span class="p">,</span> <span class="n">MODEL_TESTS_DIR_NAME</span><span class="p">)</span>
<span class="n">REGRESSION_TEST_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RUNTESTS_DIR</span><span class="p">,</span> <span class="n">REGRESSION_TESTS_DIR_NAME</span><span class="p">)</span>
<span class="n">TEMP_DIR</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#39;django_&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_TEST_TEMP_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEMP_DIR</span>

<span class="n">REGRESSION_SUBDIRS_TO_SKIP</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">ALWAYS_INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.flatpages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.redirects&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.comments&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.admindocs&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.databrowse&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.humanize&#39;</span><span class="p">,</span>
    <span class="s">&#39;regressiontests.staticfiles_tests&#39;</span><span class="p">,</span>
    <span class="s">&#39;regressiontests.staticfiles_tests.apps.test&#39;</span><span class="p">,</span>
    <span class="s">&#39;regressiontests.staticfiles_tests.apps.no_label&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">geodjango</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>All databases must have spatial backends to run GeoDjango tests.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">spatial_dbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">db_dict</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                   <span class="k">if</span> <span class="n">db_dict</span><span class="p">[</span><span class="s">&#39;ENGINE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;django.contrib.gis&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">spatial_dbs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_test_modules</span><span class="p">():</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">dirpath</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">MODEL_TESTS_DIR_NAME</span><span class="p">,</span> <span class="n">MODEL_TEST_DIR</span><span class="p">),</span>
        <span class="p">(</span><span class="n">REGRESSION_TESTS_DIR_NAME</span><span class="p">,</span> <span class="n">REGRESSION_TEST_DIR</span><span class="p">),</span>
        <span class="p">(</span><span class="n">CONTRIB_DIR_NAME</span><span class="p">,</span> <span class="n">CONTRIB_DIR</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__init__&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="ow">or</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Python 3 byte code dirs (PEP 3147)</p></td><td class="code"><div class="highlight"><pre>                <span class="n">f</span> <span class="o">==</span> <span class="s">&#39;__pycache__&#39;</span> <span class="ow">or</span>
                <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;sql&#39;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">REGRESSION_SUBDIRS_TO_SKIP</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">loc</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">modules</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;INSTALLED_APPS&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">,</span>
        <span class="s">&#39;ROOT_URLCONF&#39;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&quot;ROOT_URLCONF&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
        <span class="s">&#39;TEMPLATE_DIRS&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPLATE_DIRS</span><span class="p">,</span>
        <span class="s">&#39;USE_I18N&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span><span class="p">,</span>
        <span class="s">&#39;LOGIN_URL&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span><span class="p">,</span>
        <span class="s">&#39;LANGUAGE_CODE&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span><span class="p">,</span>
        <span class="s">&#39;MIDDLEWARE_CLASSES&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">MIDDLEWARE_CLASSES</span><span class="p">,</span>
        <span class="s">&#39;STATIC_URL&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span><span class="p">,</span>
        <span class="s">&#39;STATIC_ROOT&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span><span class="p">,</span>
    <span class="p">}</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Redirect some settings for the duration of these tests.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="n">ALWAYS_INSTALLED_APPS</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">&#39;urls&#39;</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">)</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RUNTESTS_DIR</span><span class="p">,</span> <span class="n">TEST_TEMPLATE_DIR</span><span class="p">),)</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;en&#39;</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s">&#39;/accounts/login/&#39;</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
        <span class="s">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
        <span class="s">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
        <span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>For testing comment-utils, we require the MANAGERS attribute
to be set, so that a test email is sent out which we catch
in our tests.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">settings</span><span class="o">.</span><span class="n">MANAGERS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;admin@djangoproject.com&quot;</span><span class="p">,)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Load all the ALWAYS<em>INSTALLED</em>APPS.
(This import statement is intentionally delayed until after we
access settings because of the USE_I18N dependency.)</p></td><td class="code"><div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">django.db.models.loading</span> <span class="kn">import</span> <span class="n">get_apps</span><span class="p">,</span> <span class="n">load_app</span>
    <span class="n">get_apps</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Load all the test model apps.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">test_labels_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">test_labels</span><span class="p">])</span>
    <span class="n">test_modules</span> <span class="o">=</span> <span class="n">get_test_modules</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>If GeoDjango, then we'll want to add in the test applications
that are a part of its test suite.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="n">geodjango</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.contrib.gis.tests</span> <span class="kn">import</span> <span class="n">geo_apps</span>
        <span class="n">test_modules</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">geo_apps</span><span class="p">(</span><span class="n">runtests</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;django.contrib.gis&#39;</span><span class="p">,</span> <span class="s">&#39;django.contrib.sitemaps&#39;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">module_dir</span><span class="p">,</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">test_modules</span><span class="p">:</span>
        <span class="n">module_label</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">module_dir</span><span class="p">,</span> <span class="n">module_name</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>if the module was named on the command line, or
no modules were named (i.e., run all), import
this module and add it to the list to test.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="ow">not</span> <span class="n">test_labels</span> <span class="ow">or</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">test_labels_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Importing application </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">module_name</span><span class="p">)</span>
            <span class="n">mod</span> <span class="o">=</span> <span class="n">load_app</span><span class="p">(</span><span class="n">module_label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mod</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">module_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">:</span>
                    <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>

<span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Removing the temporary TEMP_DIR. Ensure we pass in unicode
so that it will successfully remove temp trees containing
non-ASCII filenames on Windows. (We're assuming the temp dir
name itself does not contain non-ASCII characters.)</p></td><td class="code"><div class="highlight"><pre>    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">TEMP_DIR</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Restore the old settings.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">django_tests</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">failfast</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
    <span class="n">extra_tests</span> <span class="o">=</span> <span class="p">[]</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>If GeoDjango is used, add it's tests that aren't a part of
an application (e.g., GEOS, GDAL, Distance objects).</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="n">geodjango</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">test_labels</span> <span class="ow">or</span> <span class="s">&#39;gis&#39;</span> <span class="ow">in</span> <span class="n">test_labels</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.contrib.gis.tests</span> <span class="kn">import</span> <span class="n">geodjango_suite</span>
        <span class="n">extra_tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geodjango_suite</span><span class="p">(</span><span class="n">apps</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Run the test suite, including the extra validation tests.</p></td><td class="code"><div class="highlight"><pre>    <span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">get_runner</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="s">&#39;TEST_RUNNER&#39;</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">TEST_RUNNER</span> <span class="o">=</span> <span class="s">&#39;django.test.simple.DjangoTestSuiteRunner&#39;</span>
    <span class="n">TestRunner</span> <span class="o">=</span> <span class="n">get_runner</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

    <span class="n">test_runner</span> <span class="o">=</span> <span class="n">TestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
        <span class="n">failfast</span><span class="o">=</span><span class="n">failfast</span><span class="p">)</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="n">test_runner</span><span class="o">.</span><span class="n">run_tests</span><span class="p">(</span><span class="n">test_labels</span><span class="p">,</span> <span class="n">extra_tests</span><span class="o">=</span><span class="n">extra_tests</span><span class="p">)</span>

    <span class="n">teardown</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">failures</span>


<span class="k">def</span> <span class="nf">bisect_tests</span><span class="p">(</span><span class="n">bisection_label</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">),</span> <span class="n">test_labels</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_labels</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Get the full list of test labels to use for bisection</p></td><td class="code"><div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">django.db.models.loading</span> <span class="kn">import</span> <span class="n">get_apps</span>
        <span class="n">test_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">app</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">get_apps</span><span class="p">()]</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Bisecting test suite: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_labels</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Make sure the bisection point isn't in the test list
Also remove tests that need to be run in specific combinations</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bisection_label</span><span class="p">,</span> <span class="s">&#39;model_inheritance_same_model_name&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">subprocess_args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;--settings=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">settings</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">failfast</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--failfast&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--verbosity=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--noinput&#39;</span><span class="p">)</span>

    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">test_labels_a</span> <span class="o">=</span> <span class="n">test_labels</span><span class="p">[:</span><span class="n">midpoint</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">bisection_label</span><span class="p">]</span>
        <span class="n">test_labels_b</span> <span class="o">=</span> <span class="n">test_labels</span><span class="p">[</span><span class="n">midpoint</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">bisection_label</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Pass </span><span class="si">%d</span><span class="s">a: Running the first half of the test suite&#39;</span> <span class="o">%</span> <span class="n">iteration</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Test labels: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_labels_a</span><span class="p">))</span>
        <span class="n">failures_a</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">subprocess_args</span> <span class="o">+</span> <span class="n">test_labels_a</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Pass </span><span class="si">%d</span><span class="s">b: Running the second half of the test suite&#39;</span> <span class="o">%</span> <span class="n">iteration</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Test labels: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_labels_b</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">failures_b</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">subprocess_args</span> <span class="o">+</span> <span class="n">test_labels_b</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">failures_a</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failures_b</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;***** Problem found in first half. Bisecting again...&quot;</span><span class="p">)</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_labels_a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">failures_b</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failures_a</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;***** Problem found in second half. Bisecting again...&quot;</span><span class="p">)</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_labels_b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">failures_a</span> <span class="ow">and</span> <span class="n">failures_b</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;***** Multiple sources of failure found&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;***** No source of failure found... try pair execution (--pair)&quot;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;***** Source of error: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">test_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">teardown</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">paired_tests</span><span class="p">(</span><span class="n">paired_test</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">),</span> <span class="n">test_labels</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">test_labels</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Get the full list of test labels to use for bisection</p></td><td class="code"><div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">django.db.models.loading</span> <span class="kn">import</span> <span class="n">get_apps</span>
        <span class="n">test_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">app</span><span class="o">.</span><span class="n">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">get_apps</span><span class="p">()]</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Trying paired execution&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Make sure the constant member of the pair isn't in the test list
Also remove tests that need to be run in specific combinations</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="n">paired_test</span><span class="p">,</span> <span class="s">&#39;model_inheritance_same_model_name&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">test_labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">subprocess_args</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">__file__</span><span class="p">,</span> <span class="s">&#39;--settings=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">settings</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">failfast</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--failfast&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--verbosity=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
        <span class="n">subprocess_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--noinput&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_labels</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** </span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s">: Check test pairing with </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_labels</span><span class="p">),</span> <span class="n">label</span><span class="p">))</span>
        <span class="n">failures</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">subprocess_args</span> <span class="o">+</span> <span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">paired_test</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">failures</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** Found problem pair with </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">print</span><span class="p">(</span><span class="s">&#39;***** No problem pair found&#39;</span><span class="p">)</span>
    <span class="n">teardown</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">optparse</span> <span class="kn">import</span> <span class="n">OptionParser</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;%prog [options] [module module module ...]&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="o">=</span><span class="n">usage</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;-v&#39;</span><span class="p">,</span><span class="s">&#39;--verbosity&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;verbosity&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s">&#39;choice&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">],</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Verbosity level; 0=minimal output, 1=normal output, 2=all &#39;</span>
             <span class="s">&#39;output&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--noinput&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;interactive&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Tells Django to NOT prompt the user for input of any kind.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--failfast&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;failfast&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Tells Django to stop running the test suite after first failed &#39;</span>
             <span class="s">&#39;test.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--settings&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Python path to settings module, e.g. &quot;myproject.settings&quot;. If &#39;</span>
             <span class="s">&#39;this isn</span><span class="se">\&#39;</span><span class="s">t provided, the DJANGO_SETTINGS_MODULE environment &#39;</span>
             <span class="s">&#39;variable will be used.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--bisect&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;bisect&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Bisect the test suite to discover a test that causes a test &#39;</span>
             <span class="s">&#39;failure when combined with the named test.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--pair&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;pair&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Run the test suite in pairs with the named test to find problem &#39;</span>
             <span class="s">&#39;pairs.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
        <span class="s">&#39;--liveserver&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;liveserver&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;Overrides the default address where the live server (used with &#39;</span>
             <span class="s">&#39;LiveServerTestCase) is expected to run from. The default value &#39;</span>
             <span class="s">&#39;is localhost:8081.&#39;</span><span class="p">),</span>
    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">settings</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">settings</span>
    <span class="k">elif</span> <span class="s">&quot;DJANGO_SETTINGS_MODULE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;DJANGO_SETTINGS_MODULE is not set in the environment. &quot;</span>
                      <span class="s">&quot;Set it or use --settings.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">liveserver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;DJANGO_LIVE_TEST_SERVER_ADDRESS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">liveserver</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">bisect</span><span class="p">:</span>
        <span class="n">bisect_tests</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">bisect</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">pair</span><span class="p">:</span>
        <span class="n">paired_tests</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">pair</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failures</span> <span class="o">=</span> <span class="n">django_tests</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">verbosity</span><span class="p">),</span> <span class="n">options</span><span class="o">.</span><span class="n">interactive</span><span class="p">,</span>
                                <span class="n">options</span><span class="o">.</span><span class="n">failfast</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failures</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">failures</span><span class="p">))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
