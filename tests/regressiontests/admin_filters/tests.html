<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › admin_filters › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">django.contrib.admin</span> <span class="kn">import</span> <span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">ModelAdmin</span><span class="p">,</span> <span class="n">SimpleListFilter</span><span class="p">,</span>
    <span class="n">BooleanFieldListFilter</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.views.main</span> <span class="kn">import</span> <span class="n">ChangeList</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ImproperlyConfigured</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">RequestFactory</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">override_settings</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">force_unicode</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Department</span><span class="p">,</span> <span class="n">Employee</span>


<span class="k">def</span> <span class="nf">select_by</span><span class="p">(</span><span class="n">dictlist</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dictlist</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">DecadeListFilter</span><span class="p">(</span><span class="n">SimpleListFilter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">model_admin</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;the 80s&#39;</span><span class="p">,</span> <span class="s">&quot;the 1980&#39;s&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;the 90s&#39;</span><span class="p">,</span> <span class="s">&quot;the 1990&#39;s&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;the 00s&#39;</span><span class="p">,</span> <span class="s">&quot;the 2000&#39;s&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&quot;other decades&quot;</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="n">decade</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">decade</span> <span class="o">==</span> <span class="s">&#39;the 80s&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">1980</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">1989</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decade</span> <span class="o">==</span> <span class="s">&#39;the 90s&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">1990</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">1999</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">decade</span> <span class="o">==</span> <span class="s">&#39;the 00s&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">2009</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithTitleAndParameter</span><span class="p">(</span><span class="n">DecadeListFilter</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;publication decade&#39;</span>
    <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;publication-decade&#39;</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithoutTitle</span><span class="p">(</span><span class="n">DecadeListFilter</span><span class="p">):</span>
    <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;publication-decade&#39;</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithoutParameter</span><span class="p">(</span><span class="n">DecadeListFilter</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;publication decade&#39;</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithNoneReturningLookups</span><span class="p">(</span><span class="n">DecadeListFilterWithTitleAndParameter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">model_admin</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithFailingQueryset</span><span class="p">(</span><span class="n">DecadeListFilterWithTitleAndParameter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
        <span class="k">raise</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>

<span class="k">class</span> <span class="nc">DecadeListFilterWithQuerysetBasedLookups</span><span class="p">(</span><span class="n">DecadeListFilterWithTitleAndParameter</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">model_admin</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">model_admin</span><span class="o">.</span><span class="n">queryset</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">1980</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">1989</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="s">&#39;the 80s&#39;</span><span class="p">,</span> <span class="s">&quot;the 1980&#39;s&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">1990</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">1999</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="s">&#39;the 90s&#39;</span><span class="p">,</span> <span class="s">&quot;the 1990&#39;s&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">year__gte</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">year__lte</span><span class="o">=</span><span class="mi">2009</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="s">&#39;the 00s&#39;</span><span class="p">,</span> <span class="s">&quot;the 2000&#39;s&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DecadeListFilterParameterEndsWith__In</span><span class="p">(</span><span class="n">DecadeListFilter</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;publication decade&#39;</span>
    <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;decade__in&#39;</span> <span class="c"># Ends with &#39;__in&quot;</span>

<span class="k">class</span> <span class="nc">DecadeListFilterParameterEndsWith__Isnull</span><span class="p">(</span><span class="n">DecadeListFilter</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;publication decade&#39;</span>
    <span class="n">parameter_name</span> <span class="o">=</span> <span class="s">&#39;decade__isnull&#39;</span> <span class="c"># Ends with &#39;__isnull&quot;</span>


<span class="k">class</span> <span class="nc">CustomUserAdmin</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;books_authored&#39;</span><span class="p">,</span> <span class="s">&#39;books_contributed&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="s">&#39;contributors&#39;</span><span class="p">,</span> <span class="s">&#39;is_best_seller&#39;</span><span class="p">,</span> <span class="s">&#39;date_registered&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">BookAdminWithTupleBooleanFilter</span><span class="p">(</span><span class="n">BookAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="s">&#39;contributors&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;is_best_seller&#39;</span><span class="p">,</span> <span class="n">BooleanFieldListFilter</span><span class="p">),</span> <span class="s">&#39;date_registered&#39;</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,</span> <span class="n">DecadeListFilterWithTitleAndParameter</span><span class="p">)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminWithoutTitle</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterWithoutTitle</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminWithoutParameter</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterWithoutParameter</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminWithNoneReturningLookups</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterWithNoneReturningLookups</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminWithFailingQueryset</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterWithFailingQueryset</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminWithQuerysetBasedLookups</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterWithQuerysetBasedLookups</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminParameterEndsWith__In</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterParameterEndsWith__In</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">DecadeFilterBookAdminParameterEndsWith__Isnull</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="n">DecadeListFilterParameterEndsWith__Isnull</span><span class="p">,)</span>

<span class="k">class</span> <span class="nc">EmployeeAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;department&#39;</span><span class="p">]</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;department&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ListFiltersTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span> <span class="o">=</span> <span class="n">RequestFactory</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Users</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;alfred&#39;</span><span class="p">,</span> <span class="s">&#39;alfred@example.com&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bob</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;bob&#39;</span><span class="p">,</span> <span class="s">&#39;bob@example.com&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lisa</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s">&#39;lisa&#39;</span><span class="p">,</span> <span class="s">&#39;lisa@example.com&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Books</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Djangonaut: an art of living&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2009</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="p">,</span> <span class="n">is_best_seller</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">date_registered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Django: a biography&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1999</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="p">,</span> <span class="n">is_best_seller</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="mi">207</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The Django Book&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bob</span><span class="p">,</span> <span class="n">is_best_seller</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">date_registered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="mi">103</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Gipsy guitar for dummies&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">2002</span><span class="p">,</span> <span class="n">is_best_seller</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">date_registered</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="o">.</span><span class="n">contributors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bob</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lisa</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_changelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ChangeList</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_display</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_display_links</span><span class="p">,</span>
            <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_filter</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">date_hierarchy</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">search_fields</span><span class="p">,</span>
            <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_select_related</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_per_page</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_max_show_all</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">list_editable</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_datefieldlistfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;date_registered__gte&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">,</span>
                                                 <span class="s">&#39;date_registered__lt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;date registered&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;Today&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?date_registered__gte=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                 <span class="s">&#39;&amp;date_registered__lt=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">))</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;date_registered__gte&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                 <span class="s">&#39;date_registered__lt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="o">.</span><span class="n">month</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>In case one week ago is in the same month.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;date registered&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;This month&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?date_registered__gte=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                 <span class="s">&#39;&amp;date_registered__lt=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">))</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;date_registered__gte&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                 <span class="s">&#39;date_registered__lt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="o">.</span><span class="n">year</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>In case one week ago is in the same year.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;date registered&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;This year&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?date_registered__gte=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                 <span class="s">&#39;&amp;date_registered__lt=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">))</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;date_registered__gte&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="p">),</span>
                                                 <span class="s">&#39;date_registered__lt&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">)})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;date registered&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;Past 7 days&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?date_registered__gte=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                 <span class="s">&#39;&amp;date_registered__lt=</span><span class="si">%s</span><span class="s">&#39;</span>
                                                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_week_ago</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tomorrow</span><span class="p">)))</span>

    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">USE_TZ</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_datefieldlistfilter_with_time_zone_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Regression for #17830</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">test_datefieldlistfilter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_allvaluesfieldlistfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;year__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Make sure the last choice is None and is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;year&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?year__isnull=True&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;year&#39;</span><span class="p">:</span> <span class="s">&#39;2002&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;year&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?year=2002&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_relatedfieldlistfilter_foreignkey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;author__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Make sure the last choice is None and is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;Verbose Author&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?author__isnull=True&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;author__id__exact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;Verbose Author&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>order of choices depends on User model, which has no order</p></td><td class="code"><div class="highlight"><pre>        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;alfred&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?author__id__exact=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_relatedfieldlistfilter_manytomany</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;contributors__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Make sure the last choice is None and is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;Verbose Contributors&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?contributors__isnull=True&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;contributors__id__exact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bob</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;Verbose Contributors&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;bob&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?contributors__id__exact=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bob</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_relatedfieldlistfilter_reverse_relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">CustomUserAdmin</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>FK relationship -----</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;books_authored__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lisa</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Make sure the last choice is None and is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;book&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?books_authored__isnull=True&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;books_authored__id__exact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;book&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?books_authored__id__exact=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>M2M relationship -----</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;books_contributed__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>Make sure the last choice is None and is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;book&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?books_contributed__isnull=True&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;books_contributed__id__exact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;book&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?books_contributed__id__exact=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_booleanfieldlistfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_booleanfieldlistfilter</span><span class="p">(</span><span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_booleanfieldlistfilter_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdminWithTupleBooleanFilter</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_booleanfieldlistfilter</span><span class="p">(</span><span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">verify_booleanfieldlistfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;is_best_seller__exact&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;is best seller&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?is_best_seller__exact=0&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;is_best_seller__exact&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;is best seller&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;Yes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?is_best_seller__exact=1&#39;</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;is_best_seller__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">django_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;is best seller&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?is_best_seller__isnull=True&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_simplelistfilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Make sure that the first option is 'All' ---------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)))</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;All&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>Look for books in the 1980s ----------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;publication-decade&#39;</span><span class="p">:</span> <span class="s">&#39;the 80s&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[])</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 1980</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+80s&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>Look for books in the 1990s ----------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;publication-decade&#39;</span><span class="p">:</span> <span class="s">&#39;the 90s&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 1990</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+90s&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>Look for books in the 2000s ----------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;publication-decade&#39;</span><span class="p">:</span> <span class="s">&#39;the 00s&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gipsy_book</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 2000</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+00s&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>Combine multiple filters -------------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;publication-decade&#39;</span><span class="p">:</span> <span class="s">&#39;the 00s&#39;</span><span class="p">,</span> <span class="s">&#39;author__id__exact&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">djangonaut_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>Make sure the correct choices are selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 2000</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+00s&amp;author__id__exact=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;Verbose Author&#39;</span><span class="p">)</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">select_by</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">),</span> <span class="s">&quot;display&quot;</span><span class="p">,</span> <span class="s">&quot;alfred&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choice</span><span class="p">[</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+00s&amp;author__id__exact=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">alfred</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_listfilter_without_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Any filter must define a title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminWithoutTitle</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">ImproperlyConfigured</span><span class="p">,</span>
            <span class="s">&quot;The list filter &#39;DecadeListFilterWithoutTitle&#39; does not specify a &#39;title&#39;.&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_simplelistfilter_without_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Any SimpleListFilter must define a parameter_name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminWithoutParameter</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">ImproperlyConfigured</span><span class="p">,</span>
            <span class="s">&quot;The list filter &#39;DecadeListFilterWithoutParameter&#39; does not specify a &#39;parameter_name&#39;.&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_simplelistfilter_with_none_returning_lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A SimpleListFilter lookups method can return None but disables the</span>
<span class="sd">        filter completely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminWithNoneReturningLookups</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>
        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filterspec</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_filter_with_failing_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that when a filter&#39;s queryset method fails, it fails loudly and</span>
<span class="sd">        the corresponding exception doesn&#39;t get swallowed.</span>
<span class="sd">        Refs #17828.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminWithFailingQueryset</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_simplelistfilter_with_queryset_based_lookups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminWithQuerysetBasedLookups</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span>

        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;All&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 1990</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+90s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 2000</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?publication-decade=the+00s&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_two_characters_long_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that list_filter works with two-characters long field names.</span>
<span class="sd">        Refs #16080.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">BookAdmin</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;no&#39;</span><span class="p">:</span> <span class="s">&#39;207&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">])</span>

        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;number&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?no=207&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_parameter_ends_with__in__or__isnull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a SimpleListFilter&#39;s parameter name is not mistaken for a</span>
<span class="sd">        model field if it ends with &#39;__isnull&#39; or &#39;__in&#39;.</span>
<span class="sd">        Refs #17091.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>When it ends with '__in' -----------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminParameterEndsWith__In</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;decade__in&#39;</span><span class="p">:</span> <span class="s">&#39;the 90s&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 1990</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?decade__in=the+90s&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>When it ends with '__isnull' ---------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">DecadeFilterBookAdminParameterEndsWith__Isnull</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;decade__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;the 90s&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bio_book</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>Make sure the correct choice is selected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;publication decade&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;the 1990</span><span class="se">\&#39;</span><span class="s">s&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?decade__isnull=the+90s&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_fk_with_to_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a filter on a FK respects the FK&#39;s to_field attribute.</span>
<span class="sd">        Refs #17972.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modeladmin</span> <span class="o">=</span> <span class="n">EmployeeAdmin</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>

        <span class="n">dev</span> <span class="o">=</span> <span class="n">Department</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s">&#39;DEV&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;Development&#39;</span><span class="p">)</span>
        <span class="n">design</span> <span class="o">=</span> <span class="n">Department</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s">&#39;DSN&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;Design&#39;</span><span class="p">)</span>
        <span class="n">john</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John Blue&#39;</span><span class="p">,</span> <span class="n">department</span><span class="o">=</span><span class="n">dev</span><span class="p">)</span>
        <span class="n">jack</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Jack Red&#39;</span><span class="p">,</span> <span class="n">department</span><span class="o">=</span><span class="n">design</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="n">jack</span><span class="p">,</span> <span class="n">john</span><span class="p">])</span>

        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;department&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;All&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;Development&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?department__code__exact=DEV&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;Design&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?department__code__exact=DSN&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>Filter by Department=='Development' --------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;department__code__exact&#39;</span><span class="p">:</span> <span class="s">&#39;DEV&#39;</span><span class="p">})</span>
        <span class="n">changelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_changelist</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">modeladmin</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>Make sure the correct queryset is returned</p></td><td class="code"><div class="highlight"><pre>        <span class="n">queryset</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_query_set</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">queryset</span><span class="p">),</span> <span class="p">[</span><span class="n">john</span><span class="p">])</span>

        <span class="n">filterspec</span> <span class="o">=</span> <span class="n">changelist</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="n">request</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">force_unicode</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="s">&#39;department&#39;</span><span class="p">)</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filterspec</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">changelist</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;All&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;Development&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?department__code__exact=DEV&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;display&#39;</span><span class="p">],</span> <span class="s">&#39;Design&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;selected&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;query_string&#39;</span><span class="p">],</span> <span class="s">&#39;?department__code__exact=DSN&#39;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
