<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › serializers_regress › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A test spanning all the capabilities of all the serializers.</span>

<span class="sd">This class defines sample data and a dynamically generated</span>
<span class="sd">test case that is capable of testing the capabilities of</span>
<span class="sd">the serializers. This includes all valid data values, plus</span>
<span class="sd">forward, backwards and self references.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">yaml</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">yaml</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">django.core.serializers</span> <span class="kn">import</span> <span class="n">SerializerDoesNotExist</span>
<span class="kn">from</span> <span class="nn">django.core.serializers.base</span> <span class="kn">import</span> <span class="n">DeserializationError</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">curry</span>
<span class="kn">from</span> <span class="nn">django.utils.unittest</span> <span class="kn">import</span> <span class="n">skipUnless</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">BooleanData</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="n">DateData</span><span class="p">,</span> <span class="n">DateTimeData</span><span class="p">,</span> <span class="n">EmailData</span><span class="p">,</span>
    <span class="n">FileData</span><span class="p">,</span> <span class="n">FilePathData</span><span class="p">,</span> <span class="n">DecimalData</span><span class="p">,</span> <span class="n">FloatData</span><span class="p">,</span> <span class="n">IntegerData</span><span class="p">,</span> <span class="n">IPAddressData</span><span class="p">,</span>
    <span class="n">GenericIPAddressData</span><span class="p">,</span> <span class="n">NullBooleanData</span><span class="p">,</span> <span class="n">PhoneData</span><span class="p">,</span> <span class="n">PositiveIntegerData</span><span class="p">,</span>
    <span class="n">PositiveSmallIntegerData</span><span class="p">,</span> <span class="n">SlugData</span><span class="p">,</span> <span class="n">SmallData</span><span class="p">,</span> <span class="n">TextData</span><span class="p">,</span> <span class="n">TimeData</span><span class="p">,</span>
    <span class="n">USStateData</span><span class="p">,</span> <span class="n">GenericData</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="n">UniqueAnchor</span><span class="p">,</span> <span class="n">FKData</span><span class="p">,</span> <span class="n">M2MData</span><span class="p">,</span> <span class="n">O2OData</span><span class="p">,</span>
    <span class="n">FKSelfData</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="n">FKDataToField</span><span class="p">,</span> <span class="n">FKDataToO2O</span><span class="p">,</span> <span class="n">M2MIntermediateData</span><span class="p">,</span>
    <span class="n">Intermediate</span><span class="p">,</span> <span class="n">BooleanPKData</span><span class="p">,</span> <span class="n">CharPKData</span><span class="p">,</span> <span class="n">EmailPKData</span><span class="p">,</span> <span class="n">FilePathPKData</span><span class="p">,</span>
    <span class="n">DecimalPKData</span><span class="p">,</span> <span class="n">FloatPKData</span><span class="p">,</span> <span class="n">IntegerPKData</span><span class="p">,</span> <span class="n">IPAddressPKData</span><span class="p">,</span>
    <span class="n">GenericIPAddressPKData</span><span class="p">,</span> <span class="n">PhonePKData</span><span class="p">,</span> <span class="n">PositiveIntegerPKData</span><span class="p">,</span>
    <span class="n">PositiveSmallIntegerPKData</span><span class="p">,</span> <span class="n">SlugPKData</span><span class="p">,</span> <span class="n">SmallPKData</span><span class="p">,</span> <span class="n">USStatePKData</span><span class="p">,</span>
    <span class="n">AutoNowDateTimeData</span><span class="p">,</span> <span class="n">ModifyingSaveData</span><span class="p">,</span> <span class="n">InheritAbstractModel</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">ExplicitInheritBaseModel</span><span class="p">,</span> <span class="n">InheritBaseModel</span><span class="p">,</span> <span class="n">ProxyBaseModel</span><span class="p">,</span>
    <span class="n">ProxyProxyBaseModel</span><span class="p">,</span> <span class="n">BigIntegerData</span><span class="p">,</span> <span class="n">LengthModel</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">ComplexModel</span><span class="p">,</span>
    <span class="n">NaturalKeyAnchor</span><span class="p">,</span> <span class="n">FKDataNaturalKey</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>A set of functions that can be used to recreate
test data objects of various kinds.
The save method is a raw base model save, to make
sure that the data in the database matches the
exact test case.</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">data_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">generic_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">fk_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;data_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">m2m_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">im2m_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">im_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">right_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;right&#39;</span><span class="p">]</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">left_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;extra&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;extra&#39;</span><span class="p">]</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">o2o_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data_id</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">pk_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">inherited_create</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">,</span><span class="o">**</span><span class="n">data</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>This isn't a raw save because:
 1) we're testing inheritance, not field behavior, so none
    of the field values need to be protected.
 2) saving the child class and having the parent created
    automatically is easier than manually creating both.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="p">[</span><span class="n">instance</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">klass</span><span class="p">,</span><span class="n">field</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">created</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">created</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>A set of functions that can be used to compare
test data objects of various kinds</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">data_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
         <span class="s">&quot;Objects with PK=</span><span class="si">%d</span><span class="s"> not equal; expected &#39;</span><span class="si">%s</span><span class="s">&#39; (</span><span class="si">%s</span><span class="s">), got &#39;</span><span class="si">%s</span><span class="s">&#39; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">pk</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">generic_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)])</span>

<span class="k">def</span> <span class="nf">fk_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">data_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">m2m_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)])</span>

<span class="k">def</span> <span class="nf">im2m_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>actually nothing else to check, the instance just should exist</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">im_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">],</span> <span class="n">instance</span><span class="o">.</span><span class="n">left_id</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;right&#39;</span><span class="p">],</span> <span class="n">instance</span><span class="o">.</span><span class="n">right_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;extra&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;extra&#39;</span><span class="p">],</span> <span class="n">instance</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&quot;doesn&#39;t matter&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">extra</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">o2o_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">data_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pk_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">inherited_compare</span><span class="p">(</span><span class="n">testcase</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">testcase</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="n">key</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Define some data types. Each data type is
actually a pair of functions; one to create
and one to compare objects of that type</p></td><td class="code"><div class="highlight"><pre><span class="n">data_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_create</span><span class="p">,</span> <span class="n">data_compare</span><span class="p">)</span>
<span class="n">generic_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">generic_create</span><span class="p">,</span> <span class="n">generic_compare</span><span class="p">)</span>
<span class="n">fk_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">fk_create</span><span class="p">,</span> <span class="n">fk_compare</span><span class="p">)</span>
<span class="n">m2m_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2m_create</span><span class="p">,</span> <span class="n">m2m_compare</span><span class="p">)</span>
<span class="n">im2m_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">im2m_create</span><span class="p">,</span> <span class="n">im2m_compare</span><span class="p">)</span>
<span class="n">im_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_create</span><span class="p">,</span> <span class="n">im_compare</span><span class="p">)</span>
<span class="n">o2o_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">o2o_create</span><span class="p">,</span> <span class="n">o2o_compare</span><span class="p">)</span>
<span class="n">pk_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">pk_create</span><span class="p">,</span> <span class="n">pk_compare</span><span class="p">)</span>
<span class="n">inherited_obj</span> <span class="o">=</span> <span class="p">(</span><span class="n">inherited_create</span><span class="p">,</span> <span class="n">inherited_compare</span><span class="p">)</span>

<span class="n">test_data</span> <span class="o">=</span> <span class="p">[</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Format: (data type, PK value, Model Class, data)</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BooleanData</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">BooleanData</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&quot;Test Char Data&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&quot;None&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&quot;null&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>(We use something that will fit into a latin1 database encoding here,
because that is still the default used on many system setups.)</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">CharData</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\xa5</span><span class="s">&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">DateData</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">16</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">DateData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">DateTimeData</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">37</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">DateTimeData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">EmailData</span><span class="p">,</span> <span class="s">&quot;hovercraft@example.com&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="n">EmailData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">EmailData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">FileData</span><span class="p">,</span> <span class="s">&#39;file:///foo/bar/whiz.txt&#39;</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><pre><code>(data_obj, 51, FileData, None),
</code></pre></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="n">FileData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">FilePathData</span><span class="p">,</span> <span class="s">&quot;/foo/bar/whiz.txt&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="n">FilePathData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="n">FilePathData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="n">DecimalData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;12.345&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="n">DecimalData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-12.345&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="n">DecimalData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="n">DecimalData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="n">FloatData</span><span class="p">,</span> <span class="mf">12.345</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="n">FloatData</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.345</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="n">FloatData</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="n">FloatData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">IntegerData</span><span class="p">,</span> <span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="n">IntegerData</span><span class="p">,</span> <span class="o">-</span><span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="n">IntegerData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="n">IntegerData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>(XX, ImageData</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">IPAddressData</span><span class="p">,</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="n">IPAddressData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">GenericIPAddressData</span><span class="p">,</span> <span class="s">&quot;fe80:1424:2223:6cff:fe8a:2e8a:2151:abcd&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="n">GenericIPAddressData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">NullBooleanData</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="n">NullBooleanData</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="n">NullBooleanData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="n">PhoneData</span><span class="p">,</span> <span class="s">&quot;212-634-5789&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="n">PhoneData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">PositiveIntegerData</span><span class="p">,</span> <span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="n">PositiveIntegerData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="n">PositiveSmallIntegerData</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="n">PositiveSmallIntegerData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="n">SlugData</span><span class="p">,</span> <span class="s">&quot;this-is-a-slug&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="n">SlugData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="n">SlugData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">SmallData</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="n">SmallData</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="n">SmallData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="n">SmallData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="n">TextData</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;This is a long piece of text.</span>
<span class="s">It contains line breaks.</span>
<span class="s">Several of them.</span>
<span class="s">The end.&quot;&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="n">TextData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="n">TextData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="n">TimeData</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">37</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="n">TimeData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">USStateData</span><span class="p">,</span> <span class="s">&quot;MA&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="n">USStateData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="n">USStateData</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span>

    <span class="p">(</span><span class="n">generic_obj</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">GenericData</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Generic Object 1&#39;</span><span class="p">,</span> <span class="s">&#39;tag1&#39;</span><span class="p">,</span> <span class="s">&#39;tag2&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">generic_obj</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="n">GenericData</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;Generic Object 2&#39;</span><span class="p">,</span> <span class="s">&#39;tag2&#39;</span><span class="p">,</span> <span class="s">&#39;tag3&#39;</span><span class="p">]),</span>

    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="s">&quot;Anchor 1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="s">&quot;Anchor 2&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="n">UniqueAnchor</span><span class="p">,</span> <span class="s">&quot;UAnchor 1&quot;</span><span class="p">),</span>

    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">FKData</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="c"># Post reference</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="n">FKData</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="c"># Pre reference</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">402</span><span class="p">,</span> <span class="n">FKData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="c"># Empty reference</span>

    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="n">M2MData</span><span class="p">,</span> <span class="p">[]),</span> <span class="c"># Empty set</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">411</span><span class="p">,</span> <span class="n">M2MData</span><span class="p">,</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span><span class="mi">301</span><span class="p">]),</span> <span class="c"># Post reference</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">412</span><span class="p">,</span> <span class="n">M2MData</span><span class="p">,</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">501</span><span class="p">]),</span> <span class="c"># Pre reference</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">413</span><span class="p">,</span> <span class="n">M2MData</span><span class="p">,</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span><span class="mi">301</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">501</span><span class="p">]),</span> <span class="c"># Pre and Post reference</span>

    <span class="p">(</span><span class="n">o2o_obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">O2OData</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="c"># Post reference</span>
    <span class="p">(</span><span class="n">o2o_obj</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">O2OData</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="c"># Pre reference</span>

    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">430</span><span class="p">,</span> <span class="n">FKSelfData</span><span class="p">,</span> <span class="mi">431</span><span class="p">),</span> <span class="c"># Pre reference</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">431</span><span class="p">,</span> <span class="n">FKSelfData</span><span class="p">,</span> <span class="mi">430</span><span class="p">),</span> <span class="c"># Post reference</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="n">FKSelfData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="c"># Empty reference</span>

    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">440</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">441</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">442</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[</span><span class="mi">440</span><span class="p">,</span> <span class="mi">441</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[</span><span class="mi">445</span><span class="p">,</span> <span class="mi">446</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">444</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[</span><span class="mi">440</span><span class="p">,</span> <span class="mi">441</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="mi">446</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">(</span><span class="n">m2m_obj</span><span class="p">,</span> <span class="mi">446</span><span class="p">,</span> <span class="n">M2MSelfData</span><span class="p">,</span> <span class="p">[]),</span>

    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="n">FKDataToField</span><span class="p">,</span> <span class="s">&quot;UAnchor 1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">451</span><span class="p">,</span> <span class="n">FKDataToField</span><span class="p">,</span> <span class="s">&quot;UAnchor 2&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">452</span><span class="p">,</span> <span class="n">FKDataToField</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>

    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="n">FKDataToO2O</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>

    <span class="p">(</span><span class="n">im2m_obj</span><span class="p">,</span> <span class="mi">470</span><span class="p">,</span> <span class="n">M2MIntermediateData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>testing post- and prereferences and extra fields</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">470</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">490</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">470</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">483</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">490</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">484</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">470</span><span class="p">,</span> <span class="s">&#39;extra&#39;</span><span class="p">:</span> <span class="s">&quot;extra&quot;</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">485</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">490</span><span class="p">,</span> <span class="s">&#39;extra&#39;</span><span class="p">:</span> <span class="s">&quot;extra&quot;</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">470</span><span class="p">,</span> <span class="s">&#39;extra&#39;</span><span class="p">:</span> <span class="s">&quot;extra&quot;</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">im_obj</span><span class="p">,</span> <span class="mi">487</span><span class="p">,</span> <span class="n">Intermediate</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s">&#39;left&#39;</span><span class="p">:</span> <span class="mi">490</span><span class="p">,</span> <span class="s">&#39;extra&#39;</span><span class="p">:</span> <span class="s">&quot;extra&quot;</span><span class="p">}),</span>

    <span class="p">(</span><span class="n">im2m_obj</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="n">M2MIntermediateData</span><span class="p">,</span> <span class="p">[]),</span>

    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="s">&quot;Anchor 3&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="s">&quot;Anchor 4&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="n">UniqueAnchor</span><span class="p">,</span> <span class="s">&quot;UAnchor 2&quot;</span><span class="p">),</span>

    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">601</span><span class="p">,</span> <span class="n">BooleanPKData</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">602</span><span class="p">,</span> <span class="n">BooleanPKData</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="n">CharPKData</span><span class="p">,</span> <span class="s">&quot;Test Char PKData&quot;</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><pre><code>(pk_obj, 620, DatePKData, datetime.date(2006,6,16)),
(pk_obj, 630, DateTimePKData, datetime.datetime(2006,6,16,10,42,37)),
</code></pre></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="n">EmailPKData</span><span class="p">,</span> <span class="s">&quot;hovercraft@example.com&quot;</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><pre><code>(pk_obj, 650, FilePKData, 'file:///foo/bar/whiz.txt'),
</code></pre></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">660</span><span class="p">,</span> <span class="n">FilePathPKData</span><span class="p">,</span> <span class="s">&quot;/foo/bar/whiz.txt&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">670</span><span class="p">,</span> <span class="n">DecimalPKData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;12.345&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">671</span><span class="p">,</span> <span class="n">DecimalPKData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;-12.345&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">672</span><span class="p">,</span> <span class="n">DecimalPKData</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">673</span><span class="p">,</span> <span class="n">FloatPKData</span><span class="p">,</span> <span class="mf">12.345</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">674</span><span class="p">,</span> <span class="n">FloatPKData</span><span class="p">,</span> <span class="o">-</span><span class="mf">12.345</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">675</span><span class="p">,</span> <span class="n">FloatPKData</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">680</span><span class="p">,</span> <span class="n">IntegerPKData</span><span class="p">,</span> <span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">681</span><span class="p">,</span> <span class="n">IntegerPKData</span><span class="p">,</span> <span class="o">-</span><span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">682</span><span class="p">,</span> <span class="n">IntegerPKData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><pre><code>(XX, ImagePKData
</code></pre></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">690</span><span class="p">,</span> <span class="n">IPAddressPKData</span><span class="p">,</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">695</span><span class="p">,</span> <span class="n">GenericIPAddressPKData</span><span class="p">,</span> <span class="s">&quot;fe80:1424:2223:6cff:fe8a:2e8a:2151:abcd&quot;</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>(pk<em>obj, 700, NullBooleanPKData, True),
(pk</em>obj, 701, NullBooleanPKData, False),</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">710</span><span class="p">,</span> <span class="n">PhonePKData</span><span class="p">,</span> <span class="s">&quot;212-634-5789&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="n">PositiveIntegerPKData</span><span class="p">,</span> <span class="mi">123456789</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">730</span><span class="p">,</span> <span class="n">PositiveSmallIntegerPKData</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">740</span><span class="p">,</span> <span class="n">SlugPKData</span><span class="p">,</span> <span class="s">&quot;this-is-a-slug&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="n">SmallPKData</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">751</span><span class="p">,</span> <span class="n">SmallPKData</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">),</span>
    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="n">SmallPKData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><pre><code>(pk_obj, 760, TextPKData, """This is a long piece of text.
</code></pre>

<p>It contains line breaks.
Several of them.
The end."""),
   (pk_obj, 770, TimePKData, datetime.time(10,42,37)),</p></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">pk_obj</span><span class="p">,</span> <span class="mi">780</span><span class="p">,</span> <span class="n">USStatePKData</span><span class="p">,</span> <span class="s">&quot;MA&quot;</span><span class="p">),</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><pre><code>(pk_obj, 790, XMLPKData, "&lt;foo&gt;&lt;/foo&gt;"),
</code></pre></td><td class="code"><div class="highlight"><pre>    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="n">AutoNowDateTimeData</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">37</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="n">ModifyingSaveData</span><span class="p">,</span> <span class="mi">42</span><span class="p">),</span>

    <span class="p">(</span><span class="n">inherited_obj</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="n">InheritAbstractModel</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;child_data&#39;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="s">&#39;parent_data&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">inherited_obj</span><span class="p">,</span> <span class="mi">910</span><span class="p">,</span> <span class="n">ExplicitInheritBaseModel</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;child_data&#39;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="s">&#39;parent_data&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">}),</span>
    <span class="p">(</span><span class="n">inherited_obj</span><span class="p">,</span> <span class="mi">920</span><span class="p">,</span> <span class="n">InheritBaseModel</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;child_data&#39;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span><span class="s">&#39;parent_data&#39;</span><span class="p">:</span><span class="mi">42</span><span class="p">}),</span>

    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">BigIntegerData</span><span class="p">,</span> <span class="mi">9223372036854775807</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="n">BigIntegerData</span><span class="p">,</span> <span class="o">-</span><span class="mi">9223372036854775808</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="n">BigIntegerData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="n">BigIntegerData</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1004</span><span class="p">,</span> <span class="n">LengthModel</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1005</span><span class="p">,</span> <span class="n">LengthModel</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">natural_key_test_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="n">NaturalKeyAnchor</span><span class="p">,</span> <span class="s">&quot;Natural Key Anghor&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">1101</span><span class="p">,</span> <span class="n">FKDataNaturalKey</span><span class="p">,</span> <span class="mi">1100</span><span class="p">),</span>
    <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">1102</span><span class="p">,</span> <span class="n">FKDataNaturalKey</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
<span class="p">]</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Because Oracle treats the empty string as NULL, Oracle is expected to fail
when field.empty<em>strings</em>allowed is True and the value is None; skip these
tests.</p></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">interprets_empty_strings_as_nulls</span><span class="p">:</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">test_data</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_obj</span> <span class="ow">and</span>
                         <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">empty_strings_allowed</span> <span class="ow">and</span>
                         <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)]</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Regression test for #8651 -- a FK to an object iwth PK of 0
This won't work on MySQL since it won't let you create an object
with a primary key of 0,</p></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">allows_primary_key_0</span><span class="p">:</span>
    <span class="n">test_data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
        <span class="p">(</span><span class="n">data_obj</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Anchor</span><span class="p">,</span> <span class="s">&quot;Anchor 0&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">fk_obj</span><span class="p">,</span> <span class="mi">465</span><span class="p">,</span> <span class="n">FKData</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">])</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Dynamically create serializer tests to ensure that all
registered serializers are automatically tested.</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SerializerTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_get_unknown_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">#DIVIDER</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">SerializerDoesNotExist</span><span class="p">):</span>
            <span class="n">serializers</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">serializers</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>15889: get_serializer('nonsense') raises a SerializerDoesNotExist</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">SerializerDoesNotExist</span><span class="p">)</span> <span class="k">as</span> <span class="n">cm</span><span class="p">:</span>
            <span class="n">serializers</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">test_unregister_unkown_serializer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">SerializerDoesNotExist</span><span class="p">):</span>
            <span class="n">serializers</span><span class="o">.</span><span class="n">unregister_serializer</span><span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_unkown_deserializer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">SerializerDoesNotExist</span><span class="p">):</span>
            <span class="n">serializers</span><span class="o">.</span><span class="n">get_deserializer</span><span class="p">(</span><span class="s">&quot;nonsense&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_json_deserializer_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">DeserializationError</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">serializers</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;[{&quot;pk&quot;:1}&quot;&quot;&quot;</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="nd">@skipUnless</span><span class="p">(</span><span class="n">yaml</span><span class="p">,</span> <span class="s">&quot;PyYAML not installed&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_yaml_deserializer_exception</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">DeserializationError</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">serializers</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="s">&quot;yaml&quot;</span><span class="p">,</span> <span class="s">&quot;{&quot;</span><span class="p">):</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_serialize_proxy_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">BaseModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">parent_data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">base_objects</span> <span class="o">=</span> <span class="n">BaseModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">proxy_objects</span> <span class="o">=</span> <span class="n">ProxyBaseModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">proxy_proxy_objects</span> <span class="o">=</span> <span class="n">ProxyProxyBaseModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">base_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="n">base_objects</span><span class="p">)</span>
        <span class="n">proxy_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="n">proxy_objects</span><span class="p">)</span>
        <span class="n">proxy_proxy_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&quot;json&quot;</span><span class="p">,</span> <span class="n">proxy_proxy_objects</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base_data</span><span class="p">,</span> <span class="n">proxy_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;proxy&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base_data</span><span class="p">,</span> <span class="n">proxy_proxy_data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;proxy&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">serializerTest</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>SerializerDoesNotExist is instantiated with the nonexistent format</p></td><td class="code"><div class="highlight"><pre>    <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">instance_count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">constraint_checks_disabled</span><span class="p">():</span>
            <span class="n">objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Create all the objects defined in the test data</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">instance_count</span><span class="p">:</span>
        <span class="n">instance_count</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Get a count of the number of objects created for each class</p></td><td class="code"><div class="highlight"><pre>    <span class="n">objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Add the generic tagged objects to the object list</p></td><td class="code"><div class="highlight"><pre>    <span class="n">serialized_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">serializers</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">serialized_data</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Serialize the test database</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">:</span>
        <span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Assert that the deserialized data is the same
as the original source</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">klass</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">instance_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">naturalKeySerializerTest</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Assert that the number of objects deserialized is the
same as the number that was serialized.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">instance_count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span> <span class="ow">in</span> <span class="n">natural_key_test_data</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">constraint_checks_disabled</span><span class="p">():</span>
            <span class="n">objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>Create all the objects defined in the test data</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">instance_count</span><span class="p">:</span>
        <span class="n">instance_count</span><span class="p">[</span><span class="n">klass</span><span class="p">]</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>Get a count of the number of objects created for each class</p></td><td class="code"><div class="highlight"><pre>    <span class="n">serialized_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">use_natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">serializers</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">serialized_data</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>Serialize the test database</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span> <span class="ow">in</span> <span class="n">natural_key_test_data</span><span class="p">:</span>
        <span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">datum</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Assert that the deserialized data is the same
as the original source</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">klass</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">instance_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">fieldsTest</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">ComplexModel</span><span class="p">(</span><span class="n">field1</span><span class="o">=</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="n">field2</span><span class="o">=</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="n">field3</span><span class="o">=</span><span class="s">&#39;third&#39;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Assert that the number of objects deserialized is the
same as the number that was serialized.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">serialized_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;field1&#39;</span><span class="p">,</span><span class="s">&#39;field3&#39;</span><span class="p">))</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="n">serialized_data</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>Serialize then deserialize the test database</p></td><td class="code"><div class="highlight"><pre>    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="s">&#39;first&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">field3</span><span class="p">,</span> <span class="s">&#39;third&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">streamTest</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">ComplexModel</span><span class="p">(</span><span class="n">field1</span><span class="o">=</span><span class="s">&#39;first&#39;</span><span class="p">,</span><span class="n">field2</span><span class="o">=</span><span class="s">&#39;second&#39;</span><span class="p">,</span><span class="n">field3</span><span class="o">=</span><span class="s">&#39;third&#39;</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save_base</span><span class="p">(</span><span class="n">raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>Check that the deserialized object contains data in only the serialized fields.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="p">(</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="n">HttpResponse</span><span class="p">()):</span>
        <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>Serialize the test database to a stream</p></td><td class="code"><div class="highlight"><pre>        <span class="n">string_data</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">format</span><span class="p">,</span> <span class="p">[</span><span class="n">obj</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Serialize normally for a comparison</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">string_data</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">string_data</span><span class="p">,</span> <span class="n">stream</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">for</span> <span class="n">format</span> <span class="ow">in</span> <span class="n">serializers</span><span class="o">.</span><span class="n">get_serializer_formats</span><span class="p">():</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">SerializerTests</span><span class="p">,</span> <span class="s">&#39;test_&#39;</span> <span class="o">+</span> <span class="n">format</span> <span class="o">+</span> <span class="s">&#39;_serializer&#39;</span><span class="p">,</span> <span class="n">curry</span><span class="p">(</span><span class="n">serializerTest</span><span class="p">,</span> <span class="n">format</span><span class="p">))</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">SerializerTests</span><span class="p">,</span> <span class="s">&#39;test_&#39;</span> <span class="o">+</span> <span class="n">format</span> <span class="o">+</span> <span class="s">&#39;_natural_key_serializer&#39;</span><span class="p">,</span> <span class="n">curry</span><span class="p">(</span><span class="n">naturalKeySerializerTest</span><span class="p">,</span> <span class="n">format</span><span class="p">))</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">SerializerTests</span><span class="p">,</span> <span class="s">&#39;test_&#39;</span> <span class="o">+</span> <span class="n">format</span> <span class="o">+</span> <span class="s">&#39;_serializer_fields&#39;</span><span class="p">,</span> <span class="n">curry</span><span class="p">(</span><span class="n">fieldsTest</span><span class="p">,</span> <span class="n">format</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">format</span> <span class="o">!=</span> <span class="s">&#39;python&#39;</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">SerializerTests</span><span class="p">,</span> <span class="s">&#39;test_&#39;</span> <span class="o">+</span> <span class="n">format</span> <span class="o">+</span> <span class="s">&#39;_serializer_stream&#39;</span><span class="p">,</span> <span class="n">curry</span><span class="p">(</span><span class="n">streamTest</span><span class="p">,</span> <span class="n">format</span><span class="p">))</span>

</pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>Check that the two are the same</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
