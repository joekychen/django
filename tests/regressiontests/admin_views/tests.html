<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › admin_views › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>coding: utf-8</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">urlparse</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span><span class="p">,</span> <span class="n">global_settings</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">SuspiciousOperation</span>
<span class="kn">from</span> <span class="nn">django.core.files</span> <span class="kn">import</span> <span class="n">temp</span> <span class="k">as</span> <span class="n">tempfile</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Register auth models with the admin.</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.helpers</span> <span class="kn">import</span> <span class="n">ACTION_CHECKBOX_NAME</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.models</span> <span class="kn">import</span> <span class="n">LogEntry</span><span class="p">,</span> <span class="n">DELETION</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.sites</span> <span class="kn">import</span> <span class="n">LOGIN_FORM_KEY</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.util</span> <span class="kn">import</span> <span class="n">quote</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.views.main</span> <span class="kn">import</span> <span class="n">IS_POPUP_VAR</span>
<span class="kn">from</span> <span class="nn">django.contrib.admin.tests</span> <span class="kn">import</span> <span class="n">AdminSeleniumWebDriverTestCase</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">REDIRECT_FIELD_NAME</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">Group</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">Permission</span><span class="p">,</span> <span class="n">UNUSABLE_PASSWORD</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="kn">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.forms.util</span> <span class="kn">import</span> <span class="n">ErrorList</span>
<span class="kn">from</span> <span class="nn">django.template.response</span> <span class="kn">import</span> <span class="n">TemplateResponse</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">formats</span><span class="p">,</span> <span class="n">translation</span><span class="p">,</span> <span class="n">unittest</span>
<span class="kn">from</span> <span class="nn">django.utils.cache</span> <span class="kn">import</span> <span class="n">get_max_age</span>
<span class="kn">from</span> <span class="nn">django.utils.encoding</span> <span class="kn">import</span> <span class="n">iri_to_uri</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">escape</span>
<span class="kn">from</span> <span class="nn">django.utils.http</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">override_settings</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>local test models</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">BarAccount</span><span class="p">,</span> <span class="n">CustomArticle</span><span class="p">,</span> <span class="n">EmptyModel</span><span class="p">,</span> <span class="n">FooAccount</span><span class="p">,</span>
    <span class="n">Gallery</span><span class="p">,</span> <span class="n">ModelWithStringPrimaryKey</span><span class="p">,</span> <span class="n">Person</span><span class="p">,</span> <span class="n">Persona</span><span class="p">,</span> <span class="n">Picture</span><span class="p">,</span> <span class="n">Podcast</span><span class="p">,</span>
    <span class="n">Section</span><span class="p">,</span> <span class="n">Subscriber</span><span class="p">,</span> <span class="n">Vodcast</span><span class="p">,</span> <span class="n">Language</span><span class="p">,</span> <span class="n">Collector</span><span class="p">,</span> <span class="n">Widget</span><span class="p">,</span> <span class="n">Grommet</span><span class="p">,</span>
    <span class="n">DooHickey</span><span class="p">,</span> <span class="n">FancyDoodad</span><span class="p">,</span> <span class="n">Whatsit</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Plot</span><span class="p">,</span> <span class="n">FunkyTag</span><span class="p">,</span> <span class="n">Chapter</span><span class="p">,</span>
    <span class="n">Book</span><span class="p">,</span> <span class="n">Promo</span><span class="p">,</span> <span class="n">WorkHour</span><span class="p">,</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Answer</span><span class="p">,</span> <span class="n">Inquisition</span><span class="p">,</span> <span class="n">Actor</span><span class="p">,</span>
    <span class="n">FoodDelivery</span><span class="p">,</span> <span class="n">RowLevelChangePermissionModel</span><span class="p">,</span> <span class="n">Paper</span><span class="p">,</span> <span class="n">CoverLetter</span><span class="p">,</span> <span class="n">Story</span><span class="p">,</span>
    <span class="n">OtherStory</span><span class="p">,</span> <span class="n">ComplexSortedPerson</span><span class="p">,</span> <span class="n">Parent</span><span class="p">,</span> <span class="n">Child</span><span class="p">,</span> <span class="n">AdminOrderedField</span><span class="p">,</span>
    <span class="n">AdminOrderedModelMethod</span><span class="p">,</span> <span class="n">AdminOrderedAdminMethod</span><span class="p">,</span> <span class="n">AdminOrderedCallable</span><span class="p">,</span>
    <span class="n">Report</span><span class="p">,</span> <span class="n">MainPrepopulated</span><span class="p">,</span> <span class="n">RelatedPrepopulated</span><span class="p">,</span> <span class="n">UnorderedObject</span><span class="p">)</span>


<span class="n">ERROR_MESSAGE</span> <span class="o">=</span> <span class="s">&quot;Please enter the correct username and password </span><span class="se">\</span>
<span class="s">for a staff account. Note that both fields are case-sensitive.&quot;</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewBasicTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-colors.xml&#39;</span><span class="p">,</span>
                <span class="s">&#39;admin-views-fabrics.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-books.xml&#39;</span><span class="p">]</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Store the bit of the URL where the admin is registered as a class
variable. That way we can test a second AdminSite just by subclassing
this test case and changing urlbit.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&#39;admin&#39;</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_I18N</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_LANGUAGE_CODE</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_I18N</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_LANGUAGE_CODE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">reset_format_cache</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testTrailingSlashRequired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If you leave off the trailing slash, app should redirect and add it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/add&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">request</span><span class="p">,</span>
            <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">301</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testBasicAddGet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A smoke test to ensure GET on the add_view works.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testAddWithGETArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;My Section&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;value=&quot;My Section&quot;&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&quot;Couldn&#39;t find an input with the right value in the response&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testBasicEditGet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A smoke test to ensure GET on the change_view works.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/1/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testBasicEditGetStringPK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A smoke test to ensure GET on the change_view works (returns an HTTP</span>
<span class="sd">        404 error, see #11191) when passing a string as the PK argument for a</span>
<span class="sd">        model with an integer PK field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/abc/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testBasicAddPost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A smoke test to ensure POST on add_view works.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Another Section&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>inline data</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;article_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span>

    <span class="k">def</span> <span class="nf">testPopupAddPost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure http response from a popup is properly escaped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;_popup&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;title with a new</span><span class="se">\n</span><span class="s">line&#39;</span><span class="p">,</span>
            <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="s">&#39;some content&#39;</span><span class="p">,</span>
            <span class="s">&#39;date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2010-09-10&#39;</span><span class="p">,</span>
            <span class="s">&#39;date_1&#39;</span><span class="p">:</span> <span class="s">&#39;14:55:39&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;dismissAddAnotherPopup&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;title with a new</span><span class="se">\\</span><span class="s">u000Aline&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Post data for edit inline</p></td><td class="code"><div class="highlight"><pre>    <span class="n">inline_post_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test section&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>inline data</p></td><td class="code"><div class="highlight"><pre>        <span class="s">&quot;article_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;6&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>there is no title in database, give one here or formset will fail.</p></td><td class="code"><div class="highlight"><pre>        <span class="s">&quot;article_set-0-title&quot;</span><span class="p">:</span> <span class="s">&quot;Norske bostaver æøå skaper problemer&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-0-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;Middle content&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-0-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;2008-03-18&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-0-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;11:54:58&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-0-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-1-title&quot;</span><span class="p">:</span> <span class="s">&quot;Need a title.&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-1-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;Oldest content&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-1-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;2000-03-18&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-1-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;11:54:58&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-2-title&quot;</span><span class="p">:</span> <span class="s">&quot;Need a title.&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-2-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;Newest content&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-2-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;2009-03-18&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-2-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;11:54:58&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-3-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-3-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-3-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-3-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-3-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-4-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-4-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-4-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-4-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-4-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-5-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-5-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-5-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-5-date_0&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="s">&quot;article_set-5-date_1&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">testBasicEditPost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A smoke test to ensure POST on edit_view works.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/1/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span>

    <span class="k">def</span> <span class="nf">testEditSaveAs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test &quot;save as&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inline_post_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">post_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">&#39;_saveasnew&#39;</span><span class="p">:</span> <span class="s">&#39;Save+as+new&#39;</span><span class="p">,</span>
            <span class="s">&quot;article_set-1-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-2-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-3-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-4-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;article_set-5-section&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/1/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingCallable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure we can sort on a list_display field that is a callable</span>
<span class="sd">        (column 2 is callable_year in ArticleAdmin)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Oldest content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Newest content&#39;</span><span class="p">),</span>
            <span class="s">&quot;Results of sorting on callable are out of order.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure we can sort on a list_display field that is a Model method</span>
<span class="sd">        (colunn 3 is &#39;model_year&#39; in ArticleAdmin)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="s">&#39;-3&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Newest content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Oldest content&#39;</span><span class="p">),</span>
            <span class="s">&quot;Results of sorting on Model method are out of order.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingModelAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure we can sort on a list_display field that is a ModelAdmin method</span>
<span class="sd">        (colunn 4 is &#39;modeladmin_year&#39; in ArticleAdmin)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="s">&#39;4&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Oldest content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Middle content&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Newest content&#39;</span><span class="p">),</span>
            <span class="s">&quot;Results of sorting on ModelAdmin method are out of order.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingMultiple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Sort by name, gender
This hard-codes the URL because it'll fail if it runs against the
'admin2' custom admin (which doesn't have the Person model).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="s">&#39;1.2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Sort by gender descending, name</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span> <span class="s">&#39;-2.1&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingPreserveQuerySetOrdering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If no ordering is defined in `ModelAdmin.ordering` or in the query</span>
<span class="sd">        string, then the underlying order of the queryset should not be</span>
<span class="sd">        changed, even if it is defined in `Modeladmin.queryset()`.</span>
<span class="sd">        Refs #11868, #7309.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Amy&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chris&quot;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>This hard-codes the URL because it'll fail if it runs against the
'admin2' custom admin (which doesn't have the Person model).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingModelMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Test ordering on Model Meta is respected</p></td><td class="code"><div class="highlight"><pre>        <span class="n">l1</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">iso</span><span class="o">=</span><span class="s">&#39;ur&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Urdu&#39;</span><span class="p">)</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="n">Language</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">iso</span><span class="o">=</span><span class="s">&#39;ar&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Arabic&#39;</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/language/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">l2</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">l1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Test we can override with query string</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/language/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;o&#39;</span><span class="p">:</span><span class="s">&#39;-1&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">l1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">l2</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListSortingOverrideModelAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Test ordering on Model Admin is respected, and overrides Model Meta</p></td><td class="code"><div class="highlight"><pre>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="n">release_date</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">release_date</span><span class="o">=</span><span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/podcast/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testMultipleSortSameField</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Check that we get the columns we expect if we have two columns
that correspond to the same ordering field</p></td><td class="code"><div class="highlight"><pre>        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="n">release_date</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">release_date</span><span class="o">=</span><span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/podcast/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">p1</span> <span class="o">=</span> <span class="n">ComplexSortedPerson</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">ComplexSortedPerson</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Amy&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&#39;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/complexsortedperson/&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Should have 5 columns (including action checkbox col)</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;th scope=&quot;col&quot;&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Colored name&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Check order</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Name&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Colored name&#39;</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Check sorting - should be by name</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">link</span> <span class="o">%</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testSortIndicatorsAdminOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures that the admin shows default sort indicators for all</span>
<span class="sd">        kinds of &#39;ordering&#39; fields: field names, method on the model</span>
<span class="sd">        admin and model itself, and other callables. See #17252.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">[(</span><span class="n">AdminOrderedField</span><span class="p">,</span>       <span class="s">&#39;adminorderedfield&#39;</span>      <span class="p">),</span>
                  <span class="p">(</span><span class="n">AdminOrderedModelMethod</span><span class="p">,</span> <span class="s">&#39;adminorderedmodelmethod&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">AdminOrderedAdminMethod</span><span class="p">,</span> <span class="s">&#39;adminorderedadminmethod&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">AdminOrderedCallable</span><span class="p">,</span>    <span class="s">&#39;adminorderedcallable&#39;</span>   <span class="p">)]</span>
        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">stuff</span><span class="o">=</span><span class="s">&#39;The Last Item&#39;</span><span class="p">,</span>   <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">stuff</span><span class="o">=</span><span class="s">&#39;The First Item&#39;</span><span class="p">,</span>  <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">a3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">stuff</span><span class="o">=</span><span class="s">&#39;The Middle Item&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Should have 3 columns including action checkbox col.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;th scope=&quot;col&quot;&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">msg_prefix</span><span class="o">=</span><span class="n">url</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Check if the correct column was selected. 2 is the index of the
'order' column in the model admin's 'list<em>display' with 0 being
the implicit 'action</em>checkbox' and 1 being the column 'stuff'.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_ordering_field_columns</span><span class="p">(),</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="s">&#39;asc&#39;</span><span class="p">})</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>Check order of records.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;The First Item&#39;</span><span class="p">)</span> <span class="o">&lt;</span>
                <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;The Middle Item&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;The Last Item&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">testLimitedFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure admin changelist filters do not contain objects excluded via limit_choices_to.</span>
<span class="sd">        This also tests relation-spanning filters (e.g. &#39;color__value&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div id=&quot;changelist-filter&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&quot;Expected filter not found in changelist view&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;a href=&quot;?color__id__exact=3&quot;&gt;Blue&lt;/a&gt;&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&quot;Changelist filter not correctly limited by limit_choices_to&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testRelationSpanningFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/chapterxtra1/&#39;</span> <span class="o">%</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div id=&quot;changelist-filter&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;chap__id__exact&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Chapter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">value</span><span class="p">),</span>
            <span class="s">&#39;chap__title&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">title</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">Chapter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">value</span><span class="p">),</span>
            <span class="s">&#39;chap__book__id__exact&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">value</span><span class="p">),</span>
            <span class="s">&#39;chap__book__name&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">b</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">value</span><span class="p">),</span>
            <span class="s">&#39;chap__book__promo__id__exact&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Promo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">promo_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()),</span>
            <span class="s">&#39;chap__book__promo__name&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">Promo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()],</span>
                <span class="n">test</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">chap</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">promo_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()),</span>
            <span class="p">}</span>
        <span class="k">for</span> <span class="n">filter_path</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]:</span>
                <span class="n">query_string</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">({</span><span class="n">filter_path</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>ensure filter link exists</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;a href=&quot;?</span><span class="si">%s</span><span class="s">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">query_string</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>ensure link works</p></td><td class="code"><div class="highlight"><pre>                <span class="n">filtered_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/chapterxtra1/?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">query_string</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">filtered_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>ensure changelist contains only valid objects</p></td><td class="code"><div class="highlight"><pre>                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">filtered_response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query_set</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">&#39;test&#39;</span><span class="p">](</span><span class="n">obj</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">testIncorrectLookupParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure incorrect lookup parameters are handled gracefully.&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;notarealfield&#39;</span><span class="p">:</span> <span class="s">&#39;5&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/?e=1&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Spanning relationships through an inexistant related object (Refs #16716)</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;notarealfield__whatever&#39;</span><span class="p">:</span> <span class="s">&#39;5&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/?e=1&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;color__id__exact&#39;</span><span class="p">:</span> <span class="s">&#39;StringNotInteger!&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/thing/?e=1&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testIsNullLookups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure is_null is handled correctly.&quot;&quot;&quot;</span>
        <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;I Could Go Anywhere&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&quot;Versatile&quot;</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;4 articles&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;section__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;false&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;3 articles&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;section__isnull&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;1 article&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testLogoutAndPasswordChangeURLs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/article/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;a href=&quot;/test_admin/</span><span class="si">%s</span><span class="s">/logout/&quot;&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;a href=&quot;/test_admin/</span><span class="si">%s</span><span class="s">/password_change/&quot;&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testNamedGroupFieldChoicesChangeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures the admin changelist shows correct values in the relevant column</span>
<span class="sd">        for rows corresponding to instances of a model in which a named group</span>
<span class="sd">        has been used in the choices option of a field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/fabric/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s">&#39;&lt;a href=&quot;1/&quot;&gt;Horizontal&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span>
            <span class="s">&#39;&lt;a href=&quot;2/&quot;&gt;Vertical&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s">&quot;Changelist table isn&#39;t showing the right human-readable values set by a model field &#39;choices&#39; option named group.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testNamedGroupFieldChoicesFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures the filter UI shows correctly when at least one named group has</span>
<span class="sd">        been used in the choices option of a model field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/fabric/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div id=&quot;changelist-filter&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="s">&#39;&lt;a href=&quot;?surface__exact=x&quot;&gt;Horizontal&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span>
            <span class="s">&#39;&lt;a href=&quot;?surface__exact=y&quot;&gt;Vertical&lt;/a&gt;&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s">&quot;Changelist filter isn&#39;t showing options contained inside a model field &#39;choices&#39; option named group.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeListNullBooleanDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">public</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>This hard-codes the URl because it'll fail if it runs
against the 'admin2' custom admin (which doesn't have the
Post model).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/post/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;icon-unknown.gif&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testI18NLanguageNonEnglishDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the JavaScript i18n view returns an empty language catalog</span>
<span class="sd">        if the default language is non-English but the selected language</span>
<span class="sd">        is English. See #13388 and #3594 for more details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LANGUAGE_CODE</span><span class="o">=</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;en-us&#39;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/jsi18n/&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Choisir une heure&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testI18NLanguageNonEnglishFallback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure that the fallback language is still working properly</span>
<span class="sd">        in cases where the selected language cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LANGUAGE_CODE</span><span class="o">=</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/jsi18n/&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Choisir une heure&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testL10NDeactivated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if L10N is deactivated, the JavaScript i18n view doesn&#39;t</span>
<span class="sd">        return localized date/time formats. Refs #14824.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LANGUAGE_CODE</span><span class="o">=</span><span class="s">&#39;ru&#39;</span><span class="p">,</span> <span class="n">USE_L10N</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/jsi18n/&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.%m.%Y %H:%M:%S&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_disallowed_filtering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">SuspiciousOperation</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s">&quot;/test_admin/admin/admin_views/album/?owner__email__startswith=fuzzy&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/thing/?color__value__startswith=red&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/thing/?color__value=red&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SuspiciousOperation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Filters are allowed if explicitly included in list_filter&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/person/?age__gt=30&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SuspiciousOperation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Filters should be allowed if they involve a local field without the need to whitelist them in list_filter or date_hierarchy.&quot;</span><span class="p">)</span>

        <span class="n">e1</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Anonymous&#39;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s">&#39;123&#39;</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Visitor&#39;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">alive</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s">&#39;124&#39;</span><span class="p">)</span>
        <span class="n">WorkHour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">employee</span><span class="o">=</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">WorkHour</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">datum</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">employee</span><span class="o">=</span><span class="n">e2</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/workhour/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;employee__person_ptr__exact&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/workhour/?employee__person_ptr__exact=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_allowed_filtering_15103</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regressions test for ticket 15103 - filtering on fields defined in a</span>
<span class="sd">        ForeignKey &#39;limit_choices_to&#39; should be allowed, otherwise raw_id_fields</span>
<span class="sd">        can break.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/inquisition/?leader__name=Palin&amp;leader__age=27&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SuspiciousOperation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;Filters should be allowed if they are defined on a ForeignKey pointing to this model&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_hide_change_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests if the &quot;change password&quot; link in the admin is hidden if the User</span>
<span class="sd">        does not have a usable password set.</span>
<span class="sd">        (against 9bea85795705d015cdadc82c68b99196a8554f5c)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">)</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_unusable_password</span><span class="p">()</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:password_change&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="s">&#39;The &quot;change password&quot; link should not be displayed if a user does not have a usable password.&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewFormUrlTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;admin-views-users.xml&quot;</span><span class="p">]</span>
    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&quot;admin3&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testChangeFormUrlHasCorrectValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests whether change_view has form_url in request.context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/1/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;form_url&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">&#39;form_url not present in response.context&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;form_url&#39;</span><span class="p">],</span> <span class="s">&#39;pony&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_filter_with_custom_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that one can use a custom template to render an admin filter.</span>
<span class="sd">        Refs #17515.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">template_dirs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPLATE_DIRS</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;templates&#39;</span><span class="p">),)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">TEMPLATE_DIRS</span><span class="o">=</span><span class="n">template_dirs</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/color2/&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;custom_filter_template.html&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">templates</span><span class="p">])</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminJavaScriptTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testSingleWidgetFirsFieldFocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        JavaScript-assisted auto-focus on first field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/picture/add/&#39;</span> <span class="o">%</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span>
            <span class="s">&#39;&lt;script type=&quot;text/javascript&quot;&gt;document.getElementById(&quot;id_name&quot;).focus();&lt;/script&gt;&#39;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">testMultiWidgetFirsFieldFocus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        JavaScript-assisted auto-focus should work if a model/ModelAdmin setup</span>
<span class="sd">        is such that the first form field has a MultiWidget.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/reservation/add/&#39;</span> <span class="o">%</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span>
            <span class="s">&#39;&lt;script type=&quot;text/javascript&quot;&gt;document.getElementById(&quot;id_start_date_0&quot;).focus();&lt;/script&gt;&#39;</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_js_minified_only_if_debug_is_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the minified versions of the JS files are only used when</span>
<span class="sd">        DEBUG is False.</span>
<span class="sd">        Refs #17521.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">override_settings</span><span class="p">(</span><span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/add/&#39;</span> <span class="o">%</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;jquery.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;jquery.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;prepopulate.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;prepopulate.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;actions.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;actions.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;collapse.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;collapse.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;inlines.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;inlines.min.js&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">override_settings</span><span class="p">(</span><span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/section/add/&#39;</span> <span class="o">%</span> <span class="s">&#39;admin&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;jquery.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;jquery.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;prepopulate.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;prepopulate.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;actions.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;actions.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;collapse.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;collapse.min.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;inlines.js&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;inlines.min.js&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">SaveAsTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span><span class="s">&#39;admin-views-person.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_save_as_duplication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure save as actually creates a new person&quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;_saveasnew&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;John M&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/1/&#39;</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John M&#39;</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_save_as_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that &#39;save as&#39; is displayed when activated and after submitting</span>
<span class="sd">        invalid data aside save_as_new will not show us a form to overwrite the</span>
<span class="sd">        initial model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;save_as&#39;</span><span class="p">])</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;_saveasnew&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;John M&#39;</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;alive&#39;</span><span class="p">:</span><span class="s">&#39;checked&#39;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/1/&#39;</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;form_url&#39;</span><span class="p">],</span> <span class="s">&#39;/test_admin/admin/admin_views/person/add/&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CustomModelAdminTest</span><span class="p">(</span><span class="n">AdminViewBasicTest</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&quot;admin2&quot;</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSiteLoginForm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin2/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;customform&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;custom form error&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSiteLoginTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/login.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Hello from a custom login template&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSiteLogoutTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/logout/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/logout.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Hello from a custom logout template&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSiteIndexViewAndTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/index.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Hello from a custom index template *bar*&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSitePasswordChangeTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/password_change/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/password_change_form.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Hello from a custom password change form template&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSitePasswordChangeDoneTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/password_change/done/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/password_change_done.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Hello from a custom password change done template&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomAdminSiteView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/my_view/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&quot;Django is a magical pony!&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_perm</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">perm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the permission object, for the Model&quot;&quot;&quot;</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">ct</span><span class="p">,</span> <span class="n">codename</span><span class="o">=</span><span class="n">perm</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewPermissionsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tests for Admin Views Permissions.&quot;&quot;&quot;</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test setup.&quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Setup permissions, for our users who can add, change, and delete.
We can't put this into the fixture, because the content type id
and the permission id could be different on each run of the test.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">opts</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">_meta</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>User who can add Articles</p></td><td class="code"><div class="highlight"><pre>        <span class="n">add_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;adduser&#39;</span><span class="p">)</span>
        <span class="n">add_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">get_add_permission</span><span class="p">()))</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>User who can change Articles</p></td><td class="code"><div class="highlight"><pre>        <span class="n">change_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;changeuser&#39;</span><span class="p">)</span>
        <span class="n">change_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">get_change_permission</span><span class="p">()))</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>User who can delete Articles</p></td><td class="code"><div class="highlight"><pre>        <span class="n">delete_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;deleteuser&#39;</span><span class="p">)</span>
        <span class="n">delete_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Article</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">get_delete_permission</span><span class="p">()))</span>

        <span class="n">delete_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Section</span><span class="p">,</span>
            <span class="n">Section</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_delete_permission</span><span class="p">()))</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>login POST dicts</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super@example.com&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_email_bad_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super@example.com&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;notsecret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;adduser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;changeuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;deleteuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joepublic_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;joepublic&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_username_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">testLogin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure only staff members can log in.</span>

<span class="sd">        Successful posts to the login page will redirect to the orignal url.</span>
<span class="sd">        Unsuccessfull attempts will continue to render the login page with</span>
<span class="sd">        a 200 status code.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Super User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Test if user enters e-mail address</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&quot;Your e-mail address is not your username&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>only correct passwords get a username hint</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_bad_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;jondoe&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;super@example.com&#39;</span><span class="p">)</span>
        <span class="n">new_user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>check to ensure if there are multiple e-mail addresses a user doesn't get a 500</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>Add User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Change User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>Delete User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Regular User should not be able to login.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joepublic_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Requests without username should not return 500 errors.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_username_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;This field is required.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testLoginSuccessfullyRedirectsToOriginalUrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">query_string</span> <span class="o">=</span> <span class="s">&#39;the-answer=42&#39;</span>
        <span class="n">redirect_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">query_string</span>
        <span class="n">new_next</span> <span class="o">=</span> <span class="p">{</span><span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="n">redirect_url</span><span class="p">}</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">,</span> <span class="o">**</span><span class="n">new_next</span><span class="p">),</span> <span class="n">QUERY_STRING</span><span class="o">=</span><span class="n">query_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">redirect_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testAddView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test add view restricts access and actually adds items.&quot;&quot;&quot;</span>

        <span class="n">add_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="s">&#39;Døm ikke&#39;</span><span class="p">,</span>
                    <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;p&gt;great article&lt;/p&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2008-03-18&#39;</span><span class="p">,</span> <span class="s">&#39;date_1&#39;</span><span class="p">:</span> <span class="s">&#39;10:54:39&#39;</span><span class="p">,</span>
                    <span class="s">&#39;section&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>Change User should not have access to add articles</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>make sure the view removes test cookie</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">test_cookie_worked</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>Try POST just to make sure</p></td><td class="code"><div class="highlight"><pre>        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">,</span> <span class="n">add_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>Add user may login and POST to add view, then redirect to admin root</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span>
        <span class="n">addpage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">addpage</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">change_list_link</span> <span class="o">=</span> <span class="s">&#39;&amp;rsaquo; &lt;a href=&quot;/test_admin/admin/admin_views/article/&quot;&gt;Articles&lt;/a&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">change_list_link</span> <span class="ow">in</span> <span class="n">addpage</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                    <span class="s">&#39;User restricted to add permission is given link to change list view in breadcrumbs.&#39;</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">,</span> <span class="n">add_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Greetings from a created object&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>Super can add too, but is redirected to the change list view</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span>
        <span class="n">addpage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">addpage</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">change_list_link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">addpage</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                    <span class="s">&#39;Unrestricted user is not given link to change list view in breadcrumbs.&#39;</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span><span class="p">,</span> <span class="n">add_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/admin_views/article/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>8509 - if a normal user is already logged in, it is possible
to change user into the superuser without error</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;joepublic&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>Check and make sure that if user expires, data still persists</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>make sure the view removes test cookie</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">test_cookie_worked</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testChangeView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change view should restrict access and allow users to edit items.&quot;&quot;&quot;</span>

        <span class="n">change_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="s">&#39;Ikke fordømt&#39;</span><span class="p">,</span>
                       <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;p&gt;edited article&lt;/p&gt;&#39;</span><span class="p">,</span>
                       <span class="s">&#39;date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2008-03-18&#39;</span><span class="p">,</span> <span class="s">&#39;date_1&#39;</span><span class="p">:</span> <span class="s">&#39;10:54:39&#39;</span><span class="p">,</span>
                       <span class="s">&#39;section&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>add user shoud not be able to view the list of article or change any of them</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">,</span> <span class="n">change_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>change user can view all items and edit them</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">,</span> <span class="n">change_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/admin_views/article/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s">&#39;&lt;p&gt;edited article&lt;/p&gt;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>one error in form should produce singular error message, multiple errors plural</p></td><td class="code"><div class="highlight"><pre>        <span class="n">change_dict</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">,</span> <span class="n">change_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;Please correct the error below.&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&#39;Singular error message not found in response to post with one error&#39;</span><span class="p">)</span>

        <span class="n">change_dict</span><span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/&#39;</span><span class="p">,</span> <span class="n">change_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;Please correct the errors below.&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&#39;Plural error message not found in response to post with multiple errors&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>Test redirection when using row-level change permissions. Refs #11513.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;odd id&quot;</span><span class="p">)</span>
        <span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;even id&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">login_dict</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="n">login_dict</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;changed&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;odd id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;changed&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;changed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">login_dict</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">joepublic_login</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_username_login</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="n">login_dict</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;login-form&#39;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;changed&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;odd id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;login-form&#39;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;login-form&#39;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;changed again&#39;</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">RowLevelChangePermissionModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;changed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;login-form&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testConditionallyShowAddSectionLink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The foreign key widget should only show the &quot;add related&quot; button if the</span>
<span class="sd">        user has permission to add that related item.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>Set up and log in user.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/article/add/&#39;</span>
        <span class="n">add_link_text</span> <span class="o">=</span> <span class="s">&#39; class=&quot;add-another&quot;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>The add user can't add sections yet, so they shouldn't see the "add
section" link.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">add_link_text</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>Allow the add user to add sections too. Now they can see the "add
section" link.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">add_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;adduser&#39;</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="n">get_perm</span><span class="p">(</span><span class="n">Section</span><span class="p">,</span> <span class="n">Section</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_add_permission</span><span class="p">())</span>
        <span class="n">add_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">add_link_text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testCustomModelAdminTemplates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>Test custom change list template with custom extra context</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;var hello = &#39;Hello!&#39;;&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/change_list.html&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>Test custom add form template</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/add_form.html&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>Add an article so we can test delete, change, and history views</p></td><td class="code"><div class="highlight"><pre>        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;p&gt;great article&lt;/p&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;date_0&#39;</span><span class="p">:</span> <span class="s">&#39;2008-03-18&#39;</span><span class="p">,</span>
            <span class="s">&#39;date_1&#39;</span><span class="p">:</span> <span class="s">&#39;10:54:39&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/admin_views/customarticle/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">CustomArticle</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">article_pk</span> <span class="o">=</span> <span class="n">CustomArticle</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>Test custom delete, change, and object history templates
Test custom change form template</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">article_pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/change_form.html&#39;</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/</span><span class="si">%d</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">article_pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/delete_confirmation.html&#39;</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s">&#39;action&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;delete_selected&#39;</span><span class="p">],</span>
                <span class="s">&#39;_selected_action&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/delete_selected_confirmation.html&#39;</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/customarticle/</span><span class="si">%d</span><span class="s">/history/&#39;</span> <span class="o">%</span> <span class="n">article_pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;custom_admin/object_history.html&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testDeleteView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete view should restrict access and actually delete items.&quot;&quot;&quot;</span>

        <span class="n">delete_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span><span class="p">}</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>add user shoud not be able to delete articles</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/delete/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/delete/&#39;</span><span class="p">,</span> <span class="n">delete_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">403</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>Delete user can delete</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/section/1/delete/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>test response contains link to related Article</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;admin_views/article/1/&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/delete/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/article/1/delete/&#39;</span><span class="p">,</span> <span class="n">delete_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">post</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Greetings from a deleted object&#39;</span><span class="p">)</span>
        <span class="n">article_ct</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Article</span><span class="p">)</span>
        <span class="n">logged</span> <span class="o">=</span> <span class="n">LogEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">article_ct</span><span class="p">,</span> <span class="n">action_flag</span><span class="o">=</span><span class="n">DELETION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">logged</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testDisabledPermissionsWhenLoggedIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="n">superuser</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">)</span>
        <span class="n">superuser</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">superuser</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;login-form&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Log out&#39;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;login-form&quot;&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewsNoUrlTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Regression test for #17333&quot;&quot;&quot;</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>User who can change Reports</p></td><td class="code"><div class="highlight"><pre>        <span class="n">change_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;changeuser&#39;</span><span class="p">)</span>
        <span class="n">change_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Report</span><span class="p">,</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">get_change_permission</span><span class="p">()))</span></pre></div></td></tr>


<tr id="section-64"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-64">&#182;</a></div><p>login POST dict</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;changeuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">test_no_standard_modeladmin_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Admin index views don&#39;t break when user&#39;s ModelAdmin removes standard urls&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-65"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-65">&#182;</a></div><p>we shouldn' get an 500 error caused by a NoReverseMatch</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewDeletedObjectsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;deleted-objects.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_nesting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Objects should be nested to display the relationships that</span>
<span class="sd">        cause them to be scheduled for deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;&lt;li&gt;Plot: &lt;a href=&quot;.+/admin_views/plot/1/&quot;&gt;World Domination&lt;/a&gt;\s*&lt;ul&gt;\s*&lt;li&gt;Plot details: &lt;a href=&quot;.+/admin_views/plotdetails/1/&quot;&gt;almost finished&lt;/a&gt;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_cyclic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cyclic relationships should still cause each object to only be</span>
<span class="sd">        listed once.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">one</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Cyclic one: &lt;a href=&quot;/test_admin/admin/admin_views/cyclicone/1/&quot;&gt;I am recursive&lt;/a&gt;&quot;&quot;&quot;</span>
        <span class="n">two</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Cyclic two: &lt;a href=&quot;/test_admin/admin/admin_views/cyclictwo/1/&quot;&gt;I am recursive too&lt;/a&gt;&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/cyclicone/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_perms_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">delete_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;deleteuser&#39;</span><span class="p">)</span>
        <span class="n">delete_user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">get_perm</span><span class="p">(</span><span class="n">Plot</span><span class="p">,</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_delete_permission</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;deleteuser&#39;</span><span class="p">,</span>
                                          <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/plot/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;your account doesn&#39;t have permission to delete the following types of objects&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;li&gt;plot details&lt;/li&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_protected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;Why?&quot;</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">Answer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="s">&quot;Because.&quot;</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">Answer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="s">&quot;Yes.&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/question/</span><span class="si">%s</span><span class="s">/delete/&quot;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;would require deleting the following protected related objects&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;Answer: &lt;a href=&quot;/test_admin/admin/admin_views/answer/</span><span class="si">%s</span><span class="s">/&quot;&gt;Because.&lt;/a&gt;&lt;/li&gt;&#39;</span> <span class="o">%</span> <span class="n">a1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;Answer: &lt;a href=&quot;/test_admin/admin/admin_views/answer/</span><span class="si">%s</span><span class="s">/&quot;&gt;Yes.&lt;/a&gt;&lt;/li&gt;&#39;</span> <span class="o">%</span> <span class="n">a2</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_not_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Secret hideout: underground bunker&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_fkeys_to_same_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a deleted object has two relationships from another model,</span>
<span class="sd">        both of those should be followed in looking for related</span>
<span class="sd">        objects to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Plot: &lt;a href=&quot;/test_admin/admin/admin_views/plot/1/&quot;&gt;World Domination&lt;/a&gt;&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_fkeys_to_same_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a deleted object has two relationships pointing to it from</span>
<span class="sd">        another object, the other object should still only be listed</span>
<span class="sd">        once.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Plot: &lt;a href=&quot;/test_admin/admin/admin_views/plot/2/&quot;&gt;World Peace&lt;/a&gt;&lt;/li&gt;&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In the case of an inherited model, if either the child or</span>
<span class="sd">        parent-model instance is deleted, both instances are listed</span>
<span class="sd">        for deletion, as well as any relationships they have.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;Villain: &lt;a href=&quot;/test_admin/admin/admin_views/villain/3/&quot;&gt;Bob&lt;/a&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;Super villain: &lt;a href=&quot;/test_admin/admin/admin_views/supervillain/3/&quot;&gt;Bob&lt;/a&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;Secret hideout: floating castle&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;Super secret hideout: super floating castle!&quot;&quot;&quot;</span>
            <span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/villain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">should</span> <span class="ow">in</span> <span class="n">should_contain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/supervillain/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">should</span> <span class="ow">in</span> <span class="n">should_contain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_generic_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a deleted object has GenericForeignKeys pointing to it,</span>
<span class="sd">        those objects should be listed for deletion.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">FunkyTag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content_object</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;hott&#39;</span><span class="p">)</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;li&gt;Funky tag: hott&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/plot/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewStringPrimaryKeyTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;string-primary-key.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AdminViewStringPrimaryKeyTest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pk</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890 -_.!~*&#39;() ;/?:@&amp;=+$, &lt;&gt;#%&quot; {}|\^[]`&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="n">content_type_pk</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">ModelWithStringPrimaryKey</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">LogEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">log_action</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">content_type_pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">change_message</span><span class="o">=</span><span class="s">&#39;Changed something&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_get_history_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieving the history for an object using urlencoded form of primary</span>
<span class="sd">        key should work.</span>
<span class="sd">        Refs #12349, #18550.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/history/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Changed something&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Retrieving the object using urlencoded form of primary key should work&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_changelist_to_changeform_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;The link from the changelist referring to the changeform of the object should be quoted&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/&#39;</span><span class="p">)</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;th&gt;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">/&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&lt;/th&gt;&lt;/tr&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)),</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_recentactions_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;The link from the recent actions list referring to the changeform of the object should be quoted&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;a href=&quot;admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)),</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_recentactions_without_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;If a LogEntry is missing content_type it will not display it in span tag under the hyperlink.&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;a href=&quot;admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)),</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;Model with string primary key&quot;</span> <span class="c"># capitalized in Recent Actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>
        <span class="n">logentry</span> <span class="o">=</span> <span class="n">LogEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">content_type__name__iexact</span><span class="o">=</span><span class="n">should_contain</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-66"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-66">&#182;</a></div><p>http://code.djangoproject.com/ticket/10275
if the log entry doesn't have a content type it should still be
possible to view the Recent Actions part</p></td><td class="code"><div class="highlight"><pre>        <span class="n">logentry</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">logentry</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">counted_presence_before</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">should_contain</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="n">counted_presence_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">should_contain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counted_presence_before</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">counted_presence_after</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_deleteconfirmation_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;The link from the delete confirmation page referring back to the changeform of the object should be quoted&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/delete/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-67"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-67">&#182;</a></div><p>this URL now comes through reverse(), thus iri<em>to</em>uri encoding</p></td><td class="code"><div class="highlight"><pre>        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;/</span><span class="si">%s</span><span class="s">/&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">escape</span><span class="p">(</span><span class="n">iri_to_uri</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))),</span> <span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_url_conflicts_with_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with a primary key that ends with add should be visible&quot;</span>
        <span class="n">add_model</span> <span class="o">=</span> <span class="n">ModelWithStringPrimaryKey</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="s">&quot;i have something to add&quot;</span><span class="p">)</span>
        <span class="n">add_model</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">add_model</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;h1&gt;Change model with string primary key&lt;/h1&gt;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_url_conflicts_with_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with a primary key that ends with delete should be visible&quot;</span>
        <span class="n">delete_model</span> <span class="o">=</span> <span class="n">ModelWithStringPrimaryKey</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="s">&quot;delete&quot;</span><span class="p">)</span>
        <span class="n">delete_model</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">delete_model</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;h1&gt;Change model with string primary key&lt;/h1&gt;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_url_conflicts_with_history</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with a primary key that ends with history should be visible&quot;</span>
        <span class="n">history_model</span> <span class="o">=</span> <span class="n">ModelWithStringPrimaryKey</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="s">&quot;history&quot;</span><span class="p">)</span>
        <span class="n">history_model</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">history_model</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;h1&gt;Change model with string primary key&lt;/h1&gt;&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_shortcut_view_with_escaping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;&#39;View on site should&#39; work properly with char fields&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ModelWithStringPrimaryKey</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="s">&#39;abc_123&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/modelwithstringprimarykey/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">should_contain</span> <span class="o">=</span> <span class="s">&#39;/</span><span class="si">%s</span><span class="s">/&quot; class=&quot;viewsitelink&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">pk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">should_contain</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">SecureViewTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-68"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-68">&#182;</a></div><p>login POST dicts</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super@example.com&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_email_bad_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;super@example.com&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;notsecret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;adduser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;changeuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;deleteuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joepublic_login</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">LOGIN_FORM_KEY</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;joepublic&#39;</span><span class="p">,</span>
            <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;secret&#39;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_secure_view_shows_login_if_not_logged_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Ensure that we see the login form&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;admin/login.html&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_secure_view_login_successfully_redirects_to_original_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">query_string</span> <span class="o">=</span> <span class="s">&#39;the-answer=42&#39;</span>
        <span class="n">redirect_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/secure-view/?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">query_string</span>
        <span class="n">new_next</span> <span class="o">=</span> <span class="p">{</span><span class="n">REDIRECT_FIELD_NAME</span><span class="p">:</span> <span class="n">redirect_url</span><span class="p">}</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">,</span> <span class="o">**</span><span class="n">new_next</span><span class="p">),</span> <span class="n">QUERY_STRING</span><span class="o">=</span><span class="n">query_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">redirect_url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_staff_member_required_decorator_works_as_per_admin_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure only staff members can log in.</span>

<span class="sd">        Successful posts to the login page will redirect to the orignal url.</span>
<span class="sd">        Unsuccessfull attempts will continue to render the login page with</span>
<span class="sd">        a 200 status code.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-69"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-69">&#182;</a></div><p>Super User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-70"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-70">&#182;</a></div><p>make sure the view removes test cookie</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">test_cookie_worked</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-71"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-71">&#182;</a></div><p>Test if user enters e-mail address</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&quot;Your e-mail address is not your username&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-72"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-72">&#182;</a></div><p>only correct passwords get a username hint</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_bad_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;jondoe&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;super@example.com&#39;</span><span class="p">)</span>
        <span class="n">new_user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-73"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-73">&#182;</a></div><p>check to ensure if there are multiple e-mail addresses a user doesn't get a 500</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_email_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-74"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-74">&#182;</a></div><p>Add User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adduser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-75"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-75">&#182;</a></div><p>Change User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeuser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-76"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-76">&#182;</a></div><p>Delete User</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteuser_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-77"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-77">&#182;</a></div><p>Regular User should not be able to login.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joepublic_login</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">login</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-78"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-78">&#182;</a></div><p>Login.context is a list of context dicts we just need to check the first one.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">ERROR_MESSAGE</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-79"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-79">&#182;</a></div><p>8509 - if a normal user is already logged in, it is possible
to change user into the superuser without error</p></td><td class="code"><div class="highlight"><pre>        <span class="n">login</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;joepublic&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-80"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-80">&#182;</a></div><p>Check and make sure that if user expires, data still persists</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/secure-view/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_login</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-81"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-81">&#182;</a></div><p>make sure the view removes test cookie</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">test_cookie_worked</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_shortcut_view_only_available_to_staff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only admin users should be able to use the admin shortcut view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_ctype</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">)</span>
        <span class="n">shortcut_url</span> <span class="o">=</span> <span class="s">&quot;/test_admin/admin/r/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user_ctype</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-82"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-82">&#182;</a></div><p>Not logged in: we should see the login page.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shortcut_url</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;admin/login.html&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-83"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-83">&#182;</a></div><p>Logged in? Redirect.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shortcut_url</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-84"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-84">&#182;</a></div><p>Can't use self.assertRedirects() because User.get<em>absolute</em>url() is silly.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Location&#39;</span><span class="p">],</span> <span class="s">&#39;http://example.com/users/super/&#39;</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewUnicodeTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-unicode.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testUnicodeEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A test to ensure that POST on edit_view handles non-ascii characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test lærdommer&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-85"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-85">&#182;</a></div><p>inline data</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;chapter_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;6&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-0-title&quot;</span><span class="p">:</span> <span class="s">&quot;Norske bostaver æøå skaper problemer&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-0-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;Svært frustrerende med UnicodeDecodeError&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-1-title&quot;</span><span class="p">:</span> <span class="s">&quot;Kjærlighet.&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-1-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;La kjærligheten til de lidende seire.&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-2-title&quot;</span><span class="p">:</span> <span class="s">&quot;Need a title.&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-2-content&quot;</span><span class="p">:</span> <span class="s">&quot;&amp;lt;p&amp;gt;Newest content&amp;lt;/p&amp;gt;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-3-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-3-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-3-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-4-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-4-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-4-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-5-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-5-title&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;chapter_set-5-content&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/book/1/&#39;</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span>

    <span class="k">def</span> <span class="nf">testUnicodeDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the delete_view handles non-ascii characters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delete_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/book/1/delete/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/book/1/delete/&#39;</span><span class="p">,</span> <span class="n">delete_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/admin_views/book/&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewListEditable</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-person.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;This Week in Django&quot;</span><span class="p">,</span>
            <span class="n">release_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/podcast/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inheritance_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Vodcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;This Week in Django&quot;</span><span class="p">,</span> <span class="n">released</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/vodcast/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_custom_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Language</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">iso</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;English&#39;</span><span class="p">,</span> <span class="n">english_name</span><span class="o">=</span><span class="s">&#39;English&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/language/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_changelist_input_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-86"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-86">&#182;</a></div><p>2 inputs per object(the field and the hidden id field) = 6
3 management hidden fields = 3
4 action inputs (3 regular checkboxes, 1 checkbox to select all)
main form submit button = 1
search field and search submit button = 2
CSRF field = 1
field to track 'select all' across paginated views = 1
6 + 3 + 4 + 1 + 2 + 1 + 1 = 18 inputs</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;input&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-87"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-87">&#182;</a></div><p>1 select per object = 3 selects</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;select&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_post_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-88"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-88">&#182;</a></div><p>Ticket 12707: Saving inline editable should not show admin
action warnings</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span>
                                    <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;messages&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_post_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Mauchly&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Grace Hopper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-89"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-89">&#182;</a></div><p>test a filtered page</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/?gender__exact=1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Mauchly&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-90"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-90">&#182;</a></div><p>test a searched page</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/?q=john&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Mauchly&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_non_field_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Ensure that non field errors are displayed for each of the</span>
<span class="sd">            forms in the changelist&#39;s formset. Refs #13126.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fd1</span> <span class="o">=</span> <span class="n">FoodDelivery</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="s">&#39;123&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">&#39;bill&#39;</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="s">&#39;thai&#39;</span><span class="p">)</span>
        <span class="n">fd2</span> <span class="o">=</span> <span class="n">FoodDelivery</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="s">&#39;456&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">&#39;bill&#39;</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="s">&#39;india&#39;</span><span class="p">)</span>
        <span class="n">fd3</span> <span class="o">=</span> <span class="n">FoodDelivery</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="s">&#39;789&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s">&#39;bill&#39;</span><span class="p">,</span> <span class="n">restaurant</span><span class="o">=</span><span class="s">&#39;pizza&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-0-reference&quot;</span><span class="p">:</span> <span class="s">&quot;123&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;thai&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-91"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-91">&#182;</a></div><p>Same data as above: Forbidden because of unique_together!</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-1-reference&quot;</span><span class="p">:</span> <span class="s">&quot;456&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;thai&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-2-reference&quot;</span><span class="p">:</span> <span class="s">&quot;789&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;pizza&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/fooddelivery/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;tr&gt;&lt;td colspan=&quot;4&quot;&gt;&lt;ul class=&quot;errorlist&quot;&gt;&lt;li&gt;Food delivery with this Driver and Restaurant already exists.&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-0-reference&quot;</span><span class="p">:</span> <span class="s">&quot;123&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;thai&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-92"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-92">&#182;</a></div><p>Same data as above: Forbidden because of unique_together!</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-1-reference&quot;</span><span class="p">:</span> <span class="s">&quot;456&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;thai&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-93"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-93">&#182;</a></div><p>Same data also.</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;form-2-reference&quot;</span><span class="p">:</span> <span class="s">&quot;789&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-driver&quot;</span><span class="p">:</span> <span class="s">&quot;bill&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-restaurant&quot;</span><span class="p">:</span> <span class="s">&quot;thai&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/fooddelivery/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;tr&gt;&lt;td colspan=&quot;4&quot;&gt;&lt;ul class=&quot;errorlist&quot;&gt;&lt;li&gt;Food delivery with this Driver and Restaurant already exists.&lt;/li&gt;&lt;/ul&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_non_form_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-94"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-94">&#182;</a></div><p>test if non-form errors are handled; ticket #12716</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-alive&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-95"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-95">&#182;</a></div><p>Ensure that the form processing understands this as a list_editable "Save"
and not an action "Go".</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;Grace is not a Zombie&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_non_form_errors_is_errorlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-96"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-96">&#182;</a></div><p>test if non-form errors are correctly handled; ticket #12878</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-alive&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">non_form_errors</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">non_form_errors</span><span class="p">,</span> <span class="n">ErrorList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">non_form_errors</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">ErrorList</span><span class="p">([</span><span class="s">&quot;Grace is not a Zombie&quot;</span><span class="p">])))</span>

    <span class="k">def</span> <span class="nf">test_list_editable_ordering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">collector</span> <span class="o">=</span> <span class="n">Collector</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Frederick Clegg&quot;</span><span class="p">)</span>

        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="n">collector</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-97"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-97">&#182;</a></div><p>NB: The order values must be changed so that the items are reordered.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-order&quot;</span><span class="p">:</span> <span class="s">&quot;14&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-order&quot;</span><span class="p">:</span> <span class="s">&quot;13&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-order&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-3-order&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-3-id&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-3-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-98"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-98">&#182;</a></div><p>Ensure that the form processing understands this as a list_editable "Save"
and not an action "Go".</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/category/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-99"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-99">&#182;</a></div><p>Successful post will redirect</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-100"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-100">&#182;</a></div><p>Check that the order values have been applied to the right objects</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_list_editable_pagination</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that pagination works for list_editable items.</span>
<span class="sd">        Refs #16819.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">UnorderedObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Unordered object #1&#39;</span><span class="p">)</span>
        <span class="n">UnorderedObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Unordered object #2&#39;</span><span class="p">)</span>
        <span class="n">UnorderedObject</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Unordered object #3&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/unorderedobject/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #1&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/unorderedobject/?p=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Unordered object #1&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_list_editable_action_submit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-101"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-101">&#182;</a></div><p>List editable changes should not be executed if the action "Go" button is
used to submit the form.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>

            <span class="s">&quot;index&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;_selected_action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;3&#39;</span><span class="p">],</span>
            <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Mauchly&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Grace Hopper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_list_editable_action_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-102"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-102">&#182;</a></div><p>List editable changes should be executed if the "Save" button is
used to submit the form - any action choices should be ignored.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-0-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-1-gender&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>

            <span class="s">&quot;form-2-alive&quot;</span><span class="p">:</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-gender&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;form-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>

            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
            <span class="s">&quot;_selected_action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">],</span>
            <span class="s">&quot;action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;John Mauchly&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alive</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Grace Hopper&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_list_editable_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fields should not be list-editable in popups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">list_editable</span><span class="p">,</span> <span class="p">())</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">IS_POPUP_VAR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">list_editable</span><span class="p">,</span> <span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_pk_hidden_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Ensure that hidden pk fields aren&#39;t displayed in the table body and</span>
<span class="sd">            that their corresponding human-readable value is displayed instead.</span>
<span class="sd">            Note that the hidden pk fields are in fact be displayed but</span>
<span class="sd">            separately (not in the table), and only once.</span>
<span class="sd">            Refs #12475.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">story1</span> <span class="o">=</span> <span class="n">Story</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The adventures of Guido&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;Once upon a time in Djangoland...&#39;</span><span class="p">)</span>
        <span class="n">story2</span> <span class="o">=</span> <span class="n">Story</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Crouching Tiger, Hidden Python&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;The Python was sneaking into...&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/story/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;id_form-0-id&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Only one hidden field, in a separate place than the table.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;id_form-1-id&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;hiddenfields&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-0-id&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-1-id&quot; /&gt;</span><span class="se">\n</span><span class="s">&lt;/div&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">story2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">story1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;td&gt;</span><span class="si">%d</span><span class="s">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="n">story1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;td&gt;</span><span class="si">%d</span><span class="s">&lt;/td&gt;&#39;</span> <span class="o">%</span> <span class="n">story2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_pk_hidden_fields_with_list_display_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Similarly as test_pk_hidden_fields, but when the hidden pk fields are</span>
<span class="sd">            referenced in list_display_links.</span>
<span class="sd">            Refs #12475.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">story1</span> <span class="o">=</span> <span class="n">OtherStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;The adventures of Guido&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;Once upon a time in Djangoland...&#39;</span><span class="p">)</span>
        <span class="n">story2</span> <span class="o">=</span> <span class="n">OtherStory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Crouching Tiger, Hidden Python&#39;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;The Python was sneaking into...&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/otherstory/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;id_form-0-id&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Only one hidden field, in a separate place than the table.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;id=&quot;id_form-1-id&quot;&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;hiddenfields&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-0-id&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-1-id&quot; /&gt;</span><span class="se">\n</span><span class="s">&lt;/div&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">story2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">story1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;th&gt;&lt;a href=&quot;</span><span class="si">%d</span><span class="s">/&quot;&gt;</span><span class="si">%d</span><span class="s">&lt;/a&gt;&lt;/th&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">story1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">story1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;th&gt;&lt;a href=&quot;</span><span class="si">%d</span><span class="s">/&quot;&gt;</span><span class="si">%d</span><span class="s">&lt;/a&gt;&lt;/th&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">story2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">story2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminSearchTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users&#39;</span><span class="p">,</span> <span class="s">&#39;multiple-child-classes&#39;</span><span class="p">,</span>
                <span class="s">&#39;admin-views-person&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_search_on_sibling_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check that a search that mentions sibling models&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/recommendation/?q=bar&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-103"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-103">&#182;</a></div><p>confirm the search returned 1 object</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1 recommendation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_with_fk_to_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that the to_field GET parameter is preserved when a search</span>
<span class="sd">        is performed. Refs #10918.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.contrib.admin.views.main</span> <span class="kn">import</span> <span class="n">TO_FIELD_VAR</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/?q=joe&amp;</span><span class="si">%s</span><span class="s">=username&#39;</span> <span class="o">%</span> <span class="n">TO_FIELD_VAR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1 user</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;input type=&quot;hidden&quot; name=&quot;t&quot; value=&quot;username&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_exact_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/recommendation/?q=bar&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-104"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-104">&#182;</a></div><p>confirm the search returned one object</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1 recommendation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/recommendation/?q=ba&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-105"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-105">&#182;</a></div><p>confirm the search returned zero objects</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">0 recommendations</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_beginning_matches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/?q=Gui&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-106"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-106">&#182;</a></div><p>confirm the search returned one object</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1 person</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;Guido&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/person/?q=uido&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-107"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-107">&#182;</a></div><p>confirm the search returned zero objects</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">0 persons</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;Guido&quot;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminInheritedInlinesTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testInline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Ensure that inline models which inherit from a common parent are correctly handled by admin.&quot;</span>

        <span class="n">foo_user</span> <span class="o">=</span> <span class="s">&quot;foo username&quot;</span>
        <span class="n">bar_user</span> <span class="o">=</span> <span class="s">&quot;bar username&quot;</span>

        <span class="n">name_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;name=&quot;(.*?)&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-108"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-108">&#182;</a></div><p>test the add case</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/persona/add/&#39;</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">name_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-109"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-109">&#182;</a></div><p>make sure we have no duplicate HTML names</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span></pre></div></td></tr>


<tr id="section-110"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-110">&#182;</a></div><p>test the add case</p></td><td class="code"><div class="highlight"><pre>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Name&quot;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-111"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-111">&#182;</a></div><p>inline data</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&quot;accounts-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-0-username&quot;</span><span class="p">:</span> <span class="n">foo_user</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-0-username&quot;</span><span class="p">:</span> <span class="n">bar_user</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/persona/add/&#39;</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FooAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">BarAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FooAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">foo_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">BarAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">bar_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">persona_id</span> <span class="o">=</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="n">foo_id</span> <span class="o">=</span> <span class="n">FooAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="n">bar_id</span> <span class="o">=</span> <span class="n">BarAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span></pre></div></td></tr>


<tr id="section-112"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-112">&#182;</a></div><p>test the edit case</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/persona/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">persona_id</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">name_re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-113"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-113">&#182;</a></div><p>make sure we have no duplicate HTML names</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>

        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Name&quot;</span><span class="p">,</span>

            <span class="s">&quot;accounts-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;accounts-0-username&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-1&quot;</span> <span class="o">%</span> <span class="n">foo_user</span><span class="p">,</span>
            <span class="s">&quot;accounts-0-account_ptr&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">foo_id</span><span class="p">),</span>
            <span class="s">&quot;accounts-0-persona&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">persona_id</span><span class="p">),</span>

            <span class="s">&quot;accounts-2-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;accounts-2-0-username&quot;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-1&quot;</span> <span class="o">%</span> <span class="n">bar_user</span><span class="p">,</span>
            <span class="s">&quot;accounts-2-0-account_ptr&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bar_id</span><span class="p">),</span>
            <span class="s">&quot;accounts-2-0-persona&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">persona_id</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/persona/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">persona_id</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FooAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">BarAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FooAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-1&quot;</span> <span class="o">%</span> <span class="n">foo_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">BarAccount</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-1&quot;</span> <span class="o">%</span> <span class="n">bar_user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminActionsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-actions.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_model_admin_custom_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests a custom action defined in a ModelAdmin method&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;mail_admin&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Greetings from a ModelAdmin action&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_model_admin_default_delete_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests the default delete action defined as a ModelAdmin method&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">delete_confirmation_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">,</span>
            <span class="s">&#39;post&#39;</span><span class="p">:</span> <span class="s">&#39;yes&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">confirmation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">confirmation</span><span class="p">,</span> <span class="n">TemplateResponse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">confirmation</span><span class="p">,</span> <span class="s">&quot;Are you sure you want to delete the selected subscribers?&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">confirmation</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ACTION_CHECKBOX_NAME</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">delete_confirmation_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_non_localized_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If USE_THOUSAND_SEPARATOR is set, make sure that the ids for</span>
<span class="sd">        the objects selected for deletion are rendered without separators.</span>
<span class="sd">        Refs #14895.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">subscriber</span> <span class="o">=</span> <span class="n">Subscriber</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">subscriber</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">9999</span>
        <span class="n">subscriber</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">9999</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTemplateUsed</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;admin/delete_selected_confirmation.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;value=&quot;9999&quot;&#39;</span><span class="p">)</span> <span class="c"># Instead of 9,999</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;value=&quot;2&quot;&#39;</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_THOUSAND_SEPARATOR</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span>

    <span class="k">def</span> <span class="nf">test_model_admin_default_delete_action_protected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the default delete action defined as a ModelAdmin method in the</span>
<span class="sd">        case where some related objects are protected from deletion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;Why?&quot;</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">Answer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">q1</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="s">&quot;Because.&quot;</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">Answer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="n">q1</span><span class="p">,</span> <span class="n">answer</span><span class="o">=</span><span class="s">&quot;Yes.&quot;</span><span class="p">)</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question</span><span class="o">=</span><span class="s">&quot;Wherefore?&quot;</span><span class="p">)</span>

        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="n">q1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">q2</span><span class="o">.</span><span class="n">pk</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&quot;/test_admin/admin/admin_views/question/&quot;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;would require deleting the following protected related objects&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;Answer: &lt;a href=&quot;/test_admin/admin/admin_views/answer/</span><span class="si">%s</span><span class="s">/&quot;&gt;Because.&lt;/a&gt;&lt;/li&gt;&#39;</span> <span class="o">%</span> <span class="n">a1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;Answer: &lt;a href=&quot;/test_admin/admin/admin_views/answer/</span><span class="si">%s</span><span class="s">/&quot;&gt;Yes.&lt;/a&gt;&lt;/li&gt;&#39;</span> <span class="o">%</span> <span class="n">a2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_custom_function_mail_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests a custom action defined in a function&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;external_mail&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/externalsubscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Greetings from a function action&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_custom_function_action_with_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests a custom action defined in a function&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;redirect_to&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/externalsubscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_default_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that actions which don&#39;t return an HttpResponse are redirected to</span>
<span class="sd">        the same page, retaining the querystring (which may contain changelist</span>
<span class="sd">        information).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;external_mail&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/externalsubscriber/?o=1&#39;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_actions_ordering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that actions are ordered as expected.</span>
<span class="sd">        Refs #15964.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/externalsubscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&#39;&#39;&lt;label&gt;Action: &lt;select name=&quot;action&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;delete_selected&quot;&gt;Delete selected external subscribers&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;redirect_to&quot;&gt;Redirect to (Awesome action)&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;external_mail&quot;&gt;External mail (Another awesome action)&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_model_without_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests a ModelAdmin without any action&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/oldsubscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;action_form&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;input type=&quot;checkbox&quot; class=&quot;action-select&quot;&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&quot;Found an unexpected action toggle checkboxbox in response&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;input type=&quot;checkbox&quot; class=&quot;action-select&quot;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_model_without_action_still_has_jquery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests that a ModelAdmin without any actions still gets jQuery included in page&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/oldsubscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;action_form&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;jquery.min.js&#39;</span><span class="p">,</span>
            <span class="n">msg_prefix</span><span class="o">=</span><span class="s">&quot;jQuery missing from admin pages for model with no admin actions&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_action_column_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Tests that the checkbox column class is present in the response&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;action_form&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;action-checkbox-column&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_actions_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that actions come from the form whose submit button was pressed (#10618).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span></pre></div></td></tr>


<tr id="section-114"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-114">&#182;</a></div><p>Two different actions selected on the two forms...</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;action&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;external_mail&#39;</span><span class="p">,</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">],</span></pre></div></td></tr>


<tr id="section-115"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-115">&#182;</a></div><p>...but we clicked "go" on the top form.</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/externalsubscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-116"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-116">&#182;</a></div><p>Send mail, don't delete.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="s">&#39;Greetings from a function action&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_user_message_on_none_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User should see a warning when &#39;Go&#39; is pressed and no items are selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;delete_selected&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Items must be selected in order to perform actions on them. No items have been changed.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_user_message_on_no_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User should see a warning when &#39;Go&#39; is pressed and no action is selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ACTION_CHECKBOX_NAME</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
            <span class="s">&#39;action&#39;</span> <span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;No action selected.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Subscriber</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_selection_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the selection counter is there.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;0 of 2 selected&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_popup_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Actions should not be shown in popups. &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/subscriber/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEquals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;action_form&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;/test_admin/admin/admin_views/subscriber/?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">IS_POPUP_VAR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&quot;action_form&quot;</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">TestCustomChangeList</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>
    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&#39;admin&#39;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_custom_changelist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that a custom ChangeList class can be used (#9749)</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-117"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-117">&#182;</a></div><p>Insert some data</p></td><td class="code"><div class="highlight"><pre>        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;First Gadget&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/gadget/add/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span> <span class="c"># redirect somewhere</span></pre></div></td></tr>


<tr id="section-118"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-118">&#182;</a></div><p>Hit the page once to get messages out of the queue message list</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/gadget/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-119"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-119">&#182;</a></div><p>Ensure that that data is still not visible on the page</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/gadget/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;First Gadget&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">TestInlineNotEditable</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        InlineModelAdmin broken?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/parent/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminCustomQuerysetTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pks</span> <span class="o">=</span> <span class="p">[</span><span class="n">EmptyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">()</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">test_changelist_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/emptymodel/&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Primary key = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;Primary key = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pks</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/emptymodel/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_add_model_modeladmin_only_qs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-120"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-120">&#182;</a></div><p>only() is used in ModelAdmin.queryset()</p></td><td class="code"><div class="highlight"><pre>        <span class="n">p</span> <span class="o">=</span> <span class="n">Paper</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;My Paper Title&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Paper</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/paper/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;My Modified Paper Title&quot;</span><span class="p">,</span>
            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/paper/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">post_data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-121"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-121">&#182;</a></div><p>Message should contain non-ugly model name. Instance representation is set by unicode() (ugly)</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li class=&quot;info&quot;&gt;The paper &amp;quot;Paper_Deferred_author object&amp;quot; was changed successfully.&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-122"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-122">&#182;</a></div><p>defer() is used in ModelAdmin.queryset()</p></td><td class="code"><div class="highlight"><pre>        <span class="n">cl</span> <span class="o">=</span> <span class="n">CoverLetter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">CoverLetter</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/coverletter/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">cl</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;author&quot;</span><span class="p">:</span> <span class="s">&quot;John Doe II&quot;</span><span class="p">,</span>
            <span class="s">&quot;_save&quot;</span><span class="p">:</span> <span class="s">&quot;Save&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/coverletter/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">cl</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                <span class="n">post_data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-123"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-123">&#182;</a></div><p>Message should contain non-ugly model name. Instance representation is set by model's <strong>unicode</strong>()</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li class=&quot;info&quot;&gt;The cover letter &amp;quot;John Doe II&amp;quot; was changed successfully.&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminInlineFileUploadTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-actions.xml&#39;</span><span class="p">]</span>
    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&#39;admin&#39;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-124"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-124">&#182;</a></div><p>Set up test Picture and Gallery.
These must be set up here instead of in fixtures in order to allow Picture
to use a NamedTemporaryFile.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">tdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
        <span class="n">file1</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s">&quot;.file1&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">tdir</span><span class="p">)</span>
        <span class="n">file1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;a&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">21</span><span class="p">))</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file1</span><span class="o">.</span><span class="n">name</span>
        <span class="n">file1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gallery</span> <span class="o">=</span> <span class="n">Gallery</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Test Gallery&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gallery</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">Picture</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Test Picture&quot;</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">gallery</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gallery</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_inline_file_upload_edit_validation_error_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that inline file uploads correctly display prior data (#10002).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Gallery&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-0-id&quot;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;pictures-0-gallery&quot;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gallery</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;pictures-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Picture&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-0-image&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-1-gallery&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gallery</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&quot;pictures-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Picture 2&quot;</span><span class="p">,</span>
            <span class="s">&quot;pictures-1-image&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/gallery/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gallery</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">_container</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Currently:&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminInlineTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Test Name&quot;</span><span class="p">,</span>

            <span class="s">&quot;widget_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-0-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-1-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-2-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;widget_set-2-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>

            <span class="s">&quot;doohickey_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-0-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-0-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-1-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-1-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-2-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-2-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;doohickey_set-2-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>

            <span class="s">&quot;grommet_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-0-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-0-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-1-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-1-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-2-code&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-2-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;grommet_set-2-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>

            <span class="s">&quot;whatsit_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-0-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-0-index&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-1-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-1-index&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-2-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-2-index&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;whatsit_set-2-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>

            <span class="s">&quot;fancydoodad_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-0-doodad_ptr&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-0-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-0-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-0-expensive&quot;</span><span class="p">:</span> <span class="s">&quot;on&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-1-doodad_ptr&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-1-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-1-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-1-expensive&quot;</span><span class="p">:</span> <span class="s">&quot;on&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-2-doodad_ptr&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-2-owner&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-2-name&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;fancydoodad_set-2-expensive&quot;</span><span class="p">:</span> <span class="s">&quot;on&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-0-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-0-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-1-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-1-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-2-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-2-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span> <span class="o">=</span> <span class="n">Collector</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John Fowles&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_simple_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A simple model can be saved as inlines&quot;</span></pre></div></td></tr>


<tr id="section-125"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-125">&#182;</a></div><p>First add a new inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Widget 1&quot;</span>
        <span class="n">collector_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/collector/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Widget 1&quot;</span><span class="p">)</span>
        <span class="n">widget_id</span> <span class="o">=</span> <span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span></pre></div></td></tr>


<tr id="section-126"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-126">&#182;</a></div><p>Check that the PK link exists on the rendered form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collector_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;widget_set-0-id&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-127"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-127">&#182;</a></div><p>Now resave that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-0-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">widget_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Widget 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Widget 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-128"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-128">&#182;</a></div><p>Now modify that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-0-id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">widget_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;widget_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Widget 1 Updated&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Widget</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Widget 1 Updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_explicit_autofield_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with an explicit autofield primary key can be saved as inlines. Regression for #8093&quot;</span></pre></div></td></tr>


<tr id="section-129"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-129">&#182;</a></div><p>First add a new inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Grommet 1&quot;</span>
        <span class="n">collector_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/collector/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Grommet 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-130"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-130">&#182;</a></div><p>Check that the PK link exists on the rendered form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collector_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;grommet_set-0-code&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-131"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-131">&#182;</a></div><p>Now resave that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-0-code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Grommet 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Grommet 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-132"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-132">&#182;</a></div><p>Now modify that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-0-code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;grommet_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Grommet 1 Updated&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Grommet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Grommet 1 Updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_char_pk_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with a character PK can be saved as inlines. Regression for #10992&quot;</span></pre></div></td></tr>


<tr id="section-133"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-133">&#182;</a></div><p>First add a new inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;DH1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Doohickey 1&quot;</span>
        <span class="n">collector_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/collector/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Doohickey 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-134"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-134">&#182;</a></div><p>Check that the PK link exists on the rendered form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collector_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;doohickey_set-0-code&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-135"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-135">&#182;</a></div><p>Now resave that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;DH1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Doohickey 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Doohickey 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-136"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-136">&#182;</a></div><p>Now modify that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;DH1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;doohickey_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Doohickey 1 Updated&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">DooHickey</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Doohickey 1 Updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_integer_pk_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;A model with an integer PK can be saved as inlines. Regression for #10992&quot;</span></pre></div></td></tr>


<tr id="section-137"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-137">&#182;</a></div><p>First add a new inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;42&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Whatsit 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/collector/1/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Whatsit 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-138"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-138">&#182;</a></div><p>Check that the PK link exists on the rendered form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/collector/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;whatsit_set-0-index&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-139"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-139">&#182;</a></div><p>Now resave that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;42&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Whatsit 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/collector/1/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Whatsit 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-140"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-140">&#182;</a></div><p>Now modify that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;42&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;whatsit_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Whatsit 1 Updated&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/collector/1/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Whatsit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Whatsit 1 Updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inherited_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;An inherited model can be saved as inlines. Regression for #11042&quot;</span></pre></div></td></tr>


<tr id="section-141"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-141">&#182;</a></div><p>First add a new inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Fancy Doodad 1&quot;</span>
        <span class="n">collector_url</span> <span class="o">=</span> <span class="s">&#39;/test_admin/admin/admin_views/collector/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">pk</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Fancy Doodad 1&quot;</span><span class="p">)</span>
        <span class="n">doodad_pk</span> <span class="o">=</span> <span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span></pre></div></td></tr>


<tr id="section-142"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-142">&#182;</a></div><p>Check that the PK link exists on the rendered form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">collector_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;fancydoodad_set-0-doodad_ptr&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-143"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-143">&#182;</a></div><p>Now resave that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-0-doodad_ptr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">doodad_pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Fancy Doodad 1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Fancy Doodad 1&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-144"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-144">&#182;</a></div><p>Now modify that inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-INITIAL_FORMS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-0-doodad_ptr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">doodad_pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">[</span><span class="s">&#39;fancydoodad_set-0-name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Fancy Doodad 1 Updated&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">collector_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FancyDoodad</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Fancy Doodad 1 Updated&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_ordered_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check that an inline with an editable ordering fields is</span>
<span class="sd">        updated correctly. Regression for #10922&quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-145"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-145">&#182;</a></div><p>Create some objects with an initial ordering</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">)</span>
        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">collector</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-146"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-146">&#182;</a></div><p>NB: The order values must be changed so that the items are reordered.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Frederick Clegg&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;7&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-0-order&quot;</span><span class="p">:</span> <span class="s">&quot;14&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-0-id&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-0-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-1-order&quot;</span><span class="p">:</span> <span class="s">&quot;13&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-1-id&quot;</span><span class="p">:</span> <span class="s">&quot;2&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-1-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-2-order&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-2-id&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-2-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-3-order&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-3-id&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-3-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-4-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-4-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-4-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-5-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-5-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-5-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>

            <span class="s">&quot;category_set-6-order&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-6-id&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;category_set-6-collector&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/collector/1/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_data</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-147"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-147">&#182;</a></div><p>Successful post will redirect</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-148"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-148">&#182;</a></div><p>Check that the order values have been applied to the right objects</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">category_set</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">NeverCacheTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-colors.xml&#39;</span><span class="p">,</span> <span class="s">&#39;admin-views-fabrics.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testAdminIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of the main index&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testAppIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of an application index&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testModelIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of a model index&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/fabric/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testModelAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of a model add page&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/fabric/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testModelView</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of a model edit page&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/section/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testModelHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of a model history page&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/section/1/history/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testModelDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of a model delete page&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/section/1/delete/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testLogin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of login views&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testLogout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of logout view&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testPasswordChange</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of the password change view&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/password_change/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testPasswordChangeDone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of the password change done view&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/password_change/done/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">testJsi18n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check the never-cache status of the JavaScript i18n view&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/jsi18n/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_max_age</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">PrePopulatedTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_prepopulated_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/prepopulatedpost/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;id: &#39;#id_slug&#39;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;field[&#39;dependency_ids&#39;].push(&#39;#id_title&#39;);&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;id: &#39;#id_prepopulatedsubpost_set-0-subslug&#39;,&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_prepopulated_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/prepopulatedpost/1/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;A Long Title&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;id: &#39;#id_slug&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;field[&#39;dependency_ids&#39;].push(&#39;#id_title&#39;);&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;id: &#39;#id_prepopulatedsubpost_set-0-subslug&#39;,&quot;</span><span class="p">)</span>

    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_prepopulated_maxlength_localized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Regression test for #15938: if USE_THOUSAND_SEPARATOR is set, make sure</span>
<span class="sd">        that maxLength (in the JavaScript) is rendered without separators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/prepopulatedpostlargeslug/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;maxLength: 1000&quot;</span><span class="p">)</span> <span class="c"># instead of 1,000</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">SeleniumPrePopulatedFirefoxTests</span><span class="p">(</span><span class="n">AdminSeleniumWebDriverTestCase</span><span class="p">):</span>
    <span class="n">webdriver_class</span> <span class="o">=</span> <span class="s">&#39;selenium.webdriver.firefox.webdriver.WebDriver&#39;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the JavaScript-automated prepopulated fields work with the</span>
<span class="sd">        main form and with stacked and tabular inlines.</span>
<span class="sd">        Refs #13068, #9264, #9983, #9784.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">admin_login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">live_server_url</span><span class="p">,</span>
            <span class="s">&#39;/test_admin/admin/admin_views/mainprepopulated/add/&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-149"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-149">&#182;</a></div><p>Main form ----------------------------------------------------------</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_pubdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;2012-02-18&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_select_option</span><span class="p">(</span><span class="s">&#39;#id_status&#39;</span><span class="p">,</span> <span class="s">&#39;option two&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39; this is the mAin nÀMë and it</span><span class="se">\&#39;</span><span class="s">s awεšome&#39;</span><span class="p">)</span>
        <span class="n">slug1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_slug1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">slug2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_slug2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug1</span><span class="p">,</span> <span class="s">&#39;main-name-and-its-awesome-2012-02-18&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug2</span><span class="p">,</span> <span class="s">&#39;option-two-main-name-and-its-awesome&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-150"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-150">&#182;</a></div><p>Stacked inlines ----------------------------------------------------
Initial inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-0-pubdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;2011-12-17&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_select_option</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-0-status&#39;</span><span class="p">,</span> <span class="s">&#39;option one&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-0-name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39; here is a sŤāÇkeð   inline !  &#39;</span><span class="p">)</span>
        <span class="n">slug1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-0-slug1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">slug2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-0-slug2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug1</span><span class="p">,</span> <span class="s">&#39;here-stacked-inline-2011-12-17&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug2</span><span class="p">,</span> <span class="s">&#39;option-one-here-stacked-inline&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-151"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-151">&#182;</a></div><p>Add an inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">&#39;Add another Related Prepopulated&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-1-pubdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;1999-01-25&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_select_option</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-1-status&#39;</span><span class="p">,</span> <span class="s">&#39;option two&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-1-name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39; now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooog text... &#39;</span><span class="p">)</span>
        <span class="n">slug1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-1-slug1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">slug2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-1-slug2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug1</span><span class="p">,</span> <span class="s">&#39;now-you-have-another-stacked-inline-very-loooooooo&#39;</span><span class="p">)</span> <span class="c"># 50 characters maximum for slug1 field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug2</span><span class="p">,</span> <span class="s">&#39;option-two-now-you-have-another-stacked-inline-very-looooooo&#39;</span><span class="p">)</span> <span class="c"># 60 characters maximum for slug2 field</span></pre></div></td></tr>


<tr id="section-152"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-152">&#182;</a></div><p>Tabular inlines ----------------------------------------------------
Initial inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-0-pubdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;1234-12-07&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_select_option</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-0-status&#39;</span><span class="p">,</span> <span class="s">&#39;option two&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-0-name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;And now, with a tÃbűlaŘ inline !!!&#39;</span><span class="p">)</span>
        <span class="n">slug1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-0-slug1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">slug2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-0-slug2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug1</span><span class="p">,</span> <span class="s">&#39;and-now-tabular-inline-1234-12-07&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug2</span><span class="p">,</span> <span class="s">&#39;option-two-and-now-tabular-inline&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-153"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-153">&#182;</a></div><p>Add an inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_elements_by_link_text</span><span class="p">(</span><span class="s">&#39;Add another Related Prepopulated&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-1-pubdate&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;1981-08-22&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_select_option</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-1-status&#39;</span><span class="p">,</span> <span class="s">&#39;option one&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-1-name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">&#39;a tÃbűlaŘ inline with ignored ;&quot;&amp;*^\%$#@-/`~ characters&#39;</span><span class="p">)</span>
        <span class="n">slug1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-1-slug1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="n">slug2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">&#39;#id_relatedprepopulated_set-2-1-slug2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug1</span><span class="p">,</span> <span class="s">&#39;tabular-inline-ignored-characters-1981-08-22&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">slug2</span><span class="p">,</span> <span class="s">&#39;option-one-tabular-inline-ignored-characters&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-154"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-154">&#182;</a></div><p>Save and check that everything is properly stored in the database</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">selenium</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">&#39;//input[@value=&quot;Save&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-155"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-155">&#182;</a></div><p>Wait for the next page to be loaded.</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">wait_loaded_tag</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-156"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-156">&#182;</a></div><p>IE7 occasionnally returns an error "Internet Explorer cannot
display the webpage" and doesn't load the next page. We just
ignore it.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MainPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">MainPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39; this is the mAin nÀMë and it</span><span class="se">\&#39;</span><span class="s">s awεšome&#39;</span><span class="p">,</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="s">&#39;2012-02-18&#39;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s">&#39;option two&#39;</span><span class="p">,</span>
            <span class="n">slug1</span><span class="o">=</span><span class="s">&#39;main-name-and-its-awesome-2012-02-18&#39;</span><span class="p">,</span>
            <span class="n">slug2</span><span class="o">=</span><span class="s">&#39;option-two-main-name-and-its-awesome&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">RelatedPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">RelatedPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39; here is a sŤāÇkeð   inline !  &#39;</span><span class="p">,</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="s">&#39;2011-12-17&#39;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s">&#39;option one&#39;</span><span class="p">,</span>
            <span class="n">slug1</span><span class="o">=</span><span class="s">&#39;here-stacked-inline-2011-12-17&#39;</span><span class="p">,</span>
            <span class="n">slug2</span><span class="o">=</span><span class="s">&#39;option-one-here-stacked-inline&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">RelatedPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39; now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooo&#39;</span><span class="p">,</span> <span class="c"># 75 characters in name field</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="s">&#39;1999-01-25&#39;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s">&#39;option two&#39;</span><span class="p">,</span>
            <span class="n">slug1</span><span class="o">=</span><span class="s">&#39;now-you-have-another-stacked-inline-very-loooooooo&#39;</span><span class="p">,</span>
            <span class="n">slug2</span><span class="o">=</span><span class="s">&#39;option-two-now-you-have-another-stacked-inline-very-looooooo&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">RelatedPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39;And now, with a tÃbűlaŘ inline !!!&#39;</span><span class="p">,</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="s">&#39;1234-12-07&#39;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s">&#39;option two&#39;</span><span class="p">,</span>
            <span class="n">slug1</span><span class="o">=</span><span class="s">&#39;and-now-tabular-inline-1234-12-07&#39;</span><span class="p">,</span>
            <span class="n">slug2</span><span class="o">=</span><span class="s">&#39;option-two-and-now-tabular-inline&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">RelatedPrepopulated</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&#39;a tÃbűlaŘ inline with ignored ;&quot;&amp;*^\%$#@-/`~ characters&#39;</span><span class="p">,</span>
            <span class="n">pubdate</span><span class="o">=</span><span class="s">&#39;1981-08-22&#39;</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s">&#39;option one&#39;</span><span class="p">,</span>
            <span class="n">slug1</span><span class="o">=</span><span class="s">&#39;tabular-inline-ignored-characters-1981-08-22&#39;</span><span class="p">,</span>
            <span class="n">slug2</span><span class="o">=</span><span class="s">&#39;option-one-tabular-inline-ignored-characters&#39;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">SeleniumPrePopulatedChromeTests</span><span class="p">(</span><span class="n">SeleniumPrePopulatedFirefoxTests</span><span class="p">):</span>
    <span class="n">webdriver_class</span> <span class="o">=</span> <span class="s">&#39;selenium.webdriver.chrome.webdriver.WebDriver&#39;</span>

<span class="k">class</span> <span class="nc">SeleniumPrePopulatedIETests</span><span class="p">(</span><span class="n">SeleniumPrePopulatedFirefoxTests</span><span class="p">):</span>
    <span class="n">webdriver_class</span> <span class="o">=</span> <span class="s">&#39;selenium.webdriver.ie.webdriver.WebDriver&#39;</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">ReadonlyTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_readonly_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/post/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;posted&quot;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-157"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-157">&#182;</a></div><p>3 fields + 2 submit buttons + 4 inline management form fields, + 2
hidden fields for inlines + 1 field for the inline + 2 empty form</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;input&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">formats</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span>
            <span class="s">&quot;&lt;label&gt;Awesomeness level:&lt;/label&gt;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;Very awesome.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;Unkown coolness.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span>
            <span class="n">formats</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;form-row field-coolness&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;form-row field-awesomeness_level&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;form-row field-posted&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;form-row field-value&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;div class=&quot;form-row&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;p class=&quot;help&quot;&gt;&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;p class=&quot;help&quot;&gt;Some help text for the title (with unicode ŠĐĆŽćžšđ)&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;p class=&quot;help&quot;&gt;Some help text for the content (with unicode ŠĐĆŽćžšđ)&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;p class=&quot;help&quot;&gt;Some help text for the date (with unicode ŠĐĆŽćžšđ)&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;I worked on readonly_fields&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&quot;Its good stuff&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/post/</span><span class="si">%d</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> amount of cool&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_readonly_post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Django Got Readonly Fields&quot;</span><span class="p">,</span>
            <span class="s">&quot;content&quot;</span><span class="p">:</span> <span class="s">&quot;This is an incredible development.&quot;</span><span class="p">,</span>
            <span class="s">&quot;link_set-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
            <span class="s">&quot;link_set-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
            <span class="s">&quot;link_set-MAX_NUM_FORMS&quot;</span><span class="p">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/post/add/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">posted</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

        <span class="n">data</span><span class="p">[</span><span class="s">&quot;posted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;10-8-1990&quot;</span> <span class="c"># some date that&#39;s not today</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/post/add/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">posted</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_readonly_manytomany</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Regression test for #13004&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/pizza/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_user_password_change_limited_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">su</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_superuser</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin2/auth/user/</span><span class="si">%s</span><span class="s">/password/&#39;</span> <span class="o">%</span> <span class="n">su</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">RawIdFieldsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_limit_choices_to</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Regression test for 14880&quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-158"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-158">&#182;</a></div><p>This includes tests integers, strings and booleans in the lookup query string</p></td><td class="code"><div class="highlight"><pre>        <span class="n">actor</span> <span class="o">=</span> <span class="n">Actor</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Palin&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
        <span class="n">inquisition1</span> <span class="o">=</span> <span class="n">Inquisition</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                  <span class="n">leader</span><span class="o">=</span><span class="n">actor</span><span class="p">,</span>
                                                  <span class="n">country</span><span class="o">=</span><span class="s">&quot;England&quot;</span><span class="p">)</span>
        <span class="n">inquisition2</span> <span class="o">=</span> <span class="n">Inquisition</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">expected</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">leader</span><span class="o">=</span><span class="n">actor</span><span class="p">,</span>
                                                  <span class="n">country</span><span class="o">=</span><span class="s">&quot;Spain&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/sketch/add/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-159"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-159">&#182;</a></div><p>Find the link</p></td><td class="code"><div class="highlight"><pre>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;&lt;a href=&quot;([^&quot;]*)&quot;[^&gt;]* id=&quot;lookup_id_inquisition&quot;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="c"># Got a match</span>
        <span class="n">popup_url</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&amp;amp;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-160"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-160">&#182;</a></div><p>Handle relative links</p></td><td class="code"><div class="highlight"><pre>        <span class="n">popup_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="o">.</span><span class="n">urljoin</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s">&#39;PATH_INFO&#39;</span><span class="p">],</span> <span class="n">popup_url</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-161"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-161">&#182;</a></div><p>Get the popup</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">popup_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response2</span><span class="p">,</span> <span class="s">&quot;Spain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response2</span><span class="p">,</span> <span class="s">&quot;England&quot;</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">UserAdminTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests user CRUD functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_count</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;newuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password1&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;password2&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/auth/user/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">new_user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">user_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">new_user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">UNUSABLE_PASSWORD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_save_continue_editing_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_count</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;newuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password1&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;password2&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;_continue&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/auth/user/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">new_user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">user_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">new_user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">UNUSABLE_PASSWORD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_password_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;newuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password1&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;password2&#39;</span><span class="p">:</span> <span class="s">&#39;mismatch&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">adminform</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;adminform&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;password&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adminform</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">adminform</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;password2&#39;</span><span class="p">],</span>
                          <span class="p">[</span><span class="s">&quot;The two password fields didn&#39;t match.&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_user_fk_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Quick user addition in a FK popup shouldn&#39;t invoke view for further user customization&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/album/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/auth/user/add&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;add-another&quot; id=&quot;add_id_owner&quot; onclick=&quot;return showAddAnotherPopup(this);&quot;&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/?_popup=1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;_continue&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;name=&quot;_addanother&quot;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;newuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password1&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;password2&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;_popup&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;_save&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/?_popup=1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;dismissAddAnotherPopup&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_save_add_another_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_count</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;newuser&#39;</span><span class="p">,</span>
            <span class="s">&#39;password1&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;password2&#39;</span><span class="p">:</span> <span class="s">&#39;newpassword&#39;</span><span class="p">,</span>
            <span class="s">&#39;_addanother&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/auth/user/add/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">user_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">new_user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">UNUSABLE_PASSWORD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_user_permission_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></pre></div></td></tr>


<tr id="section-162"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-162">&#182;</a></div><p>Don't depend on a warm cache, see #17377.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/user/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">u</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_form_url_present_in_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin3/auth/user/</span><span class="si">%s</span><span class="s">/password/&#39;</span> <span class="o">%</span> <span class="n">u</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;form_url&#39;</span><span class="p">],</span> <span class="s">&#39;pony&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">GroupAdminTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests group CRUD functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_save_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">group_count</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/group/add/&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;newgroup&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">new_group</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-id&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRedirects</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;/test_admin/admin/auth/group/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">group_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_group_permission_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;test_group&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>  <span class="c"># instead of 259!</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/auth/group/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">g</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">CSSTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_css_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/post/add/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-163"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-163">&#182;</a></div><p>The main form</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-title&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-content&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-public&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-awesomeness_level&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-coolness&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row field-value&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;class=&quot;form-row&quot;&#39;</span><span class="p">)</span> <span class="c"># The lambda function</span></pre></div></td></tr>


<tr id="section-164"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-164">&#182;</a></div><p>The tabular inline</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;td class=&quot;field-url&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;td class=&quot;field-posted&quot;&gt;&#39;</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">docutils</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">docutils</span> <span class="o">=</span> <span class="bp">None</span>

<span class="nd">@unittest.skipUnless</span><span class="p">(</span><span class="n">docutils</span><span class="p">,</span> <span class="s">&quot;no docutils installed.&quot;</span><span class="p">)</span>
<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminDocsTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/doc/tags/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-165"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-165">&#182;</a></div><p>The builtin tag group exists</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;h2&gt;Built-in tags&lt;/h2&gt;&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-166"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-166">&#182;</a></div><p>A builtin tag exists in both the index and detail</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;h3 id=&quot;built_in-autoescape&quot;&gt;autoescape&lt;/h3&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;&lt;a href=&quot;#built_in-autoescape&quot;&gt;autoescape&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-167"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-167">&#182;</a></div><p>An app tag exists in both the index and detail</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;h3 id=&quot;flatpages-get_flatpages&quot;&gt;get_flatpages&lt;/h3&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;&lt;a href=&quot;#flatpages-get_flatpages&quot;&gt;get_flatpages&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-168"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-168">&#182;</a></div><p>The admin list tag group exists</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;h2&gt;admin_list&lt;/h2&gt;&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-169"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-169">&#182;</a></div><p>An admin list tag exists in both the index and detail</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;h3 id=&quot;admin_list-admin_actions&quot;&gt;admin_actions&lt;/h3&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;&lt;a href=&quot;#admin_list-admin_actions&quot;&gt;admin_actions&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/doc/filters/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-170"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-170">&#182;</a></div><p>The builtin filter group exists</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&quot;&lt;h2&gt;Built-in filters&lt;/h2&gt;&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-171"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-171">&#182;</a></div><p>A builtin filter exists in both the index and detail</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;h3 id=&quot;built_in-add&quot;&gt;add&lt;/h3&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;li&gt;&lt;a href=&quot;#built_in-add&quot;&gt;add&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">ValidXHTMLTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>
    <span class="n">urlbit</span> <span class="o">=</span> <span class="s">&#39;admin&#39;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="nd">@override_settings</span><span class="p">(</span>
        <span class="n">TEMPLATE_CONTEXT_PROCESSORS</span><span class="o">=</span><span class="nb">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="o">!=</span><span class="s">&#39;django.core.context_processors.i18n&#39;</span><span class="p">,</span>
            <span class="n">global_settings</span><span class="o">.</span><span class="n">TEMPLATE_CONTEXT_PROCESSORS</span><span class="p">),</span>
        <span class="n">USE_I18N</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">testLangNamePresent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/</span><span class="si">%s</span><span class="s">/admin_views/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">urlbit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39; lang=&quot;&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39; xml:lang=&quot;&quot;&#39;</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">DateHierarchyTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_THOUSAND_SEPARATOR</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_USE_L10N</span>
        <span class="n">formats</span><span class="o">.</span><span class="n">reset_format_cache</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assert_non_localized_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure that the year is not localized with</span>
<span class="sd">        USE_THOUSAND_SEPARATOR. Refs #15234.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">formats</span><span class="o">.</span><span class="n">number_format</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">assert_contains_year_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;?release_date__year=</span><span class="si">%d</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">assert_contains_month_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="s">&#39;?release_date__year=</span><span class="si">%d</span><span class="s">&amp;amp;release_date__month=</span><span class="si">%d</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">assert_contains_day_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span>
            <span class="n">response</span><span class="p">,</span> <span class="s">&#39;?release_date__year=</span><span class="si">%d</span><span class="s">&amp;amp;&#39;</span>
            <span class="s">&#39;release_date__month=</span><span class="si">%d</span><span class="s">&amp;amp;release_date__day=</span><span class="si">%d</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that no date hierarchy links display with empty changelist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__year=&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__month=&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__day=&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that single day-level date hierarchy appears for single object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">release_date</span><span class="o">=</span><span class="n">DATE</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_day_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">DATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_within_month</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that day-level links appear for changelist within single month.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATES</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">release_date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_day_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_within_year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that month-level links appear for changelist within single year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATES</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">release_date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-172"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-172">&#182;</a></div><p>no day-level links</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__day=&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_month_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_years</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that year-level links appear for year-spanning changelist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATES</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
                 <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="n">Podcast</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">release_date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-173"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-173">&#182;</a></div><p>no day/month-level links</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__day=&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;release_date__month=&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_year_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-174"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-174">&#182;</a></div><p>and make sure GET parameters still behave correctly</p></td><td class="code"><div class="highlight"><pre>        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">DATES</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">?release_date__year=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">),</span>
                  <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_month_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2003</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2005</span><span class="p">)</span>

            <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">?release_date__year=</span><span class="si">%d</span><span class="s">&amp;release_date__month=</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;admin:admin_views_podcast_changelist&#39;</span><span class="p">),</span>
                  <span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_contains_day_link</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2003</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_non_localized_year</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">2005</span><span class="p">)</span>

<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminCustomSaveRelatedTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that one can easily customize the way related objects are saved.</span>
<span class="sd">    Refs #16115.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_be_able_to_edit_related_objects_on_add_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;child_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Paul&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Catherine&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/parent/add/&#39;</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

        <span class="n">children_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Catherine Stone&#39;</span><span class="p">,</span> <span class="s">&#39;Paul Stone&#39;</span><span class="p">],</span> <span class="n">children_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_be_able_to_edit_related_objects_on_change_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Josh Stone&#39;</span><span class="p">)</span>
        <span class="n">paul</span> <span class="o">=</span> <span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul&#39;</span><span class="p">)</span>
        <span class="n">catherine</span> <span class="o">=</span> <span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Catherine&#39;</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;child_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;5&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Paul&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-0-id&#39;</span><span class="p">:</span> <span class="n">paul</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s">&#39;child_set-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Catherine&#39;</span><span class="p">,</span>
            <span class="s">&#39;child_set-1-id&#39;</span><span class="p">:</span> <span class="n">catherine</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/parent/</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>

        <span class="n">children_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Catherine Stone&#39;</span><span class="p">,</span> <span class="s">&#39;Paul Stone&#39;</span><span class="p">],</span> <span class="n">children_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_be_able_to_edit_related_objects_on_changelist_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Josh Rock&#39;</span><span class="p">)</span>
        <span class="n">paul</span> <span class="o">=</span> <span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul&#39;</span><span class="p">)</span>
        <span class="n">catherine</span> <span class="o">=</span> <span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Catherine&#39;</span><span class="p">)</span>
        <span class="n">post</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span>
            <span class="s">&#39;_save&#39;</span><span class="p">:</span> <span class="s">&#39;Save&#39;</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/admin_views/parent/&#39;</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
        <span class="n">children_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Child</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Josh Stone&#39;</span><span class="p">,</span> <span class="n">Parent</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Catherine Stone&#39;</span><span class="p">,</span> <span class="s">&#39;Paul Stone&#39;</span><span class="p">],</span> <span class="n">children_names</span><span class="p">)</span>


<span class="nd">@override_settings</span><span class="p">(</span><span class="n">PASSWORD_HASHERS</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;django.contrib.auth.hashers.SHA1PasswordHasher&#39;</span><span class="p">,))</span>
<span class="k">class</span> <span class="nc">AdminViewLogoutTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">&quot;regressiontests.admin_views.urls&quot;</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;admin-views-users.xml&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&#39;super&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s">&#39;secret&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_client_logout_url_can_be_used_to_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="s">&#39;registration/logged_out.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s">&#39;PATH_INFO&#39;</span><span class="p">],</span> <span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-175"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-175">&#182;</a></div><p>we are now logged out</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">302</span><span class="p">)</span>  <span class="c"># we should be redirected to the login page.</span></pre></div></td></tr>


<tr id="section-176"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-176">&#182;</a></div><p>follow the redirect and test results.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/test_admin/admin/logout/&#39;</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span> <span class="s">&#39;admin/login.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="p">[</span><span class="s">&#39;PATH_INFO&#39;</span><span class="p">],</span> <span class="s">&#39;/test_admin/admin/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;input type=&quot;hidden&quot; name=&quot;next&quot; value=&quot;/test_admin/admin/&quot; /&gt;&#39;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
