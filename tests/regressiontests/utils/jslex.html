<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › utils › jslex.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>jslex.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;Tests for jslex.&quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>encoding: utf-8
originally from https://bitbucket.org/ned/jslex</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">django.utils.jslex</span> <span class="kn">import</span> <span class="n">JsLexer</span><span class="p">,</span> <span class="n">prepare_js_for_gettext</span>

<span class="k">class</span> <span class="nc">JsTokensTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">LEX_CASES</span> <span class="o">=</span> <span class="p">[</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>ids</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;a ABC $ _ a123&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;id ABC&quot;</span><span class="p">,</span> <span class="s">&quot;id $&quot;</span><span class="p">,</span> <span class="s">&quot;id _&quot;</span><span class="p">,</span> <span class="s">&quot;id a123&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;\u1234 abc\u0020 \u0065_\u0067&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;id \u1234&quot;</span><span class="p">,</span> <span class="s">r&quot;id abc\u0020&quot;</span><span class="p">,</span> <span class="s">r&quot;id \u0065_\u0067&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>numbers</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;123 1.234 0.123e-3 0 1E+40 1e1 .123&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;dnum 123&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1.234&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 0.123e-3&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 0&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1E+40&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1e1&quot;</span><span class="p">,</span> <span class="s">&quot;dnum .123&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;0x1 0xabCD 0XABcd&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;hnum 0x1&quot;</span><span class="p">,</span> <span class="s">&quot;hnum 0xabCD&quot;</span><span class="p">,</span> <span class="s">&quot;hnum 0XABcd&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;010 0377 090&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;onum 010&quot;</span><span class="p">,</span> <span class="s">&quot;onum 0377&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 0&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 90&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;0xa123ghi&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;hnum 0xa123&quot;</span><span class="p">,</span> <span class="s">&quot;id ghi&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>keywords</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;function Function FUNCTION&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;keyword function&quot;</span><span class="p">,</span> <span class="s">&quot;id Function&quot;</span><span class="p">,</span> <span class="s">&quot;id FUNCTION&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;const constructor in inherits&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;keyword const&quot;</span><span class="p">,</span> <span class="s">&quot;id constructor&quot;</span><span class="p">,</span> <span class="s">&quot;keyword in&quot;</span><span class="p">,</span> <span class="s">&quot;id inherits&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;true true_enough&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;reserved true&quot;</span><span class="p">,</span> <span class="s">&quot;id true_enough&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>strings</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&#39;&#39;&#39; &#39;hello&#39; &quot;hello&quot; &#39;&#39;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;string &#39;hello&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;string &quot;hello&quot;&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot; &#39;don\&#39;t&#39; &quot;don\&quot;t&quot; &#39;&quot;&#39; &quot;&#39;&quot; &#39;\&#39;&#39; &quot;\&quot;&quot; &quot;&quot;&quot;</span><span class="p">,</span>
         <span class="p">[</span><span class="s">r&quot;&quot;&quot;string &#39;don\&#39;t&#39;&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">r&#39;&#39;&#39;string &quot;don\&quot;t&quot;&#39;&#39;&#39;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;string &#39;&quot;&#39;&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">r&#39;&#39;&#39;string &quot;&#39;&quot;&#39;&#39;&#39;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;string &#39;\&#39;&#39;&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">r&#39;&#39;&#39;string &quot;\&quot;&quot;&#39;&#39;&#39;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&#39;&quot;ƃuıxǝ⅂ ʇdıɹɔsɐʌɐſ\&quot;&quot;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&#39;string &quot;ƃuıxǝ⅂ ʇdıɹɔsɐʌɐſ\&quot;&quot;&#39;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>comments</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;a//b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;linecomment //b&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;/****/a/=2//hello&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;comment /****/&quot;</span><span class="p">,</span> <span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct /=&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 2&quot;</span><span class="p">,</span> <span class="s">&quot;linecomment //hello&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;/*</span><span class="se">\n</span><span class="s"> * Header</span><span class="se">\n</span><span class="s"> */</span><span class="se">\n</span><span class="s">a=1;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;comment /*</span><span class="se">\n</span><span class="s"> * Header</span><span class="se">\n</span><span class="s"> */&quot;</span><span class="p">,</span> <span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>punctuation</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;a+++b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct ++&quot;</span><span class="p">,</span> <span class="s">&quot;punct +&quot;</span><span class="p">,</span> <span class="s">&quot;id b&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>regex</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">r&quot;a=/a*/,1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;regex /a*/&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;a=/a*[^/]+/,1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;regex /a*[^/]+/&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;a=/a*\[^/,1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">r&quot;regex /a*\[^/&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;a=/\//,1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">r&quot;regex /\//&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 1&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>next two are from http://www.mozilla.org/js/language/js20-2002-04/rationale/syntax.html#regular-expressions</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">&quot;&quot;&quot;for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z:/x:3;x&lt;5;y&lt;/g/i) {xyz(x++);}&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;keyword for&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">&quot;keyword var&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;keyword in&quot;</span><span class="p">,</span>
            <span class="s">&quot;id foo&quot;</span><span class="p">,</span> <span class="s">&quot;punct &amp;&amp;&quot;</span><span class="p">,</span> <span class="s">&#39;string &quot;&lt;/x&gt;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;punct ||&quot;</span><span class="p">,</span> <span class="s">&quot;id mot&quot;</span><span class="p">,</span> <span class="s">&quot;punct ?&quot;</span><span class="p">,</span> <span class="s">&quot;id z&quot;</span><span class="p">,</span>
            <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">&quot;regex /x:3;x&lt;5;y&lt;/g&quot;</span><span class="p">,</span> <span class="s">&quot;punct /&quot;</span><span class="p">,</span> <span class="s">&quot;id i&quot;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span> <span class="s">&quot;punct {&quot;</span><span class="p">,</span>
            <span class="s">&quot;id xyz&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct ++&quot;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">,</span> <span class="s">&quot;punct }&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;&quot;&quot;for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z/x:3;x&lt;5;y&lt;/g/i) {xyz(x++);}&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&quot;keyword for&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">&quot;keyword var&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;id a&quot;</span><span class="p">,</span> <span class="s">&quot;keyword in&quot;</span><span class="p">,</span>
            <span class="s">&quot;id foo&quot;</span><span class="p">,</span> <span class="s">&quot;punct &amp;&amp;&quot;</span><span class="p">,</span> <span class="s">&#39;string &quot;&lt;/x&gt;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;punct ||&quot;</span><span class="p">,</span> <span class="s">&quot;id mot&quot;</span><span class="p">,</span> <span class="s">&quot;punct ?&quot;</span><span class="p">,</span> <span class="s">&quot;id z&quot;</span><span class="p">,</span>
            <span class="s">&quot;punct /&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 3&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct &lt;&quot;</span><span class="p">,</span> <span class="s">&quot;dnum 5&quot;</span><span class="p">,</span>
            <span class="s">&quot;punct ;&quot;</span><span class="p">,</span> <span class="s">&quot;id y&quot;</span><span class="p">,</span> <span class="s">&quot;punct &lt;&quot;</span><span class="p">,</span> <span class="s">&quot;regex /g/i&quot;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span> <span class="s">&quot;punct {&quot;</span><span class="p">,</span>
            <span class="s">&quot;id xyz&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">&quot;id x&quot;</span><span class="p">,</span> <span class="s">&quot;punct ++&quot;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">,</span> <span class="s">&quot;punct }&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Various "illegal" regexes that are valid according to the std.</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/????/, /++++/, /[----]/ &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;regex /????/&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;regex /++++/&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">&quot;regex /[----]/&quot;</span><span class="p">]),</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Stress cases from http://stackoverflow.com/questions/5533925/what-javascript-constructs-does-jslex-incorrectly-lex/5573409#5573409</p></td><td class="code"><div class="highlight"><pre>        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/\[/&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /\[/&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/[i]/&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /[i]/&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/[\]]/&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /[\]]/&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/a[\]]/&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /a[\]]/&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/a[\]]b/&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /a[\]]b/&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/[\]/]/gi&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /[\]/]/gi&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">r&quot;&quot;&quot;/\[[^\]]+\]/gi&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">r&quot;&quot;&quot;regex /\[[^\]]+\]/gi&quot;&quot;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            rexl.re = {</span>
<span class="s">            NAME: /^(?!\d)(?:\w)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;/,</span>
<span class="s">            UNQUOTED_LITERAL: /^@(?:(?!\d)(?:\w|\:)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;)\[[^\]]+\]/,</span>
<span class="s">            QUOTED_LITERAL: /^&#39;(?:[^&#39;]|&#39;&#39;)*&#39;/,</span>
<span class="s">            NUMERIC_LITERAL: /^[0-9]+(?:\.[0-9]*(?:[eE][-+][0-9]+)?)?/,</span>
<span class="s">            SYMBOL: /^(?:==|=|&lt;&gt;|&lt;=|&lt;|&gt;=|&gt;|!~~|!~|~~|~|!==|!=|!~=|!~|!|&amp;|\||\.|\:|,|\(|\)|\[|\]|\{|\}|\?|\:|;|@|\^|\/\+|\/|\*|\+|-)/</span>
<span class="s">            };</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s">&quot;id rexl&quot;</span><span class="p">,</span> <span class="s">&quot;punct .&quot;</span><span class="p">,</span> <span class="s">&quot;id re&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;punct {&quot;</span><span class="p">,</span>
         <span class="s">&quot;id NAME&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^(?!\d)(?:\w)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id UNQUOTED_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^@(?:(?!\d)(?:\w|\:)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;)\[[^\]]+\]/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id QUOTED_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^&#39;(?:[^&#39;]|&#39;&#39;)*&#39;/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id NUMERIC_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^[0-9]+(?:\.[0-9]*(?:[eE][-+][0-9]+)?)?/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id SYMBOL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^(?:==|=|&lt;&gt;|&lt;=|&lt;|&gt;=|&gt;|!~~|!~|~~|~|!==|!=|!~=|!~|!|&amp;|\||\.|\:|,|\(|\)|\[|\]|\{|\}|\?|\:|;|@|\^|\/\+|\/|\*|\+|-)/&quot;&quot;&quot;</span><span class="p">,</span>
         <span class="s">&quot;punct }&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span>
         <span class="p">]),</span>

        <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            rexl.re = {</span>
<span class="s">            NAME: /^(?!\d)(?:\w)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;/,</span>
<span class="s">            UNQUOTED_LITERAL: /^@(?:(?!\d)(?:\w|\:)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;)\[[^\]]+\]/,</span>
<span class="s">            QUOTED_LITERAL: /^&#39;(?:[^&#39;]|&#39;&#39;)*&#39;/,</span>
<span class="s">            NUMERIC_LITERAL: /^[0-9]+(?:\.[0-9]*(?:[eE][-+][0-9]+)?)?/,</span>
<span class="s">            SYMBOL: /^(?:==|=|&lt;&gt;|&lt;=|&lt;|&gt;=|&gt;|!~~|!~|~~|~|!==|!=|!~=|!~|!|&amp;|\||\.|\:|,|\(|\)|\[|\]|\{|\}|\?|\:|;|@|\^|\/\+|\/|\*|\+|-)/</span>
<span class="s">            };</span>
<span class="s">            str = &#39;&quot;&#39;;</span>
<span class="s">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s">&quot;id rexl&quot;</span><span class="p">,</span> <span class="s">&quot;punct .&quot;</span><span class="p">,</span> <span class="s">&quot;id re&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;punct {&quot;</span><span class="p">,</span>
         <span class="s">&quot;id NAME&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^(?!\d)(?:\w)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id UNQUOTED_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^@(?:(?!\d)(?:\w|\:)+|^&quot;(?:[^&quot;]|&quot;&quot;)+&quot;)\[[^\]]+\]/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id QUOTED_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^&#39;(?:[^&#39;]|&#39;&#39;)*&#39;/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id NUMERIC_LITERAL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^[0-9]+(?:\.[0-9]*(?:[eE][-+][0-9]+)?)?/&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span>
         <span class="s">&quot;id SYMBOL&quot;</span><span class="p">,</span> <span class="s">&quot;punct :&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;regex /^(?:==|=|&lt;&gt;|&lt;=|&lt;|&gt;=|&gt;|!~~|!~|~~|~|!==|!=|!~=|!~|!|&amp;|\||\.|\:|,|\(|\)|\[|\]|\{|\}|\?|\:|;|@|\^|\/\+|\/|\*|\+|-)/&quot;&quot;&quot;</span><span class="p">,</span>
         <span class="s">&quot;punct }&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">,</span>
         <span class="s">&quot;id str&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;string &#39;&quot;&#39;&quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">,</span>
         <span class="p">]),</span>

        <span class="p">(</span><span class="s">r&quot;&quot;&quot; this._js = &quot;e.str(\&quot;&quot; + this.value.replace(/\\/g, &quot;\\\\&quot;).replace(/&quot;/g, &quot;\\\&quot;&quot;) + &quot;\&quot;)&quot;; &quot;&quot;&quot;</span><span class="p">,</span>
         <span class="p">[</span><span class="s">&quot;keyword this&quot;</span><span class="p">,</span> <span class="s">&quot;punct .&quot;</span><span class="p">,</span> <span class="s">&quot;id _js&quot;</span><span class="p">,</span> <span class="s">&quot;punct =&quot;</span><span class="p">,</span> <span class="s">r&#39;&#39;&#39;string &quot;e.str(\&quot;&quot;&#39;&#39;&#39;</span><span class="p">,</span> <span class="s">&quot;punct +&quot;</span><span class="p">,</span> <span class="s">&quot;keyword this&quot;</span><span class="p">,</span> <span class="s">&quot;punct .&quot;</span><span class="p">,</span>
          <span class="s">&quot;id value&quot;</span><span class="p">,</span> <span class="s">&quot;punct .&quot;</span><span class="p">,</span> <span class="s">&quot;id replace&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">r&quot;regex /</span><span class="se">\\</span><span class="s">/g&quot;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">r&#39;string &quot;</span><span class="se">\\\\</span><span class="s">&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span>
          <span class="s">&quot;punct .&quot;</span><span class="p">,</span> <span class="s">&quot;id replace&quot;</span><span class="p">,</span> <span class="s">&quot;punct (&quot;</span><span class="p">,</span> <span class="s">r&#39;regex /&quot;/g&#39;</span><span class="p">,</span> <span class="s">&quot;punct ,&quot;</span><span class="p">,</span> <span class="s">r&#39;string &quot;</span><span class="se">\\</span><span class="s">\&quot;&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;punct )&quot;</span><span class="p">,</span> <span class="s">&quot;punct +&quot;</span><span class="p">,</span>
          <span class="s">r&#39;string &quot;\&quot;)&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;punct ;&quot;</span><span class="p">]),</span>
        <span class="p">]</span>

<span class="k">def</span> <span class="nf">make_function</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lexer</span> <span class="o">=</span> <span class="n">JsLexer</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tok</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">lexer</span><span class="o">.</span><span class="n">lex</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s">&#39;ws&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">toks</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_func</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">toks</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">JsTokensTest</span><span class="o">.</span><span class="n">LEX_CASES</span><span class="p">):</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">JsTokensTest</span><span class="p">,</span> <span class="s">&quot;test_case_</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">make_function</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">toks</span><span class="p">))</span>


<span class="n">GETTEXT_CASES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            a = 1; /* /[0-9]+/ */</span>
<span class="sd">            b = 0x2a0b / 1; // /[0-9]+/</span>
<span class="sd">            c = 3;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            a = 1; /* /[0-9]+/ */</span>
<span class="sd">            b = 0x2a0b / 1; // /[0-9]+/</span>
<span class="sd">            c = 3;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            a = 1.234e-5;</span>
<span class="sd">            /*</span>
<span class="sd">             * /[0-9+/</span>
<span class="sd">             */</span>
<span class="sd">            b = .0123;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            a = 1.234e-5;</span>
<span class="sd">            /*</span>
<span class="sd">             * /[0-9+/</span>
<span class="sd">             */</span>
<span class="sd">            b = .0123;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            x = y / z;</span>
<span class="sd">            alert(gettext(&quot;hello&quot;));</span>
<span class="sd">            x /= 3;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            x = y / z;</span>
<span class="sd">            alert(gettext(&quot;hello&quot;));</span>
<span class="sd">            x /= 3;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            s = &quot;Hello \&quot;th/foo/ere\&quot;&quot;;</span>
<span class="sd">            s = &#39;He\x23llo \&#39;th/foo/ere\&#39;&#39;;</span>
<span class="sd">            s = &#39;slash quote \&quot;, just quote &quot;&#39;;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            s = &quot;Hello \&quot;th/foo/ere\&quot;&quot;;</span>
<span class="sd">            s = &quot;He\x23llo \&#39;th/foo/ere\&#39;&quot;;</span>
<span class="sd">            s = &quot;slash quote \&quot;, just quote \&quot;&quot;;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            s = &quot;Line continuation\</span>
<span class="sd">            continued /hello/ still the string&quot;;/hello/;</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            s = &quot;Line continuation\</span>
<span class="sd">            continued /hello/ still the string&quot;;&quot;REGEX&quot;;</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            var regex = /pattern/;</span>
<span class="sd">            var regex2 = /matter/gm;</span>
<span class="sd">            var regex3 = /[*/]+/gm.foo(&quot;hey&quot;);</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            var regex = &quot;REGEX&quot;;</span>
<span class="sd">            var regex2 = &quot;REGEX&quot;;</span>
<span class="sd">            var regex3 = &quot;REGEX&quot;.foo(&quot;hey&quot;);</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z:/x:3;x&lt;5;y&lt;/g/i) {xyz(x++);}</span>
<span class="sd">            for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z/x:3;x&lt;5;y&lt;/g/i) {xyz(x++);}</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z:&quot;REGEX&quot;/i) {xyz(x++);}</span>
<span class="sd">            for (var x = a in foo &amp;&amp; &quot;&lt;/x&gt;&quot; || mot ? z/x:3;x&lt;5;y&lt;&quot;REGEX&quot;) {xyz(x++);}</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="p">),</span> <span class="p">(</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">            \u1234xyz = gettext(&#39;Hello there&#39;);</span>
<span class="sd">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">            Uu1234xyz = gettext(&quot;Hello there&quot;);</span>
<span class="s">        &quot;&quot;&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">JsToCForGettextTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">make_function</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertMultiLineEqual</span><span class="p">(</span><span class="n">prepare_js_for_gettext</span><span class="p">(</span><span class="n">js</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_func</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">GETTEXT_CASES</span><span class="p">):</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">JsToCForGettextTest</span><span class="p">,</span> <span class="s">&quot;test_case_</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">make_function</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
