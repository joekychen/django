<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › model_fields › models.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>models.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Try to import PIL in either of the two ways it can end up installed.
Checking for the existence of Image is enough for CPython, but for PyPy,
you need to check for the underlying modules.</p></td><td class="code"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">_imaging</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">Image</span><span class="o">,</span> <span class="nn">_imaging</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">Image</span> <span class="o">=</span> <span class="bp">None</span>

<span class="kn">from</span> <span class="nn">django.core.files.storage</span> <span class="kn">import</span> <span class="n">FileSystemStorage</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.fields.files</span> <span class="kn">import</span> <span class="n">ImageFieldFile</span><span class="p">,</span> <span class="n">ImageField</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">get_foo</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Whiz</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">&#39;Group 1&#39;</span><span class="p">,</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;First&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&#39;Second&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;Group 2&#39;</span><span class="p">,</span> <span class="p">(</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&#39;Third&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&#39;Fourth&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;Other&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">CHOICES</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BigD</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">38</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BigS</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">BigInt</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">()</span>
    <span class="n">null_value</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">(</span><span class="n">null</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">NullBooleanModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nbfield</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">NullBooleanField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">BooleanModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">bfield</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;abc&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RenamedField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">modelname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;fieldname&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;One&#39;</span><span class="p">),))</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>This model isn't used in any test, just here to ensure it validates successfully.
See ticket #16570.</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DecimalLessThanOne</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><h6>#</h6>

<p>FileField</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">myfile</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;unused&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><h6>#</h6>

<p>ImageField</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>If PIL available, do these tests.</p></td><td class="code"><div class="highlight"><pre><span class="k">if</span> <span class="n">Image</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">TestImageFieldFile</span><span class="p">(</span><span class="n">ImageFieldFile</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom Field File class that records whether or not the underlying file</span>
<span class="sd">        was opened.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">was_opened</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TestImageFieldFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">was_opened</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TestImageFieldFile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">TestImageField</span><span class="p">(</span><span class="n">ImageField</span><span class="p">):</span>
        <span class="n">attr_class</span> <span class="o">=</span> <span class="n">TestImageFieldFile</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Set up a temp directory for file storage.</p></td><td class="code"><div class="highlight"><pre>    <span class="n">temp_storage_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
    <span class="n">temp_storage</span> <span class="o">=</span> <span class="n">FileSystemStorage</span><span class="p">(</span><span class="n">temp_storage_dir</span><span class="p">)</span>
    <span class="n">temp_upload_to_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="s">&#39;tests&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model that defines an ImageField with no dimension fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">mugshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">PersonWithHeight</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model that defines an ImageField with only one dimension field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">mugshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">,</span>
                                 <span class="n">height_field</span><span class="o">=</span><span class="s">&#39;mugshot_height&#39;</span><span class="p">)</span>
        <span class="n">mugshot_height</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">PersonWithHeightAndWidth</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model that defines height and width fields after the ImageField.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">mugshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">,</span>
                                 <span class="n">height_field</span><span class="o">=</span><span class="s">&#39;mugshot_height&#39;</span><span class="p">,</span>
                                 <span class="n">width_field</span><span class="o">=</span><span class="s">&#39;mugshot_width&#39;</span><span class="p">)</span>
        <span class="n">mugshot_height</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>
        <span class="n">mugshot_width</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">PersonDimensionsFirst</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model that defines height and width fields before the ImageField.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">mugshot_height</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>
        <span class="n">mugshot_width</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>
        <span class="n">mugshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">,</span>
                                 <span class="n">height_field</span><span class="o">=</span><span class="s">&#39;mugshot_height&#39;</span><span class="p">,</span>
                                 <span class="n">width_field</span><span class="o">=</span><span class="s">&#39;mugshot_width&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">PersonTwoImages</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model that:</span>
<span class="sd">        * Defines two ImageFields</span>
<span class="sd">        * Defines the height/width fields before the ImageFields</span>
<span class="sd">        * Has a nullalble ImageField</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">mugshot_height</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>
        <span class="n">mugshot_width</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">()</span>
        <span class="n">mugshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">,</span>
                                 <span class="n">height_field</span><span class="o">=</span><span class="s">&#39;mugshot_height&#39;</span><span class="p">,</span>
                                 <span class="n">width_field</span><span class="o">=</span><span class="s">&#39;mugshot_width&#39;</span><span class="p">)</span>
        <span class="n">headshot_height</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span>
                <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">headshot_width</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span>
                <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">headshot</span> <span class="o">=</span> <span class="n">TestImageField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">storage</span><span class="o">=</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">&#39;tests&#39;</span><span class="p">,</span>
                                  <span class="n">height_field</span><span class="o">=</span><span class="s">&#39;headshot_height&#39;</span><span class="p">,</span>
                                  <span class="n">width_field</span><span class="o">=</span><span class="s">&#39;headshot_width&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><h6>#</h6></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
