<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › i18n › commands › extraction.py
| -*- encoding: utf-8 -*-
</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>extraction.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>-<em>- encoding: utf-8 -</em>-</p></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">management</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>


<span class="n">LOCALE</span><span class="o">=</span><span class="s">&#39;de&#39;</span>

<span class="k">class</span> <span class="nc">ExtractorTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="n">PO_FILE</span><span class="o">=</span><span class="s">&#39;locale/</span><span class="si">%s</span><span class="s">/LC_MESSAGES/django.po&#39;</span> <span class="o">%</span> <span class="n">LOCALE</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_rmrf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dname</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dname</span><span class="p">)])</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rmrf</span><span class="p">(</span><span class="s">&#39;locale/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">LOCALE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">assertMsgId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">use_quotes</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span>
        <span class="k">if</span> <span class="n">use_quotes</span><span class="p">:</span>
            <span class="n">msgid</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">msgid</span>
            <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span>
        <span class="n">needle</span> <span class="o">=</span> <span class="s">&#39;msgid </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">msgid</span>
        <span class="n">msgid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;^msgid </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">),</span> <span class="s">&#39;Could not find </span><span class="si">%(q)s%(n)s%(q)s</span><span class="s"> in generated PO file&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;n&#39;</span><span class="p">:</span><span class="n">needle</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">:</span><span class="n">q</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">assertNotMsgId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">use_quotes</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_quotes</span><span class="p">:</span>
            <span class="n">msgid</span> <span class="o">=</span> <span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">msgid</span>
        <span class="n">msgid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;^msgid </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">BasicExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_comments_extractor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: This comment should be extracted&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;This comment should not be extracted&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Comments in templates</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Django template comment for translators&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;#. Translators: Django comment block for translators</span><span class="se">\n</span><span class="s">#. string&#39;s meaning unveiled&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: One-line translator comment #1&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Two-line translator comment #1</span><span class="se">\n</span><span class="s">#. continued here.&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: One-line translator comment #2&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Two-line translator comment #2</span><span class="se">\n</span><span class="s">#. continued here.&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: One-line translator comment #3&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Two-line translator comment #3</span><span class="se">\n</span><span class="s">#. continued here.&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: One-line translator comment #4&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Two-line translator comment #4</span><span class="se">\n</span><span class="s">#. continued here.&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: One-line translator comment #5 -- with non ASCII characters: áéíóúö&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#. Translators: Two-line translator comment #5 -- with non ASCII characters: áéíóúö</span><span class="se">\n</span><span class="s">#. continued here.&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_templatize_trans_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>ticket #11240</p></td><td class="code"><div class="highlight"><pre>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;Literal with a percent symbol at the end </span><span class="si">%%</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;Literal with a percent </span><span class="si">%%</span><span class="s"> symbol in the middle&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;Completed 50</span><span class="si">%%</span><span class="s"> of all the tasks&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;Completed 99</span><span class="si">%%</span><span class="s"> of all the tasks&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t double escape this sequence: </span><span class="si">%%</span><span class="s"> (two percent signs)&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t double escape this sequence </span><span class="si">%%</span><span class="s"> either&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;Looks like a str fmt spec </span><span class="si">%%</span><span class="s">s but shouldn&#39;t be interpreted as such&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;Looks like a str fmt spec </span><span class="si">%%</span><span class="s"> o but shouldn&#39;t be interpreted as such&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_templatize_blocktrans_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>ticket #11966</p></td><td class="code"><div class="highlight"><pre>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;I think that 100</span><span class="si">%%</span><span class="s"> is more that 50</span><span class="si">%%</span><span class="s"> of anything.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;I think that 100</span><span class="si">%%</span><span class="s"> is more that 50</span><span class="si">%%</span><span class="s"> of </span><span class="si">%(obj)s</span><span class="s">.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;Blocktrans extraction shouldn&#39;t double escape this: </span><span class="si">%%</span><span class="s">, a=</span><span class="si">%(a)s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_extraction_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">&#39;./templates/template_with_error.tpl&#39;</span><span class="p">,</span> <span class="s">&#39;./templates/template_with_error.html&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span> <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">,</span> <span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">SyntaxError</span><span class="p">)</span> <span class="k">as</span> <span class="n">context_manager</span><span class="p">:</span>
            <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegexpMatches</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context_manager</span><span class="o">.</span><span class="n">exception</span><span class="p">),</span>
                <span class="s">r&#39;Translation blocks must not include other block tags: blocktrans \(file templates[/</span><span class="se">\\</span><span class="s">]template_with_error\.html, line 3\)&#39;</span>
            <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;./templates/template_with_error.html&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Check that the temporary file was cleaned up</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&#39;./templates/template_with_error.html.py&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_template_message_context_extractor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that message contexts are correctly extracted for the</span>
<span class="sd">        {% trans %} and {% blocktrans %} template tags.</span>
<span class="sd">        Refs #14806.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>{% trans %}</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special trans context #1&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #7a&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special trans context #2&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #7b&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special trans context #3&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #7c&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>{% blocktrans %}</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special blocktrans context #1&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8a&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special blocktrans context #2&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8b-singular&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8b-plural&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special blocktrans context #3&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8c-singular&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8c-plural&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;msgctxt &quot;Special blocktrans context #4&quot;&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;Translatable literal #8d&quot;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">JavascriptExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="n">PO_FILE</span><span class="o">=</span><span class="s">&#39;locale/</span><span class="si">%s</span><span class="s">/LC_MESSAGES/djangojs.po&#39;</span> <span class="o">%</span> <span class="n">LOCALE</span>

    <span class="k">def</span> <span class="nf">test_javascript_literals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&#39;djangojs&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;This literal should be included.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;This one as well.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">r&#39;He said, \&quot;hello\&quot;.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;okkkk&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;TEXT&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;It&#39;s at http://example.com&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;String&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;/* but this one will be too */ &#39;cause there is no way of telling...&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;baz&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;quz&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&quot;foobar&quot;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">IgnoredExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_ignore_option</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">pattern1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;ignore_dir&#39;</span><span class="p">,</span> <span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">ignore_patterns</span><span class="o">=</span><span class="p">[</span><span class="n">pattern1</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&quot;ignoring directory ignore_dir&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;This literal should be included.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotMsgId</span><span class="p">(</span><span class="s">&#39;This should be ignored.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SymlinkExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symlinked_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="s">&#39;templates_symlinked&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SymlinkExtractorTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symlinked_dir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cwd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_symlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;symlink&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symlinked_dir</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symlinked_dir</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">,</span> <span class="s">&#39;templates&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">symlinked_dir</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
            <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">symlinks</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;This literal should be included.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;templates_symlinked/test.html&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CopyPluralFormsExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_copy_plural_forms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;Plural-Forms: nplurals=2; plural=(n != 1)&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NoWrapExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_no_wrap_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;This literal should also be included wrapped or not wrapped depending on the use of the --no-wrap option.&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_no_wrap_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_wrap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertMsgId</span><span class="p">(</span><span class="s">&#39;&quot;&quot;</span><span class="se">\n</span><span class="s">&quot;This literal should also be included wrapped or not wrapped depending on the &quot;</span><span class="se">\n</span><span class="s">&quot;use of the --no-wrap option.&quot;&#39;</span><span class="p">,</span> <span class="n">po_contents</span><span class="p">,</span> <span class="n">use_quotes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NoLocationExtractorTests</span><span class="p">(</span><span class="n">ExtractorTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_no_location_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_location</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s">&#39;#: templates/test.html:55&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_no_location_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_dir</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;makemessages&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">LOCALE</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_location</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PO_FILE</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">po_contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;#: templates/test.html:55&#39;</span> <span class="ow">in</span> <span class="n">po_contents</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
