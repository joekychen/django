<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › i18n › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>-<em>- encoding: utf-8 -</em>-</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">local</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Context</span>
<span class="kn">from</span> <span class="nn">django.template.base</span> <span class="kn">import</span> <span class="n">TemplateSyntaxError</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">RequestFactory</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">override_settings</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>
<span class="kn">from</span> <span class="nn">django.utils.formats</span> <span class="kn">import</span> <span class="p">(</span><span class="n">get_format</span><span class="p">,</span> <span class="n">date_format</span><span class="p">,</span> <span class="n">time_format</span><span class="p">,</span>
    <span class="n">localize</span><span class="p">,</span> <span class="n">localize_input</span><span class="p">,</span> <span class="n">iter_format_modules</span><span class="p">,</span> <span class="n">get_format_modules</span><span class="p">,</span>
    <span class="n">number_format</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">django.utils.importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="kn">from</span> <span class="nn">django.utils.numberformat</span> <span class="kn">import</span> <span class="n">format</span> <span class="k">as</span> <span class="n">nformat</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">mark_safe</span><span class="p">,</span> <span class="n">SafeString</span><span class="p">,</span> <span class="n">SafeUnicode</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ugettext</span><span class="p">,</span> <span class="n">ugettext_lazy</span><span class="p">,</span> <span class="n">activate</span><span class="p">,</span>
    <span class="n">deactivate</span><span class="p">,</span> <span class="n">gettext_lazy</span><span class="p">,</span> <span class="n">pgettext</span><span class="p">,</span> <span class="n">npgettext</span><span class="p">,</span> <span class="n">to_locale</span><span class="p">,</span>
    <span class="n">get_language_info</span><span class="p">,</span> <span class="n">get_language</span><span class="p">,</span> <span class="n">get_language_from_request</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">.commands.tests</span> <span class="kn">import</span> <span class="n">can_run_extraction_tests</span><span class="p">,</span> <span class="n">can_run_compilation_tests</span>
<span class="k">if</span> <span class="n">can_run_extraction_tests</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.commands.extraction</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ExtractorTests</span><span class="p">,</span> <span class="n">BasicExtractorTests</span><span class="p">,</span>
        <span class="n">JavascriptExtractorTests</span><span class="p">,</span> <span class="n">IgnoredExtractorTests</span><span class="p">,</span> <span class="n">SymlinkExtractorTests</span><span class="p">,</span>
        <span class="n">CopyPluralFormsExtractorTests</span><span class="p">,</span> <span class="n">NoWrapExtractorTests</span><span class="p">,</span>
        <span class="n">NoLocationExtractorTests</span><span class="p">)</span>
<span class="k">if</span> <span class="n">can_run_compilation_tests</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.commands.compilation</span> <span class="kn">import</span> <span class="p">(</span><span class="n">PoFileTests</span><span class="p">,</span> <span class="n">PoFileContentsTests</span><span class="p">,</span>
        <span class="n">PercentRenderingTests</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.contenttypes.tests</span> <span class="kn">import</span> <span class="n">ContentTypeTests</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">I18nForm</span><span class="p">,</span> <span class="n">SelectDateForm</span><span class="p">,</span> <span class="n">SelectDateWidget</span><span class="p">,</span> <span class="n">CompanyForm</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Company</span><span class="p">,</span> <span class="n">TestModel</span>
<span class="kn">from</span> <span class="nn">.patterns.tests</span> <span class="kn">import</span> <span class="p">(</span><span class="n">URLRedirectWithoutTrailingSlashTests</span><span class="p">,</span>
    <span class="n">URLTranslationTests</span><span class="p">,</span> <span class="n">URLDisabledTests</span><span class="p">,</span> <span class="n">URLTagTests</span><span class="p">,</span> <span class="n">URLTestCaseBase</span><span class="p">,</span>
    <span class="n">URLRedirectWithoutTrailingSlashSettingTests</span><span class="p">,</span> <span class="n">URLNamespaceTests</span><span class="p">,</span>
    <span class="n">URLPrefixTests</span><span class="p">,</span> <span class="n">URLResponseTests</span><span class="p">,</span> <span class="n">URLRedirectTests</span><span class="p">,</span> <span class="n">PathUnusedTests</span><span class="p">)</span>


<span class="n">here</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">TranslationTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_override</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">activate</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;pl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_language</span><span class="p">(),</span> <span class="s">&#39;pl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_language</span><span class="p">(),</span> <span class="s">&#39;de&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_language</span><span class="p">(),</span> <span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">get_language</span><span class="p">(),</span> <span class="s">&#39;de&#39;</span><span class="p">)</span>
        <span class="n">deactivate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_lazy_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format string interpolation should work with *_lazy objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ugettext_lazy</span><span class="p">(</span><span class="s">&#39;Add </span><span class="si">%(name)s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Ringo&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Add Ringo&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Ringo hinzuf</span><span class="se">\xfc</span><span class="s">gen&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;pl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dodaj Ringo&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>It should be possible to compare *_lazy objects.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">s1</span> <span class="o">=</span> <span class="n">ugettext_lazy</span><span class="p">(</span><span class="s">&#39;Add </span><span class="si">%(name)s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s1</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s">&#39;Add </span><span class="si">%(name)s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s">&#39;Add </span><span class="si">%(name)s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">s2</span> <span class="o">==</span> <span class="n">s3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s2</span><span class="p">)</span>
        <span class="n">s4</span> <span class="o">=</span> <span class="n">ugettext_lazy</span><span class="p">(</span><span class="s">&#39;Some other string&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_lazy_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">ugettext_lazy</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="s">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_pgettext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Reset translation catalog to include other/locale/de</p></td><td class="code"><div class="highlight"><pre>        <span class="n">extended_locale_paths</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LOCALE_PATHS</span><span class="o">=</span><span class="n">extended_locale_paths</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">trans_real</span>
            <span class="n">trans_real</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="n">local</span><span class="p">()</span>
            <span class="n">trans_real</span><span class="o">.</span><span class="n">_translations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pgettext</span><span class="p">(</span><span class="s">&quot;unexisting&quot;</span><span class="p">,</span> <span class="s">&quot;May&quot;</span><span class="p">),</span> <span class="s">&quot;May&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pgettext</span><span class="p">(</span><span class="s">&quot;month name&quot;</span><span class="p">,</span> <span class="s">&quot;May&quot;</span><span class="p">),</span> <span class="s">&quot;Mai&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pgettext</span><span class="p">(</span><span class="s">&quot;verb&quot;</span><span class="p">,</span> <span class="s">&quot;May&quot;</span><span class="p">),</span> <span class="s">&quot;Kann&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">npgettext</span><span class="p">(</span><span class="s">&quot;search&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> result&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> results&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;4 Resultate&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_template_tags_pgettext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that message contexts are taken into account the {% trans %} and</span>
<span class="sd">        {% blocktrans %} template tags.</span>
<span class="sd">        Refs #14806.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Reset translation catalog to include other/locale/de</p></td><td class="code"><div class="highlight"><pre>        <span class="n">extended_locale_paths</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LOCALE_PATHS</span><span class="o">=</span><span class="n">extended_locale_paths</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">trans_real</span>
            <span class="n">trans_real</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="n">local</span><span class="p">()</span>
            <span class="n">trans_real</span><span class="o">.</span><span class="n">_translations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>{% trans %} -----------------------------------</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Inexisting context...</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context &quot;unexisting&quot; %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;May&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Existing context...
Using a literal</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context &quot;month name&quot; %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context &quot;verb&quot; %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Using a variable</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context message_context %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;month name&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context message_context %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;verb&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Using a filter</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context message_context|lower %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;MONTH NAME&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context message_context|lower %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;VERB&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Using 'as'</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context &quot;month name&quot; as var %}Value: {{ var }}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Value: Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; as var context &quot;verb&quot; %}Value: {{ var }}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Value: Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Mis-uses</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; context as var %}{{ var }}&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &quot;May&quot; as var context %}{{ var }}&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>{% blocktrans %} ------------------------------</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Inexisting context...</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context &quot;unexisting&quot; %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;May&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Existing context...
Using a literal</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context &quot;month name&quot; %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context &quot;verb&quot; %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Using a variable</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context message_context %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;month name&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context message_context %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;verb&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Using a filter</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context message_context|lower %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;MONTH NAME&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Mai&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context message_context|lower %}May{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;message_context&#39;</span><span class="p">:</span> <span class="s">&#39;VERB&#39;</span><span class="p">}))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Kann&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Using 'count'</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans count number=1 context &quot;super search&quot; %}{{ number }} super result{% plural %}{{ number }} super results{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;1 Super-Ergebnis&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans count number=2 context &quot;super search&quot; %}{{ number }} super result{% plural %}{{ number }} super results{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;2 Super-Ergebnisse&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context &quot;other super search&quot; count number=1 %}{{ number }} super result{% plural %}{{ number }} super results{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;1 anderen Super-Ergebnis&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context &quot;other super search&quot; count number=2 %}{{ number }} super result{% plural %}{{ number }} super results{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;2 andere Super-Ergebnisse&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Using 'with'</p></td><td class="code"><div class="highlight"><pre>                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans with num_comments=5 context &quot;comment count&quot; %}There are {{ num_comments }} comments{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Es gibt 5 Kommentare&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans with num_comments=5 context &quot;other comment count&quot; %}There are {{ num_comments }} comments{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;Andere: Es gibt 5 Kommentare&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Mis-uses</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context with month=&quot;May&quot; %}{{ month }}{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans context %}{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">TemplateSyntaxError</span><span class="p">,</span> <span class="n">Template</span><span class="p">,</span> <span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans count number=2 context %}{{ number }} super result{% plural %}{{ number }} super results{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_string_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unicode(string_concat(...)) should not raise a TypeError - #4796</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">django.utils.translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;django&#39;</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">string_concat</span><span class="p">(</span><span class="s">&quot;dja&quot;</span><span class="p">,</span> <span class="s">&quot;ngo&quot;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">test_safe_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translating a string requiring no auto-escaping shouldn&#39;t change the &quot;safe&quot; status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">mark_safe</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;Password&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SafeString</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SafeUnicode</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">ugettext</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;aPassword&#39;</span><span class="p">,</span> <span class="n">SafeString</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Passworda&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">SafeString</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Passworda&#39;</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;aPassword&#39;</span><span class="p">,</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;as&#39;</span><span class="p">,</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">mark_safe</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_maclines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translations on files with mac or dos end of lines will be converted</span>
<span class="sd">        to unix eof in .po catalogs, and they have to match when retrieved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation.trans_real</span> <span class="kn">import</span> <span class="n">translation</span> <span class="k">as</span> <span class="n">Trans</span>
        <span class="n">ca_translation</span> <span class="o">=</span> <span class="n">Trans</span><span class="p">(</span><span class="s">&#39;ca&#39;</span><span class="p">)</span>
        <span class="n">ca_translation</span><span class="o">.</span><span class="n">_catalog</span><span class="p">[</span><span class="s">&#39;Mac</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Catalan Mac</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">ca_translation</span><span class="o">.</span><span class="n">_catalog</span><span class="p">[</span><span class="s">&#39;Win</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Catalan Win</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;ca&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Catalan Mac</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">ugettext</span><span class="p">(</span><span class="s">&#39;Mac</span><span class="se">\r</span><span class="s">EOF</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Catalan Win</span><span class="se">\n</span><span class="s">EOF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">ugettext</span><span class="p">(</span><span class="s">&#39;Win</span><span class="se">\r\n</span><span class="s">EOF</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_to_locale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the to_locale function and the special case of Serbian Latin</span>
<span class="sd">        (refs #12230 and r11299)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">to_locale</span><span class="p">(</span><span class="s">&#39;en-us&#39;</span><span class="p">),</span> <span class="s">&#39;en_US&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">to_locale</span><span class="p">(</span><span class="s">&#39;sr-lat&#39;</span><span class="p">),</span> <span class="s">&#39;sr_Lat&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_to_language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the to_language function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation.trans_real</span> <span class="kn">import</span> <span class="n">to_language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">to_language</span><span class="p">(</span><span class="s">&#39;en_US&#39;</span><span class="p">),</span> <span class="s">&#39;en-us&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">to_language</span><span class="p">(</span><span class="s">&#39;sr_Lat&#39;</span><span class="p">),</span> <span class="s">&#39;sr-lat&#39;</span><span class="p">)</span>

    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">LOCALE_PATHS</span><span class="o">=</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),))</span>
    <span class="k">def</span> <span class="nf">test_bad_placeholder_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error in translation file should not crash template rendering</span>
<span class="sd">        (%(person)s is translated as %(personne)s in fr.po)</span>
<span class="sd">        Refs #16516.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Context</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}My name is {{ person }}.{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
            <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;person&#39;</span><span class="p">:</span> <span class="s">&#39;James&#39;</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;My name is James.&#39;</span><span class="p">)</span>

    <span class="nd">@override_settings</span><span class="p">(</span><span class="n">LOCALE_PATHS</span><span class="o">=</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),))</span>
    <span class="k">def</span> <span class="nf">test_bad_placeholder_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Error in translation file should not crash template rendering</span>
<span class="sd">        (%(person) misses a &#39;s&#39; in fr.po, causing the string formatting to fail)</span>
<span class="sd">        Refs #18393.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Template</span><span class="p">,</span> <span class="n">Context</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}My other name is {{ person }}.{</span><span class="si">% e</span><span class="s">ndblocktrans %}&#39;</span><span class="p">)</span>
            <span class="n">rendered</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;person&#39;</span><span class="p">:</span> <span class="s">&#39;James&#39;</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s">&#39;My other name is James.&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FormattingTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_i18n</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_l10n</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_thousand_separator</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thousand_separator</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">THOUSAND_SEPARATOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_grouping</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">NUMBER_GROUPING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mf">99999.999</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="il">10000L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span>
            <span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span>
            <span class="s">&#39;t&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
            <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
            <span class="s">&#39;dt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
            <span class="s">&#39;l&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Restore defaults</p></td><td class="code"><div class="highlight"><pre>        <span class="n">settings</span><span class="o">.</span><span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_i18n</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l10n</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_thousand_separator</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thousand_separator</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">NUMBER_GROUPING</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_grouping</span>

    <span class="k">def</span> <span class="nf">test_locale_independent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Localization of numbers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.66&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">thousand_sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666A6&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thousand_sep</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thousand_sep</span><span class="o">=</span><span class="s">&#39;Y&#39;</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66,666.66&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">thousand_sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;6B6B6B6B6A6&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thousand_sep</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;-66666.6&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="o">-</span><span class="mf">66666.666</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;-66666.0&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;-66666&#39;</span><span class="p">),</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10000.0&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>This unusual grouping/force_grouping combination may be triggered by the intcomma filter (#17414)</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10000&#39;</span><span class="p">,</span> <span class="n">nformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">decimal_sep</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">decimal_pos</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_grouping</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>date filter</p></td><td class="code"><div class="highlight"><pre>            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31.12.2009 в 20:50&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt|date:&quot;d.m.Y в H:i&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;⌚ 10:15&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ t|time:&quot;⌚ H:i&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_l10n_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catalan locale with format i18n disabled translations will be used,</span>
<span class="sd">        but not formats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;ca&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;N j, Y&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DATE_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;FIRST_DAY_OF_WEEK&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DECIMAL_SEPARATOR&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10:15 a.m.&#39;</span><span class="p">,</span> <span class="n">time_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;des. 31, 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;desembre 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="s">&#39;YEAR_MONTH_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="s">&#39;SHORT_DATETIME_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999.999&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10000&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;des. 31, 2009&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;des. 31, 2009, 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999.999&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;des. 31, 2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;des. 31, 2009, 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.67&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n|floatformat:2 }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;100000.0&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f|floatformat }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10:15 a.m.&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ t|time:&quot;TIME_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d|date:&quot;SHORT_DATE_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt|date:&quot;SHORT_DATETIME_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

            <span class="n">form</span> <span class="o">=</span> <span class="n">I18nForm</span><span class="p">({</span>
                <span class="s">&#39;decimal_field&#39;</span><span class="p">:</span> <span class="s">&#39;66666,666&#39;</span><span class="p">,</span>
                <span class="s">&#39;float_field&#39;</span><span class="p">:</span> <span class="s">&#39;99999,999&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009&#39;</span><span class="p">,</span>
                <span class="s">&#39;datetime_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009 20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;time_field&#39;</span><span class="p">:</span> <span class="s">&#39;20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;integer_field&#39;</span><span class="p">:</span> <span class="s">&#39;1.234&#39;</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Introdu</span><span class="se">\xef</span><span class="s">u un n</span><span class="se">\xfa</span><span class="s">mero.&#39;</span><span class="p">],</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;float_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Introdu</span><span class="se">\xef</span><span class="s">u un n</span><span class="se">\xfa</span><span class="s">mero.&#39;</span><span class="p">],</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;decimal_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Introdu</span><span class="se">\xef</span><span class="s">u una data v</span><span class="se">\xe0</span><span class="s">lida.&#39;</span><span class="p">],</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Introdu</span><span class="se">\xef</span><span class="s">u una data/hora v</span><span class="se">\xe0</span><span class="s">lides.&#39;</span><span class="p">],</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;datetime_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s">&#39;Introdu</span><span class="se">\xef</span><span class="s">u un n</span><span class="se">\xfa</span><span class="s">mero sencer.&#39;</span><span class="p">],</span> <span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;integer_field&#39;</span><span class="p">])</span>

            <span class="n">form2</span> <span class="o">=</span> <span class="n">SelectDateForm</span><span class="p">({</span>
                <span class="s">&#39;date_field_month&#39;</span><span class="p">:</span> <span class="s">&#39;12&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_day&#39;</span><span class="p">:</span> <span class="s">&#39;31&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_year&#39;</span><span class="p">:</span> <span class="s">&#39;2009&#39;</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form2</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form2</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
                <span class="s">&#39;&lt;select name=&quot;mydate_month&quot; id=&quot;id_mydate_month&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;gener&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;febrer&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;mar</span><span class="se">\xe7</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;abril&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;maig&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;juny&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;juliol&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;agost&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;setembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;octubre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;novembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot; selected=&quot;selected&quot;&gt;desembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_day&quot; id=&quot;id_mydate_day&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;6&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;7&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;8&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;9&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;10&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;11&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot;&gt;12&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;13&quot;&gt;13&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;14&quot;&gt;14&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;15&quot;&gt;15&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;16&quot;&gt;16&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;17&quot;&gt;17&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;18&quot;&gt;18&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;19&quot;&gt;19&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;20&quot;&gt;20&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;21&quot;&gt;21&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;22&quot;&gt;22&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;23&quot;&gt;23&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;24&quot;&gt;24&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;25&quot;&gt;25&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;26&quot;&gt;26&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;27&quot;&gt;27&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;28&quot;&gt;28&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;29&quot;&gt;29&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;30&quot;&gt;30&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;31&quot; selected=&quot;selected&quot;&gt;31&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_year&quot; id=&quot;id_mydate_year&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2009&quot; selected=&quot;selected&quot;&gt;2009&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2010&quot;&gt;2010&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2011&quot;&gt;2011&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2012&quot;&gt;2012&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2013&quot;&gt;2013&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2014&quot;&gt;2014&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2015&quot;&gt;2015&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2016&quot;&gt;2016&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2017&quot;&gt;2017&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2018&quot;&gt;2018&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;&#39;</span><span class="p">,</span>
                <span class="n">SelectDateWidget</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2019</span><span class="p">))</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;mydate&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
            <span class="p">)</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>We shouldn't change the behavior of the floatformat filter re:
thousand separator and grouping when USE<em>L10N is False even
if the USE</em>THOUSAND<em>SEPARATOR, NUMBER</em>GROUPING and
THOUSAND_SEPARATOR settings are specified</p></td><td class="code"><div class="highlight"><pre>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">NUMBER_GROUPING</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">THOUSAND_SEPARATOR</span><span class="o">=</span><span class="s">&#39;!&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.67&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n|floatformat:2 }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;100000.0&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f|floatformat }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_false_like_locale_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the active locale&#39;s formats take precedence over the</span>
<span class="sd">        default settings even if they would be interpreted as False in a</span>
<span class="sd">        conditional test (e.g. 0 or empty string).</span>
<span class="sd">        Refs #16938.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.conf.locale.fr</span> <span class="kn">import</span> <span class="n">formats</span> <span class="k">as</span> <span class="n">fr_formats</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Back up original formats</p></td><td class="code"><div class="highlight"><pre>        <span class="n">backup_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="n">fr_formats</span><span class="o">.</span><span class="n">THOUSAND_SEPARATOR</span>
        <span class="n">backup_FIRST_DAY_OF_WEEK</span> <span class="o">=</span> <span class="n">fr_formats</span><span class="o">.</span><span class="n">FIRST_DAY_OF_WEEK</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Set formats that would get interpreted as False in a conditional test</p></td><td class="code"><div class="highlight"><pre>        <span class="n">fr_formats</span><span class="o">.</span><span class="n">THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">fr_formats</span><span class="o">.</span><span class="n">FIRST_DAY_OF_WEEK</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">THOUSAND_SEPARATOR</span><span class="o">=</span><span class="s">&#39;!&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;THOUSAND_SEPARATOR&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Even a second time (after the format has been cached)...</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;THOUSAND_SEPARATOR&#39;</span><span class="p">))</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">FIRST_DAY_OF_WEEK</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;FIRST_DAY_OF_WEEK&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Even a second time (after the format has been cached)...</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;FIRST_DAY_OF_WEEK&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Restore original formats</p></td><td class="code"><div class="highlight"><pre>        <span class="n">fr_formats</span><span class="o">.</span><span class="n">THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="n">backup_THOUSAND_SEPARATOR</span>
        <span class="n">fr_formats</span><span class="o">.</span><span class="n">FIRST_DAY_OF_WEEK</span> <span class="o">=</span> <span class="n">backup_FIRST_DAY_OF_WEEK</span>

    <span class="k">def</span> <span class="nf">test_l10n_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>Catalan locale</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;ca&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;j \d\e F \d\e Y&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DATE_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;FIRST_DAY_OF_WEEK&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DECIMAL_SEPARATOR&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10:15:48&#39;</span><span class="p">,</span> <span class="n">time_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de desembre de 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;desembre del 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="s">&#39;YEAR_MONTH_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31/12/2009 20:50&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="s">&#39;SHORT_DATETIME_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66.666,666&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99.999,999&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10.000&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666,666&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999,999&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10000&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de desembre de 2009&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de desembre de 2009 a les 20:50&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66.666,666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99.999,999&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10.000&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ l }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

            <span class="n">form3</span> <span class="o">=</span> <span class="n">I18nForm</span><span class="p">({</span>
                <span class="s">&#39;decimal_field&#39;</span><span class="p">:</span> <span class="s">&#39;66.666,666&#39;</span><span class="p">,</span>
                <span class="s">&#39;float_field&#39;</span><span class="p">:</span> <span class="s">&#39;99.999,999&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009&#39;</span><span class="p">,</span>
                <span class="s">&#39;datetime_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009 20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;time_field&#39;</span><span class="p">:</span> <span class="s">&#39;20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;integer_field&#39;</span><span class="p">:</span> <span class="s">&#39;1.234&#39;</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form3</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">),</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;decimal_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">99999.999</span><span class="p">,</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;float_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;datetime_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;time_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="n">form3</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;integer_field&#39;</span><span class="p">])</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666,666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999,999&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de desembre de 2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de desembre de 2009 a les 20:50&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666,67&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n|floatformat:2 }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;100000,0&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f|floatformat }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10:15:48&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ t|time:&quot;TIME_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31/12/2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d|date:&quot;SHORT_DATE_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31/12/2009 20:50&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt|date:&quot;SHORT_DATETIME_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">date_format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="s">&quot;DATE_FORMAT&quot;</span><span class="p">),</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{% now &quot;DATE_FORMAT&quot; %}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

            <span class="n">form4</span> <span class="o">=</span> <span class="n">I18nForm</span><span class="p">({</span>
                <span class="s">&#39;decimal_field&#39;</span><span class="p">:</span> <span class="s">&#39;66666,666&#39;</span><span class="p">,</span>
                <span class="s">&#39;float_field&#39;</span><span class="p">:</span> <span class="s">&#39;99999,999&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009&#39;</span><span class="p">,</span>
                <span class="s">&#39;datetime_field&#39;</span><span class="p">:</span> <span class="s">&#39;31/12/2009 20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;time_field&#39;</span><span class="p">:</span> <span class="s">&#39;20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;integer_field&#39;</span><span class="p">:</span> <span class="s">&#39;1234&#39;</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form4</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">),</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;decimal_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">99999.999</span><span class="p">,</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;float_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;datetime_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;time_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="n">form4</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;integer_field&#39;</span><span class="p">])</span>

            <span class="n">form5</span> <span class="o">=</span> <span class="n">SelectDateForm</span><span class="p">({</span>
                <span class="s">&#39;date_field_month&#39;</span><span class="p">:</span> <span class="s">&#39;12&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_day&#39;</span><span class="p">:</span> <span class="s">&#39;31&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_year&#39;</span><span class="p">:</span> <span class="s">&#39;2009&#39;</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form5</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
                <span class="s">&#39;&lt;select name=&quot;mydate_day&quot; id=&quot;id_mydate_day&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;6&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;7&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;8&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;9&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;10&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;11&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot;&gt;12&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;13&quot;&gt;13&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;14&quot;&gt;14&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;15&quot;&gt;15&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;16&quot;&gt;16&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;17&quot;&gt;17&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;18&quot;&gt;18&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;19&quot;&gt;19&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;20&quot;&gt;20&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;21&quot;&gt;21&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;22&quot;&gt;22&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;23&quot;&gt;23&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;24&quot;&gt;24&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;25&quot;&gt;25&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;26&quot;&gt;26&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;27&quot;&gt;27&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;28&quot;&gt;28&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;29&quot;&gt;29&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;30&quot;&gt;30&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;31&quot; selected=&quot;selected&quot;&gt;31&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_month&quot; id=&quot;id_mydate_month&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;gener&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;febrer&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;mar</span><span class="se">\xe7</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;abril&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;maig&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;juny&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;juliol&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;agost&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;setembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;octubre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;novembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot; selected=&quot;selected&quot;&gt;desembre&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_year&quot; id=&quot;id_mydate_year&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2009&quot; selected=&quot;selected&quot;&gt;2009&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2010&quot;&gt;2010&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2011&quot;&gt;2011&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2012&quot;&gt;2012&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2013&quot;&gt;2013&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2014&quot;&gt;2014&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2015&quot;&gt;2015&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2016&quot;&gt;2016&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2017&quot;&gt;2017&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2018&quot;&gt;2018&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;&#39;</span><span class="p">,</span>
                <span class="n">SelectDateWidget</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2019</span><span class="p">))</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;mydate&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
            <span class="p">)</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>Russian locale (with E as month)</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;ru&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
                    <span class="s">&#39;&lt;select name=&quot;mydate_day&quot; id=&quot;id_mydate_day&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;6&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;7&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;8&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;9&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;10&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;11&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot;&gt;12&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;13&quot;&gt;13&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;14&quot;&gt;14&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;15&quot;&gt;15&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;16&quot;&gt;16&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;17&quot;&gt;17&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;18&quot;&gt;18&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;19&quot;&gt;19&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;20&quot;&gt;20&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;21&quot;&gt;21&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;22&quot;&gt;22&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;23&quot;&gt;23&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;24&quot;&gt;24&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;25&quot;&gt;25&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;26&quot;&gt;26&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;27&quot;&gt;27&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;28&quot;&gt;28&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;29&quot;&gt;29&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;30&quot;&gt;30&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;31&quot; selected=&quot;selected&quot;&gt;31&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_month&quot; id=&quot;id_mydate_month&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;</span><span class="se">\u042f\u043d\u0432\u0430\u0440\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;</span><span class="se">\u0424\u0435\u0432\u0440\u0430\u043b\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;</span><span class="se">\u041c\u0430\u0440\u0442</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;</span><span class="se">\u0410\u043f\u0440\u0435\u043b\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;</span><span class="se">\u041c\u0430\u0439</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;</span><span class="se">\u0418\u044e\u043d\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;</span><span class="se">\u0418\u044e\u043b\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;</span><span class="se">\u0410\u0432\u0433\u0443\u0441\u0442</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;</span><span class="se">\u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;</span><span class="se">\u041e\u043a\u0442\u044f\u0431\u0440\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;</span><span class="se">\u041d\u043e\u044f\u0431\u0440\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot; selected=&quot;selected&quot;&gt;</span><span class="se">\u0414\u0435\u043a\u0430\u0431\u0440\u044c</span><span class="s">&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_year&quot; id=&quot;id_mydate_year&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2009&quot; selected=&quot;selected&quot;&gt;2009&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2010&quot;&gt;2010&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2011&quot;&gt;2011&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2012&quot;&gt;2012&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2013&quot;&gt;2013&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2014&quot;&gt;2014&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2015&quot;&gt;2015&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2016&quot;&gt;2016&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2017&quot;&gt;2017&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2018&quot;&gt;2018&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;&#39;</span><span class="p">,</span>
                    <span class="n">SelectDateWidget</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2019</span><span class="p">))</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;mydate&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
            <span class="p">)</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>English locale</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;N j, Y&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DATE_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;FIRST_DAY_OF_WEEK&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DECIMAL_SEPARATOR&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dec. 31, 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;December 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="s">&#39;YEAR_MONTH_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="s">&#39;SHORT_DATETIME_FORMAT&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="s">&#39;No localizable&#39;</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66,666.666&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99,999.999&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10,000&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999.999&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10000&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dec. 31, 2009&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dec. 31, 2009, 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">localize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66,666.666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99,999.999&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;10,000&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ l }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;99999.999&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dec. 31, 2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;Dec. 31, 2009, 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66666.67&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n|floatformat:2 }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;100000.0&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ f|floatformat }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ d|date:&quot;SHORT_DATE_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;12/31/2009 8:50 p.m.&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ dt|date:&quot;SHORT_DATETIME_FORMAT&quot; }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>

            <span class="n">form5</span> <span class="o">=</span> <span class="n">I18nForm</span><span class="p">({</span>
                <span class="s">&#39;decimal_field&#39;</span><span class="p">:</span> <span class="s">&#39;66666.666&#39;</span><span class="p">,</span>
                <span class="s">&#39;float_field&#39;</span><span class="p">:</span> <span class="s">&#39;99999.999&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field&#39;</span><span class="p">:</span> <span class="s">&#39;12/31/2009&#39;</span><span class="p">,</span>
                <span class="s">&#39;datetime_field&#39;</span><span class="p">:</span> <span class="s">&#39;12/31/2009 20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;time_field&#39;</span><span class="p">:</span> <span class="s">&#39;20:50&#39;</span><span class="p">,</span>
                <span class="s">&#39;integer_field&#39;</span><span class="p">:</span> <span class="s">&#39;1234&#39;</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form5</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;66666.666&#39;</span><span class="p">),</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;decimal_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">99999.999</span><span class="p">,</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;float_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;datetime_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;time_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="n">form5</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;integer_field&#39;</span><span class="p">])</span>

            <span class="n">form6</span> <span class="o">=</span> <span class="n">SelectDateForm</span><span class="p">({</span>
                <span class="s">&#39;date_field_month&#39;</span><span class="p">:</span> <span class="s">&#39;12&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_day&#39;</span><span class="p">:</span> <span class="s">&#39;31&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_field_year&#39;</span><span class="p">:</span> <span class="s">&#39;2009&#39;</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form6</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">),</span> <span class="n">form6</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_field&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
                <span class="s">&#39;&lt;select name=&quot;mydate_month&quot; id=&quot;id_mydate_month&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;January&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;February&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;March&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;April&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;May&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;June&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;July&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;August&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;September&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;October&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;November&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot; selected=&quot;selected&quot;&gt;December&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_day&quot; id=&quot;id_mydate_day&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;5&quot;&gt;5&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;6&quot;&gt;6&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;7&quot;&gt;7&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;8&quot;&gt;8&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;9&quot;&gt;9&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;10&quot;&gt;10&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;11&quot;&gt;11&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;12&quot;&gt;12&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;13&quot;&gt;13&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;14&quot;&gt;14&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;15&quot;&gt;15&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;16&quot;&gt;16&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;17&quot;&gt;17&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;18&quot;&gt;18&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;19&quot;&gt;19&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;20&quot;&gt;20&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;21&quot;&gt;21&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;22&quot;&gt;22&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;23&quot;&gt;23&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;24&quot;&gt;24&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;25&quot;&gt;25&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;26&quot;&gt;26&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;27&quot;&gt;27&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;28&quot;&gt;28&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;29&quot;&gt;29&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;30&quot;&gt;30&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;31&quot; selected=&quot;selected&quot;&gt;31&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;</span><span class="se">\n</span><span class="s">&lt;select name=&quot;mydate_year&quot; id=&quot;id_mydate_year&quot;&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2009&quot; selected=&quot;selected&quot;&gt;2009&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2010&quot;&gt;2010&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2011&quot;&gt;2011&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2012&quot;&gt;2012&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2013&quot;&gt;2013&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2014&quot;&gt;2014&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2015&quot;&gt;2015&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2016&quot;&gt;2016&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2017&quot;&gt;2017&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;option value=&quot;2018&quot;&gt;2018&lt;/option&gt;</span><span class="se">\n</span><span class="s">&lt;/select&gt;&#39;</span><span class="p">,</span>
                <span class="n">SelectDateWidget</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2019</span><span class="p">))</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;mydate&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_sub_locales</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if sublocales fall back to the main locale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de-at&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;66.666,666&#39;</span><span class="p">,</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{{ n }}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctxt</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;es-us&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;31 de diciembre de 2009&#39;</span><span class="p">,</span> <span class="n">date_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_localized_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests if form input is correctly localized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de-at&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">form6</span> <span class="o">=</span> <span class="n">CompanyForm</span><span class="p">({</span>
                <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;acme&#39;</span><span class="p">,</span>
                <span class="s">&#39;date_added&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s">&#39;cents_paid&#39;</span><span class="p">:</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;59.47&#39;</span><span class="p">),</span>
                <span class="s">&#39;products_delivered&#39;</span><span class="p">:</span> <span class="mi">12000</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">form6</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
                <span class="n">form6</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span>
                <span class="s">&#39;&lt;li&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; value=&quot;acme&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span><span class="se">\n</span><span class="s">&lt;li&gt;&lt;label for=&quot;id_date_added&quot;&gt;Date added:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;date_added&quot; value=&quot;31.12.2009 06:00:00&quot; id=&quot;id_date_added&quot; /&gt;&lt;/li&gt;</span><span class="se">\n</span><span class="s">&lt;li&gt;&lt;label for=&quot;id_cents_paid&quot;&gt;Cents paid:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;cents_paid&quot; value=&quot;59,47&quot; id=&quot;id_cents_paid&quot; /&gt;&lt;/li&gt;</span><span class="se">\n</span><span class="s">&lt;li&gt;&lt;label for=&quot;id_products_delivered&quot;&gt;Products delivered:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;products_delivered&quot; value=&quot;12000&quot; id=&quot;id_products_delivered&quot; /&gt;&lt;/li&gt;&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">localize_input</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="s">&#39;31.12.2009 06:00:00&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">form6</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;date_added&#39;</span><span class="p">])</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_THOUSAND_SEPARATOR</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Checking for the localized "products_delivered" field</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;&lt;input type=&quot;text&quot; name=&quot;products_delivered&quot; value=&quot;12.000&quot; id=&quot;id_products_delivered&quot; /&gt;&#39;</span> <span class="ow">in</span> <span class="n">form6</span><span class="o">.</span><span class="n">as_ul</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_iter_format_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the iter_format_modules function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de-at&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">de_format_mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;django.conf.locale.de.formats&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iter_format_modules</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="n">de_format_mod</span><span class="p">])</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">FORMAT_MODULE_PATH</span><span class="o">=</span><span class="s">&#39;regressiontests.i18n.other.locale&#39;</span><span class="p">):</span>
                <span class="n">test_de_format_mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;regressiontests.i18n.other.locale.de.formats&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iter_format_modules</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="n">test_de_format_mod</span><span class="p">,</span> <span class="n">de_format_mod</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_iter_format_modules_stability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the iter_format_modules function always yields format modules in</span>
<span class="sd">        a stable and correct order in presence of both base ll and ll_CC formats.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">en_format_mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;django.conf.locale.en.formats&#39;</span><span class="p">)</span>
        <span class="n">en_gb_format_mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;django.conf.locale.en_GB.formats&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">iter_format_modules</span><span class="p">(</span><span class="s">&#39;en-gb&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="n">en_gb_format_mod</span><span class="p">,</span> <span class="n">en_format_mod</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_get_format_modules_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">get_format</span><span class="p">(</span><span class="s">&#39;DECIMAL_SEPARATOR&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_get_format_modules_stability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">FORMAT_MODULE_PATH</span><span class="o">=</span><span class="s">&#39;regressiontests.i18n.other.locale&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">old</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_format_modules</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">new</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">get_format_modules</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># second try</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="s">&#39;Value returned by get_formats_modules() must be preserved between calls.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_localize_templatetag_and_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests the {% localize %} templatetag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">3.14</span> <span class="p">})</span>
        <span class="n">template1</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad l10n %}{</span><span class="si">% lo</span><span class="s">calize %}{{ value }}{</span><span class="si">% e</span><span class="s">ndlocalize %};{</span><span class="si">% lo</span><span class="s">calize on %}{{ value }}{</span><span class="si">% e</span><span class="s">ndlocalize %}&quot;</span><span class="p">)</span>
        <span class="n">template2</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad l10n %}{{ value }};{</span><span class="si">% lo</span><span class="s">calize off %}{{ value }};{</span><span class="si">% e</span><span class="s">ndlocalize %}{{ value }}&quot;</span><span class="p">)</span>
        <span class="n">template3</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad l10n %}{{ value }};{{ value|unlocalize }}&#39;</span><span class="p">)</span>
        <span class="n">template4</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;{</span><span class="si">% lo</span><span class="s">ad l10n %}{{ value }};{{ value|localize }}&#39;</span><span class="p">)</span>
        <span class="n">output1</span> <span class="o">=</span> <span class="s">&#39;3,14;3,14&#39;</span>
        <span class="n">output2</span> <span class="o">=</span> <span class="s">&#39;3,14;3.14;3,14&#39;</span>
        <span class="n">output3</span> <span class="o">=</span> <span class="s">&#39;3,14;3.14&#39;</span>
        <span class="n">output4</span> <span class="o">=</span> <span class="s">&#39;3.14;3,14&#39;</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">template1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">output1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">template4</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">output4</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">USE_L10N</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">template1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">output1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">template2</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">output2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">template3</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">),</span> <span class="n">output3</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MiscTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf</span> <span class="o">=</span> <span class="n">RequestFactory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_parse_spec_http_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Testing HTTP header parsing. First, we test that we can parse the</span>
<span class="sd">        values according to the spec (and that we extract all the pieces in</span>
<span class="sd">        the right order).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation.trans_real</span> <span class="kn">import</span> <span class="n">parse_accept_lang_header</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">parse_accept_lang_header</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Good headers.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en-AU&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-AU&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;*;q=1.00&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en-AU&#39;</span><span class="p">,</span> <span class="mf">0.123</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-AU;q=0.123&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en-au&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-au;q=0.5&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en-au&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-au;q=1.0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;da&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;en-gb&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;da, en-gb;q=0.25, en;q=0.5&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en-au-xx&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-au-xx&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;en-au&#39;</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;en-us&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;es&#39;</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;fa&#39;</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;de,en-au;q=0.75,en-us;q=0.5,en;q=0.25,es;q=0.125,fa;q=0.125&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;de;q=0.&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en; q=1.0, * ; q=0.5&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>Bad headers; should always return [].</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-gb;q=1.0000&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en;q=0.1234&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en;q=.2&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;abcdefghi-au&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;**&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en,,gb&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;en-au;q=0.1.0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXZ,en&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;da, en-gb;q=0.8, en;q=0.7,#&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;de;q=2.0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;de;q=0.a&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">p</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_parse_literal_http_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Now test that we parse a literal HTTP header correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">get_language_from_request</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;pt-br&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;pt-br&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;pt&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;pt&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;es,de&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;es&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;es-ar,de&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;es-ar&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>This test assumes there won't be a Django translation to a US
variation of the Spanish language, a safe assumption. When the
user sets it as the preferred language, the main 'es'
translation should be selected instead.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;es-us&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s">&#39;es&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>This tests the following scenario: there isn't a main language (zh)
translation of Django but there is a translation to variation (zh_CN)
the user sets zh-cn as the preferred language, it should be selected
by Django without falling back nor ignoring it.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;zh-cn,de&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s">&#39;zh-cn&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_parse_language_cookie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Now test that we parse language preferences stored in a cookie correctly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">get_language_from_request</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">:</span> <span class="s">&#39;pt-br&#39;</span><span class="p">}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;pt-br&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">:</span> <span class="s">&#39;pt&#39;</span><span class="p">}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;pt&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">:</span> <span class="s">&#39;es&#39;</span><span class="p">}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;de&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s">&#39;es&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>This test assumes there won't be a Django translation to a US
variation of the Spanish language, a safe assumption. When the
user sets it as the preferred language, the main 'es'
translation should be selected instead.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">:</span> <span class="s">&#39;es-us&#39;</span><span class="p">}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s">&#39;es&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>This tests the following scenario: there isn't a main language (zh)
translation of Django but there is a translation to variation (zh_CN)
the user sets zh-cn as the preferred language, it should be selected
by Django without falling back nor ignoring it.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">r</span><span class="o">.</span><span class="n">COOKIES</span> <span class="o">=</span> <span class="p">{</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">:</span> <span class="s">&#39;zh-cn&#39;</span><span class="p">}</span>
        <span class="n">r</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;HTTP_ACCEPT_LANGUAGE&#39;</span><span class="p">:</span> <span class="s">&#39;de&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s">&#39;zh-cn&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_language_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation.trans_real</span> <span class="kn">import</span> <span class="n">get_language_from_path</span> <span class="k">as</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/pl/&#39;</span><span class="p">),</span> <span class="s">&#39;pl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/pl&#39;</span><span class="p">),</span> <span class="s">&#39;pl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/xyz/&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get_language_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation.trans_null</span> <span class="kn">import</span> <span class="n">get_language_from_path</span> <span class="k">as</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/pl/&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/pl&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="s">&#39;/xyz/&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_percent_in_translatable_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">extended_locale_paths</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">LOCALE_PATHS</span><span class="o">=</span><span class="n">extended_locale_paths</span><span class="p">):</span>
            <span class="n">t_sing</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}The result was {{ percent }}%{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span>
            <span class="n">t_plur</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans count num as number %}{{ percent }}</span><span class="si">% r</span><span class="s">epresents {{ num }} object{% plural %}{{ percent }}</span><span class="si">% r</span><span class="s">epresents {{ num }} objects{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t_sing</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;percent&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})),</span> <span class="s">&#39;Das Ergebnis war 42%&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t_plur</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;percent&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;num&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})),</span> <span class="s">&#39;42</span><span class="si">% s</span><span class="s">tellt 1 Objekt dar&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t_plur</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({</span><span class="s">&#39;percent&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;num&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})),</span> <span class="s">&#39;42</span><span class="si">% s</span><span class="s">tellt 4 Objekte dar&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ResolutionOrderI18NTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">trans_real</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Okay, this is brutal, but we have no other choice to fully reset
the translation framework</p></td><td class="code"><div class="highlight"><pre>        <span class="n">trans_real</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="n">local</span><span class="p">()</span>
        <span class="n">trans_real</span><span class="o">.</span><span class="n">_translations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">activate</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">deactivate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assertUgettext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">msgstr</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">ugettext</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">msgstr</span> <span class="ow">in</span> <span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The string &#39;</span><span class="si">%s</span><span class="s">&#39; isn&#39;t in the &quot;</span>
            <span class="s">&quot;translation of &#39;</span><span class="si">%s</span><span class="s">&#39;; the actual result is &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">msgstr</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="n">result</span><span class="p">)))</span>

<span class="k">class</span> <span class="nc">AppResolutionOrderI18NTests</span><span class="p">(</span><span class="n">ResolutionOrderI18NTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_installed_apps</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;regressiontests.i18n.resolution&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AppResolutionOrderI18NTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_installed_apps</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AppResolutionOrderI18NTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_app_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertUgettext</span><span class="p">(</span><span class="s">&#39;Date/time&#39;</span><span class="p">,</span> <span class="s">&#39;APP&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">LocalePathsResolutionOrderI18NTests</span><span class="p">(</span><span class="n">ResolutionOrderI18NTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_locale_paths</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span> <span class="o">+=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">here</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;locale&#39;</span><span class="p">),)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalePathsResolutionOrderI18NTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">LOCALE_PATHS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_locale_paths</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LocalePathsResolutionOrderI18NTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_locale_paths_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertUgettext</span><span class="p">(</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;LOCALE_PATHS&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_locale_paths_override_app_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">extended_apps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;regressiontests.i18n.resolution&#39;</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">INSTALLED_APPS</span><span class="o">=</span><span class="n">extended_apps</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertUgettext</span><span class="p">(</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;LOCALE_PATHS&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DjangoFallbackResolutionOrderI18NTests</span><span class="p">(</span><span class="n">ResolutionOrderI18NTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_django_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ugettext</span><span class="p">(</span><span class="s">&#39;Date/time&#39;</span><span class="p">),</span> <span class="s">&#39;Datum/Zeit&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestModels</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_lazy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">TestModel</span><span class="p">()</span>
        <span class="n">tm</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_safestr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Company</span><span class="p">(</span><span class="n">cents_paid</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">products_delivered</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SafeUnicode</span><span class="p">(</span><span class="s">&#39;Iñtërnâtiônàlizætiøn1&#39;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SafeString</span><span class="p">(</span><span class="s">&#39;Iñtërnâtiônàlizætiøn1&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">TestLanguageInfo</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_localized_language_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">li</span> <span class="o">=</span> <span class="n">get_language_info</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="s">&#39;de&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;name_local&#39;</span><span class="p">],</span> <span class="s">&#39;Deutsch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="s">&#39;German&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;bidi&#39;</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MultipleLocaleActivationTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests for template rendering behavior when multiple locales are activated</span>
<span class="sd">    during the lifetime of the same process.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span> <span class="o">=</span> <span class="n">get_language</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">activate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_single_locale_activation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple baseline behavior with one locale for all the supported i18n constructs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;fr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Template</span><span class="p">(</span><span class="s">&quot;{{ _(&#39;Yes&#39;) }}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Oui&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &#39;Yes&#39; %}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Oui&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}Yes{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Oui&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Literal marked up with _() in a filter expression</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_multiple_locale_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ 0|yesno:_(&#39;yes,no,maybe&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_filter_deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ 0|yesno:_(&#39;yes,no,maybe&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_filter_direct_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ 0|yesno:_(&#39;yes,no,maybe&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;nee&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>Literal marked up with _()</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_multiple_locale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_direct_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>Literal marked up with _(), loading the i18n template tag library</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_multiple_locale_loadi18n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_loadi18n_deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_loadi18n_direct_switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{{ _(&#39;No&#39;) }}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>trans i18n tag</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_multiple_locale_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &#39;No&#39; %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_deactivate_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &#39;No&#39; %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_direct_switch_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% trans &#39;No&#39; %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>blocktrans i18n tag</p></td><td class="code"><div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_multiple_locale_btrans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}No{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_old_language</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_deactivate_btrans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}No{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_locale_direct_switch_btrans</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;de&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{</span><span class="si">% lo</span><span class="s">ad i18n %}{% blocktrans %}No{</span><span class="si">% e</span><span class="s">ndblocktrans %}&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="s">&#39;nl&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">({})),</span> <span class="s">&#39;Nee&#39;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
