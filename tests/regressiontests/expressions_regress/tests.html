<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › expressions_regress › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Spanning tests for all the operations that F() expressions can perform.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">,</span> <span class="n">skipUnlessDBFeature</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Number</span><span class="p">,</span> <span class="n">Experiment</span>


<span class="k">class</span> <span class="nc">ExpressionsRegressTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Number</span><span class="p">(</span><span class="n">integer</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">Number</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">Number</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">1337</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)),</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_fill_with_value_from_same_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We can fill a value in all objects with an other value of the</span>
<span class="sd">        same object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
                <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                <span class="p">[</span>
                    <span class="s">&#39;&lt;Number: -1, -1.000&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;Number: 42, 42.000&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;Number: 1337, 1337.000&gt;&#39;</span>
                <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_increment_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We can increment a value of all objects in a query set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">integer__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
                <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                <span class="p">[</span>
                    <span class="s">&#39;&lt;Number: -1, -1.000&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;Number: 43, 42.000&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;Number: 1338, 1337.000&gt;&#39;</span>
                <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_filter_not_equals_other_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We can filter for objects, where a value is not equals the value</span>
<span class="sd">        of an other field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">integer__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
                <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)),</span>
                <span class="p">[</span>
                    <span class="s">&#39;&lt;Number: 43, 42.000&gt;&#39;</span><span class="p">,</span>
                    <span class="s">&#39;&lt;Number: 1338, 1337.000&gt;&#39;</span>
                <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_complex_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex expressions of different connection types are possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="mf">123.45</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
                                <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
                          <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">256.900</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">ExpressionOperatorTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="nb">float</span><span class="o">=</span><span class="mf">15.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_lefthand_addition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>LH Addition of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">15</span><span class="p">,</span>
            <span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">42.7</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">57</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">58.200</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_lefthand_subtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>LH Subtraction of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">42.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="o">-</span><span class="mf">27.200</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_lefthand_multiplication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Multiplication of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">15</span><span class="p">,</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">42.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">630</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">661.850</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_lefthand_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>LH Division of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">42.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">0.363</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_lefthand_modulo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>LH Modulo arithmetic on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_lefthand_bitwise_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>LH Bitwise ands on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">56</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="nd">@skipUnlessDBFeature</span><span class="p">(</span><span class="s">&#39;supports_bitwise_or&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_lefthand_bitwise_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>LH Bitwise or on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="mi">48</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">58</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_addition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Right hand operators</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">15</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">),</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="mf">42.7</span> <span class="o">+</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>RH Addition of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">57</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">58.200</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_subtraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">15</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">),</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="mf">42.7</span> <span class="o">-</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>RH Subtraction of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="o">-</span><span class="mi">27</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">27.200</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_multiplication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>RH Multiplication of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">15</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">),</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="mf">42.7</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">630</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">661.850</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>RH Division of floats and integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">640</span> <span class="o">/</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">),</span>
                                              <span class="nb">float</span><span class="o">=</span><span class="mf">42.7</span> <span class="o">/</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">2.755</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_modulo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>RH Modulo arithmetic on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">69</span> <span class="o">%</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_right_hand_bitwise_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>RH Bitwise ands on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">15</span> <span class="o">&amp;</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="nd">@skipUnlessDBFeature</span><span class="p">(</span><span class="s">&#39;supports_bitwise_or&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_right_hand_bitwise_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>RH Bitwise or on integers</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="mi">15</span> <span class="o">|</span> <span class="n">F</span><span class="p">(</span><span class="s">&#39;integer&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="mi">47</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Number</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">,</span> <span class="n">Approximate</span><span class="p">(</span><span class="mf">15.500</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">FTimeDeltaTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sday</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">stime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">747000</span><span class="p">)</span>
        <span class="n">midnight</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">delta0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">delta1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="mi">253000</span><span class="p">)</span>
        <span class="n">delta2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">44</span><span class="p">)</span>
        <span class="n">delta3</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">delta4</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Test data is set so that deltas and delays will be
strictly increasing.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span> <span class="o">=</span> <span class="p">[]</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>e0: started same day as assigned, zero duration</p></td><td class="code"><div class="highlight"><pre>        <span class="n">end</span> <span class="o">=</span> <span class="n">stime</span><span class="o">+</span><span class="n">delta0</span>
        <span class="n">e0</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;e0&#39;</span><span class="p">,</span> <span class="n">assigned</span><span class="o">=</span><span class="n">sday</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">stime</span><span class="p">,</span>
            <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e0</span><span class="o">.</span><span class="n">start</span><span class="o">-</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">e0</span><span class="o">.</span><span class="n">assigned</span><span class="p">,</span> <span class="n">midnight</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e0</span><span class="o">.</span><span class="n">completed</span><span class="o">-</span><span class="n">e0</span><span class="o">.</span><span class="n">assigned</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>e1: started one day after assigned, tiny duration, data
set so that end time has no fractional seconds, which
tests an edge case on sqlite. This Experiment is only
included in the test data when the DB supports microsecond
precision.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">supports_microsecond_precision</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">stime</span> <span class="o">+</span> <span class="n">delay</span> <span class="o">+</span> <span class="n">delta1</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;e1&#39;</span><span class="p">,</span> <span class="n">assigned</span><span class="o">=</span><span class="n">sday</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="n">stime</span><span class="o">+</span><span class="n">delay</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">start</span><span class="o">-</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">assigned</span><span class="p">,</span> <span class="n">midnight</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">completed</span><span class="o">-</span><span class="n">e1</span><span class="o">.</span><span class="n">assigned</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>e2: started three days after assigned, small duration</p></td><td class="code"><div class="highlight"><pre>        <span class="n">end</span> <span class="o">=</span> <span class="n">stime</span><span class="o">+</span><span class="n">delta2</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;e2&#39;</span><span class="p">,</span>
            <span class="n">assigned</span><span class="o">=</span><span class="n">sday</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">stime</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
            <span class="n">completed</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">start</span><span class="o">-</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">assigned</span><span class="p">,</span> <span class="n">midnight</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">completed</span><span class="o">-</span><span class="n">e2</span><span class="o">.</span><span class="n">assigned</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>e3: started four days after assigned, medium duration</p></td><td class="code"><div class="highlight"><pre>        <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">stime</span> <span class="o">+</span> <span class="n">delay</span> <span class="o">+</span> <span class="n">delta3</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;e3&#39;</span><span class="p">,</span>
            <span class="n">assigned</span><span class="o">=</span><span class="n">sday</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">stime</span><span class="o">+</span><span class="n">delay</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">completed</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e3</span><span class="o">.</span><span class="n">start</span><span class="o">-</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">e3</span><span class="o">.</span><span class="n">assigned</span><span class="p">,</span> <span class="n">midnight</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e3</span><span class="o">.</span><span class="n">completed</span><span class="o">-</span><span class="n">e3</span><span class="o">.</span><span class="n">assigned</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>e4: started 10 days after assignment, long duration</p></td><td class="code"><div class="highlight"><pre>        <span class="n">end</span> <span class="o">=</span> <span class="n">stime</span> <span class="o">+</span> <span class="n">delta4</span>
        <span class="n">e4</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;e4&#39;</span><span class="p">,</span>
            <span class="n">assigned</span><span class="o">=</span><span class="n">sday</span><span class="o">-</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="n">stime</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
            <span class="n">completed</span><span class="o">=</span><span class="n">end</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e4</span><span class="o">.</span><span class="n">start</span><span class="o">-</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">e4</span><span class="o">.</span><span class="n">assigned</span><span class="p">,</span> <span class="n">midnight</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e4</span><span class="o">.</span><span class="n">completed</span><span class="o">-</span><span class="n">e4</span><span class="o">.</span><span class="n">assigned</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">test_delta_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_delta_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start__gte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_exclude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">end__lte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">test_date_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="p">)):</span>
            <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">days_long</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">completed__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;assigned&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">days</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">completed__lte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;assigned&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">days</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@skipUnlessDBFeature</span><span class="p">(</span><span class="s">&quot;supports_mixed_date_datetime_comparisons&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_mixed_comparisons1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">)):</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">supports_microsecond_precision</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">delay</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="n">delay</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">assigned__gt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">delay</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">assigned__gte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">delay</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_mixed_comparisons2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">delay</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="k">for</span> <span class="n">delay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">delays</span><span class="p">)):</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">delays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;assigned&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">test_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span>
                <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start__lte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;assigned&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delay</span><span class="o">+</span>
                    <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expnames</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_delta_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">)):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">exps</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="n">expected_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>
            <span class="n">expected_starts</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">start</span><span class="o">+</span><span class="n">delta</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>
            <span class="n">expected_ends</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">end</span><span class="o">+</span><span class="n">delta</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>

            <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span>
            <span class="n">exps</span> <span class="o">=</span> <span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="n">new_starts</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>
            <span class="n">new_ends</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">end</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>
            <span class="n">new_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exps</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_starts</span><span class="p">,</span> <span class="n">new_starts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_ends</span><span class="p">,</span> <span class="n">new_ends</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_durations</span><span class="p">,</span> <span class="n">new_durations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_delta_invalid_op_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">raised</span><span class="p">,</span> <span class="s">&quot;TypeError not raised on attempt to multiply datetime by timedelta.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_delta_invalid_op_div</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">raised</span><span class="p">,</span> <span class="s">&quot;TypeError not raised on attempt to divide datetime by timedelta.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_delta_invalid_op_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">raised</span><span class="p">,</span> <span class="s">&quot;TypeError not raised on attempt to modulo divide datetime by timedelta.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_delta_invalid_op_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">&amp;</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">raised</span><span class="p">,</span> <span class="s">&quot;TypeError not raised on attempt to binary and a datetime with a timedelta.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_delta_invalid_op_or</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raised</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">Experiment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">end__lt</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">)</span><span class="o">|</span><span class="bp">self</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">raised</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">raised</span><span class="p">,</span> <span class="s">&quot;TypeError not raised on attempt to binary or a datetime with a timedelta.&quot;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
