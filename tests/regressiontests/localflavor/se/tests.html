<!DOCTYPE html>
<html><head><title>joekychen/django » tests › regressiontests › localflavor › se › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>-<em>- coding: utf-8 -</em>-</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">django.contrib.localflavor.se.forms</span> <span class="kn">import</span> <span class="p">(</span><span class="n">SECountySelect</span><span class="p">,</span>
    <span class="n">SEOrganisationNumberField</span><span class="p">,</span> <span class="n">SEPersonalIdentityNumberField</span><span class="p">,</span>
    <span class="n">SEPostalCodeField</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>


<span class="k">class</span> <span class="nc">SELocalFlavorTests</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Mocking datetime.date to make sure
localflavor.se.utils.validate<em>id</em>birthday works</p></td><td class="code"><div class="highlight"><pre>        <span class="k">class</span> <span class="nc">MockDate</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">today</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
            <span class="n">today</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_olddate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">MockDate</span>

    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_olddate</span>

    <span class="k">def</span> <span class="nf">test_SECountySelect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">SECountySelect</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;&lt;select name=&quot;swedish_county&quot;&gt;</span>
<span class="s">&lt;option value=&quot;AB&quot;&gt;Stockholm&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;AC&quot;&gt;V</span><span class="se">\xe4</span><span class="s">sterbotten&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;BD&quot;&gt;Norrbotten&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;C&quot;&gt;Uppsala&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;D&quot;&gt;S</span><span class="se">\xf6</span><span class="s">dermanland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;E&quot; selected=&quot;selected&quot;&gt;</span><span class="se">\xd6</span><span class="s">sterg</span><span class="se">\xf6</span><span class="s">tland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;F&quot;&gt;J</span><span class="se">\xf6</span><span class="s">nk</span><span class="se">\xf6</span><span class="s">ping&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;G&quot;&gt;Kronoberg&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;H&quot;&gt;Kalmar&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;I&quot;&gt;Gotland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;K&quot;&gt;Blekinge&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;M&quot;&gt;Sk</span><span class="se">\xe5</span><span class="s">ne&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;N&quot;&gt;Halland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;O&quot;&gt;V</span><span class="se">\xe4</span><span class="s">stra G</span><span class="se">\xf6</span><span class="s">taland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;S&quot;&gt;V</span><span class="se">\xe4</span><span class="s">rmland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;T&quot;&gt;</span><span class="se">\xd6</span><span class="s">rebro&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;U&quot;&gt;V</span><span class="se">\xe4</span><span class="s">stmanland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;W&quot;&gt;Dalarna&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;X&quot;&gt;G</span><span class="se">\xe4</span><span class="s">vleborg&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;Y&quot;&gt;V</span><span class="se">\xe4</span><span class="s">sternorrland&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;Z&quot;&gt;J</span><span class="se">\xe4</span><span class="s">mtland&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s">&#39;swedish_county&#39;</span><span class="p">,</span> <span class="s">&#39;E&#39;</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_SEOrganizationNumberField</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">error_invalid</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Enter a valid Swedish organisation number.&#39;</span><span class="p">]</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;870512-1989&#39;</span><span class="p">:</span> <span class="s">&#39;198705121989&#39;</span><span class="p">,</span>
            <span class="s">&#39;19870512-1989&#39;</span><span class="p">:</span> <span class="s">&#39;198705121989&#39;</span><span class="p">,</span>
            <span class="s">&#39;870512-2128&#39;</span><span class="p">:</span> <span class="s">&#39;198705122128&#39;</span><span class="p">,</span>
            <span class="s">&#39;081015-6315&#39;</span><span class="p">:</span> <span class="s">&#39;190810156315&#39;</span><span class="p">,</span>
            <span class="s">&#39;081015+6315&#39;</span><span class="p">:</span> <span class="s">&#39;180810156315&#39;</span><span class="p">,</span>
            <span class="s">&#39;0810156315&#39;</span><span class="p">:</span> <span class="s">&#39;190810156315&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Test some different organisation numbers
IKEA Linköping</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;556074-7569&#39;</span><span class="p">:</span> <span class="s">&#39;5560747569&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Volvo Personvagnar</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;556074-3089&#39;</span><span class="p">:</span> <span class="s">&#39;5560743089&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>LJS (organisation)</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;822001-5476&#39;</span><span class="p">:</span> <span class="s">&#39;8220015476&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>LJS (organisation)</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;8220015476&#39;</span><span class="p">:</span> <span class="s">&#39;8220015476&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Katedralskolan Linköping (school)</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;2120000449&#39;</span><span class="p">:</span> <span class="s">&#39;2120000449&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Faux organisation number, which tests that the checksum can be 0</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;232518-5060&#39;</span><span class="p">:</span> <span class="s">&#39;2325185060&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Ordinary personal identity numbers for sole proprietors
The same rules as for SEPersonalIdentityField applies here</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;081015 6315&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;950231-4496&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;6914104499&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;950d314496&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;invalid!!!&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;870514-1111&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Co-ordination number checking
Co-ordination numbers are not valid organisation numbers</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870574-1315&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;870573-1311&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Volvo Personvagnar, bad format</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;556074+3089&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Invalid checksum</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;2120000441&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Valid checksum but invalid organisation type</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;1120000441&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFieldOutput</span><span class="p">(</span><span class="n">SEOrganisationNumberField</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_SEPersonalIdentityNumberField</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">error_invalid</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Enter a valid Swedish personal identity number.&#39;</span><span class="p">]</span>
        <span class="n">error_coord</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Co-ordination numbers are not allowed.&#39;</span><span class="p">]</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;870512-1989&#39;</span><span class="p">:</span> <span class="s">&#39;198705121989&#39;</span><span class="p">,</span>
            <span class="s">&#39;870512-2128&#39;</span><span class="p">:</span> <span class="s">&#39;198705122128&#39;</span><span class="p">,</span>
            <span class="s">&#39;19870512-1989&#39;</span><span class="p">:</span> <span class="s">&#39;198705121989&#39;</span><span class="p">,</span>
            <span class="s">&#39;198705121989&#39;</span><span class="p">:</span> <span class="s">&#39;198705121989&#39;</span><span class="p">,</span>
            <span class="s">&#39;081015-6315&#39;</span><span class="p">:</span> <span class="s">&#39;190810156315&#39;</span><span class="p">,</span>
            <span class="s">&#39;0810156315&#39;</span><span class="p">:</span> <span class="s">&#39;190810156315&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>This is a "special-case" in the checksum calculation,
where the sum is divisible by 10 (the checksum digit == 0)</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;8705141060&#39;</span><span class="p">:</span> <span class="s">&#39;198705141060&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><ul>
<li>means that the person is older than 100 years</li>
</ul></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;081015+6315&#39;</span><span class="p">:</span> <span class="s">&#39;180810156315&#39;</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Co-ordination number checking</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870574-1315&#39;</span><span class="p">:</span> <span class="s">&#39;198705741315&#39;</span><span class="p">,</span>
            <span class="s">&#39;870574+1315&#39;</span><span class="p">:</span> <span class="s">&#39;188705741315&#39;</span><span class="p">,</span>
            <span class="s">&#39;198705741315&#39;</span><span class="p">:</span> <span class="s">&#39;198705741315&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;081015 6315&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;950d314496&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
            <span class="s">&#39;invalid!!!&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Invalid dates
February 31st does not exist</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;950231-4496&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Month 14 does not exist</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;6914104499&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>There are no Swedish personal id numbers where year &lt; 1800</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;17430309-7135&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Invalid checksum</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870514-1111&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>Co-ordination number with bad checksum</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870573-1311&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFieldOutput</span><span class="p">(</span><span class="n">SEPersonalIdentityNumberField</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Check valid co-ordination numbers that should not be accepted
because of coordination_number=False</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870574-1315&#39;</span><span class="p">:</span> <span class="n">error_coord</span><span class="p">,</span>
            <span class="s">&#39;870574+1315&#39;</span><span class="p">:</span> <span class="n">error_coord</span><span class="p">,</span>
            <span class="s">&#39;8705741315&#39;</span><span class="p">:</span> <span class="n">error_coord</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Invalid co-ordination numbers should be treated as invalid, and not
as co-ordination numbers</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;870573-1311&#39;</span><span class="p">:</span> <span class="n">error_invalid</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;coordination_number&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFieldOutput</span><span class="p">(</span><span class="n">SEPersonalIdentityNumberField</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">invalid</span><span class="p">,</span>
            <span class="n">field_kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_SEPostalCodeField</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">error_format</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Enter a Swedish postal code in the format XXXXX.&#39;</span><span class="p">]</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;589 37&#39;</span><span class="p">:</span> <span class="s">&#39;58937&#39;</span><span class="p">,</span>
            <span class="s">&#39;58937&#39;</span><span class="p">:</span> <span class="s">&#39;58937&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;abcasfassadf&#39;</span><span class="p">:</span> <span class="n">error_format</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Only one space is allowed for separation</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;589  37&#39;</span><span class="p">:</span> <span class="n">error_format</span><span class="p">,</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>The postal code must not start with 0</p></td><td class="code"><div class="highlight"><pre>            <span class="s">&#39;01234&#39;</span><span class="p">:</span> <span class="n">error_format</span><span class="p">,</span>

        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFieldOutput</span><span class="p">(</span><span class="n">SEPostalCodeField</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
