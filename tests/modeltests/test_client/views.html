<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › test_client › views.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>views.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">xml.dom.minidom</span> <span class="kn">import</span> <span class="n">parseString</span>

<span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">permission_required</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">django.forms.forms</span> <span class="kn">import</span> <span class="n">Form</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponseNotFound</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render_to_response</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">django.utils.decorators</span> <span class="kn">import</span> <span class="n">method_decorator</span>


<span class="k">def</span> <span class="nf">get_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A simple view that expects a GET request, and returns a rendered template&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a test. {{ var }} is the value.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;GET Template&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;var&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;var&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)})</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A view that expects a POST, and returns a different template depending</span>
<span class="sd">    on whether any POST data is available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Data received: {{ data }} is the value.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;POST Template&#39;</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Viewing POST page.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Empty POST Template&#39;</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Viewing GET page.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Empty GET Template&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">view_with_header</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that has a custom header&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
    <span class="n">response</span><span class="p">[</span><span class="s">&#39;X-DJANGO-TEST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Slartibartfast&#39;</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">raw_post_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A view which expects raw XML to be posted and returns content extracted</span>
<span class="sd">    from the XML&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">parseString</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
        <span class="n">first_book</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">firstChild</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">author</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">first_book</span><span class="o">.</span><span class="n">childNodes</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;{{ title }} - {{ author }}&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Book template&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">:</span> <span class="n">author</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;GET request.&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Book GET template&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">redirect_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that redirects all requests to the GET view&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/test_client/get_view/&#39;</span> <span class="o">+</span> <span class="n">query</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">view_with_secure</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that indicates if the request was secure&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
    <span class="n">response</span><span class="o">.</span><span class="n">test_was_secure_request</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">is_secure</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">double_redirect_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that redirects all requests to a redirection view&quot;</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s">&#39;/test_client/permanent_redirect_view/&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bad_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that returns a 404 with some error content&quot;</span>
    <span class="k">return</span> <span class="n">HttpResponseNotFound</span><span class="p">(</span><span class="s">&#39;Not found!. This page contains some MAGIC content&#39;</span><span class="p">)</span>

<span class="n">TestChoices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;First Choice&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;Second Choice&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;Third Choice&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;Fourth Choice&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="s">&#39;Fifth Choice&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">TestForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">single</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">TestChoices</span><span class="p">)</span>
    <span class="n">multi</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">MultipleChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">TestChoices</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">form_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that tests a simple form&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TestForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Valid POST data.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Valid POST Template&#39;</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Invalid POST data. {{ form.errors }}&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Invalid POST Template&#39;</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TestForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Viewing base form. {{ form }}.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Form GET Template&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">form_view_with_template</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that tests a simple form&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TestForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;POST data OK&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;POST data has errors&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TestForm</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">&#39;GET form page&#39;</span>
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;form_view.html&#39;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">login_protected_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A simple view that is login protected.&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a login protected test. Username is {{ user.username }}.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Login Template&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">login_protected_view</span> <span class="o">=</span> <span class="n">login_required</span><span class="p">(</span><span class="n">login_protected_view</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">login_protected_view_changed_redirect</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A simple view that is login protected with a custom redirect field set&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a login protected test. Username is {{ user.username }}.&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Login Template&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">login_protected_view_changed_redirect</span> <span class="o">=</span> <span class="n">login_required</span><span class="p">(</span><span class="n">redirect_field_name</span><span class="o">=</span><span class="s">&quot;redirect_to&quot;</span><span class="p">)(</span><span class="n">login_protected_view_changed_redirect</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_permission_protected_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A simple view that is permission protected.&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a permission protected test. &#39;</span>
                 <span class="s">&#39;Username is {{ user.username }}. &#39;</span>
                 <span class="s">&#39;Permissions are {{ user.get_all_permissions }}.&#39;</span> <span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="s">&#39;Permissions Template&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">permission_protected_view</span> <span class="o">=</span> <span class="n">permission_required</span><span class="p">(</span><span class="s">&#39;modeltests.test_perm&#39;</span><span class="p">)(</span><span class="n">_permission_protected_view</span><span class="p">)</span>
<span class="n">permission_protected_view_exception</span> <span class="o">=</span> <span class="n">permission_required</span><span class="p">(</span><span class="s">&#39;modeltests.test_perm&#39;</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="bp">True</span><span class="p">)(</span><span class="n">_permission_protected_view</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">_ViewManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@method_decorator</span><span class="p">(</span><span class="n">login_required</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">login_protected_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a login protected test using a method. &#39;</span>
                     <span class="s">&#39;Username is {{ user.username }}.&#39;</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="s">&#39;Login Method Template&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="nd">@method_decorator</span><span class="p">(</span><span class="n">permission_required</span><span class="p">(</span><span class="s">&#39;modeltests.test_perm&#39;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">permission_protected_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a permission protected test using a method. &#39;</span>
                     <span class="s">&#39;Username is {{ user.username }}. &#39;</span>
                     <span class="s">&#39;Permissions are {{ user.get_all_permissions }}.&#39;</span> <span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="s">&#39;Permissions Template&#39;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="n">_view_manager</span> <span class="o">=</span> <span class="n">_ViewManager</span><span class="p">()</span>
<span class="n">login_protected_method_view</span> <span class="o">=</span> <span class="n">_view_manager</span><span class="o">.</span><span class="n">login_protected_view</span>
<span class="n">permission_protected_method_view</span> <span class="o">=</span> <span class="n">_view_manager</span><span class="o">.</span><span class="n">permission_protected_view</span>

<span class="k">def</span> <span class="nf">session_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="s">&quot;A view that modifies the session&quot;</span>
    <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;tobacconist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;hovercraft&#39;</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;This is a view that modifies the session.&#39;</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="s">&#39;Session Modifying View Template&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">broken_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A view which just raises an exception, simulating a broken view.&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Oops! Looks like you wrote some bad code.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mail_sending_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">mail</span><span class="o">.</span><span class="n">EmailMessage</span><span class="p">(</span>
        <span class="s">&quot;Test message&quot;</span><span class="p">,</span>
        <span class="s">&quot;This is a test email&quot;</span><span class="p">,</span>
        <span class="s">&quot;from@example.com&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s">&#39;first@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;second@example.com&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Mail sent&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mass_mail_sending_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">EmailMessage</span><span class="p">(</span>
        <span class="s">&#39;First Test message&#39;</span><span class="p">,</span>
        <span class="s">&#39;This is the first test email&#39;</span><span class="p">,</span>
        <span class="s">&#39;from@example.com&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s">&#39;first@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;second@example.com&#39;</span><span class="p">])</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">EmailMessage</span><span class="p">(</span>
        <span class="s">&#39;Second Test message&#39;</span><span class="p">,</span>
        <span class="s">&#39;This is the second test email&#39;</span><span class="p">,</span>
        <span class="s">&#39;from@example.com&#39;</span><span class="p">,</span>
        <span class="p">[</span><span class="s">&#39;second@example.com&#39;</span><span class="p">,</span> <span class="s">&#39;third@example.com&#39;</span><span class="p">])</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span>
    <span class="n">c</span><span class="o">.</span><span class="n">send_messages</span><span class="p">([</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Mail sent&quot;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
