<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › fixtures › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">management</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span><span class="p">,</span> <span class="n">IntegrityError</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">TransactionTestCase</span><span class="p">,</span> <span class="n">skipUnlessDBFeature</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Article</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Spy</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">Visa</span>


<span class="k">class</span> <span class="nc">TestCaseFixtureLoadingTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fixture1.json&#39;</span><span class="p">,</span> <span class="s">&#39;fixture2.json&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">testClassFixtures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Check that test case has installed 3 fixture objects&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Django conquers world!&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Copyright is fine the way it is&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

<span class="k">class</span> <span class="nc">FixtureLoadingTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_dumpdata_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="n">use_base_manager</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">exclude_list</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">new_io</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;dumpdata&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s">&#39;format&#39;</span><span class="p">:</span><span class="n">format</span><span class="p">,</span>
                                                      <span class="s">&#39;stdout&#39;</span><span class="p">:</span><span class="n">new_io</span><span class="p">,</span>
                                                      <span class="s">&#39;stderr&#39;</span><span class="p">:</span><span class="n">new_io</span><span class="p">,</span>
                                                      <span class="s">&#39;use_natural_keys&#39;</span><span class="p">:</span><span class="n">natural_keys</span><span class="p">,</span>
                                                      <span class="s">&#39;use_base_manager&#39;</span><span class="p">:</span><span class="n">use_base_manager</span><span class="p">,</span>
                                                      <span class="s">&#39;exclude&#39;</span><span class="p">:</span> <span class="n">exclude_list</span><span class="p">})</span>
        <span class="n">command_output</span> <span class="o">=</span> <span class="n">new_io</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">command_output</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_initial_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>syncdb introduces 1 initial data object from initial_data.json.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Book: Achieving self-awareness of Python programs&gt;&#39;</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_loading_and_dumping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_io</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

        <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Load fixture 1. Single JSON file, with two objects.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture1.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Time to reform copyright&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Dump the current contents of the database as a JSON fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Try just dumping the contents of fixtures.Category</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Category&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>...and just fixtures.Article</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>...and both</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Category&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures.Article&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Specify a specific model twice</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures.Article&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Specify a dump that specifies Article both explicitly and implicitly</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Same again, but specify in the reverse order</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Specify one model from one application, and an entire other application.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Category&#39;</span><span class="p">,</span> <span class="s">&#39;sites&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;sites.site&quot;, &quot;fields&quot;: {&quot;domain&quot;: &quot;example.com&quot;, &quot;name&quot;: &quot;example.com&quot;}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Load fixture 2. JSON file imported by default. Overwrites some existing objects</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture2.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Django conquers world!&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Copyright is fine the way it is&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Load fixture 3, XML format.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture3.xml&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: XML identified as leading cause of cancer&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Django conquers world!&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Copyright is fine the way it is&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker on TV is great!&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Load fixture 6, JSON file with dynamic ContentType fields. Testing ManyToOne.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture6.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Copyright is fine the way it is&gt; tagged &quot;copyright&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Copyright is fine the way it is&gt; tagged &quot;law&quot;&gt;&#39;</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Load fixture 7, XML file with dynamic ContentType fields. Testing ManyToOne.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture7.xml&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Copyright is fine the way it is&gt; tagged &quot;copyright&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Copyright is fine the way it is&gt; tagged &quot;legal&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Django conquers world!&gt; tagged &quot;django&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Django conquers world!&gt; tagged &quot;world domination&quot;&gt;&#39;</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Load fixture 8, JSON file with dynamic Permission fields. Testing ManyToMany.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture8.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Visa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Visa: Django Reinhardt Can add user, Can change user, Can delete user&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Visa: Stephane Grappelli Can add user&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Visa: Prince &gt;&#39;</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Load fixture 9, XML file with dynamic Permission fields. Testing ManyToMany.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture9.xml&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Visa</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Visa: Django Reinhardt Can add user, Can change user, Can delete user&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Visa: Stephane Grappelli Can add user, Can delete user&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Visa: Artist formerly known as &quot;Prince&quot; Can change user&gt;&#39;</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Book: Achieving self-awareness of Python programs&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Book: Music for all ages by Artist formerly known as &quot;Prince&quot; and Django Reinhardt&gt;&#39;</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Load a fixture that doesn't exist</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;unknown.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>object list is unaffected</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: XML identified as leading cause of cancer&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Django conquers world!&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Copyright is fine the way it is&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker on TV is great!&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>By default, you get raw keys on dumpdata</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.book&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Music for all ages&quot;, &quot;authors&quot;: [3, 1]}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>But you can get natural keys if you ask for them and they are available</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.book&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Music for all ages&quot;, &quot;authors&quot;: [[&quot;Artist formerly known as </span><span class="se">\\</span><span class="s">&quot;Prince</span><span class="se">\\</span><span class="s">&quot;&quot;], [&quot;Django Reinhardt&quot;]]}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Dump the current contents of the database as a JSON fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker on TV is great!&quot;, &quot;pub_date&quot;: &quot;2006-06-16T11:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Copyright is fine the way it is&quot;, &quot;pub_date&quot;: &quot;2006-06-16T14:00:00&quot;}}, {&quot;pk&quot;: 4, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Django conquers world!&quot;, &quot;pub_date&quot;: &quot;2006-06-16T15:00:00&quot;}}, {&quot;pk&quot;: 5, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;XML identified as leading cause of cancer&quot;, &quot;pub_date&quot;: &quot;2006-06-16T16:00:00&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;copyright&quot;, &quot;tagged_id&quot;: 3}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;legal&quot;, &quot;tagged_id&quot;: 3}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;django&quot;, &quot;tagged_id&quot;: 4}}, {&quot;pk&quot;: 4, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;world domination&quot;, &quot;tagged_id&quot;: 4}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Django Reinhardt&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Stephane Grappelli&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Artist formerly known as </span><span class="se">\\</span><span class="s">&quot;Prince</span><span class="se">\\</span><span class="s">&quot;&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.visa&quot;, &quot;fields&quot;: {&quot;person&quot;: [&quot;Django Reinhardt&quot;], &quot;permissions&quot;: [[&quot;add_user&quot;, &quot;auth&quot;, &quot;user&quot;], [&quot;change_user&quot;, &quot;auth&quot;, &quot;user&quot;], [&quot;delete_user&quot;, &quot;auth&quot;, &quot;user&quot;]]}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.visa&quot;, &quot;fields&quot;: {&quot;person&quot;: [&quot;Stephane Grappelli&quot;], &quot;permissions&quot;: [[&quot;add_user&quot;, &quot;auth&quot;, &quot;user&quot;], [&quot;delete_user&quot;, &quot;auth&quot;, &quot;user&quot;]]}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.visa&quot;, &quot;fields&quot;: {&quot;person&quot;: [&quot;Artist formerly known as </span><span class="se">\\</span><span class="s">&quot;Prince</span><span class="se">\\</span><span class="s">&quot;&quot;], &quot;permissions&quot;: [[&quot;change_user&quot;, &quot;auth&quot;, &quot;user&quot;]]}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Music for all ages&quot;, &quot;authors&quot;: [[&quot;Artist formerly known as </span><span class="se">\\</span><span class="s">&quot;Prince</span><span class="se">\\</span><span class="s">&quot;&quot;], [&quot;Django Reinhardt&quot;]]}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Dump the current contents of the database as an XML fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="s">&lt;django-objects version=&quot;1.0&quot;&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.category&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;title&quot;&gt;News Stories&lt;/field&gt;&lt;field type=&quot;TextField&quot; name=&quot;description&quot;&gt;Latest news stories&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;Poker on TV is great!&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T11:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;Copyright is fine the way it is&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T14:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;4&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;Django conquers world!&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T15:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;5&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;XML identified as leading cause of cancer&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T16:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;copyright&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;3&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;legal&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;3&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;django&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;4&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;4&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;world domination&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;4&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Django Reinhardt&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Stephane Grappelli&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Artist formerly known as &quot;Prince&quot;&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.visa&quot;&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;person&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;Django Reinhardt&lt;/natural&gt;&lt;/field&gt;&lt;field to=&quot;auth.permission&quot; name=&quot;permissions&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;object&gt;&lt;natural&gt;add_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;object&gt;&lt;natural&gt;change_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;object&gt;&lt;natural&gt;delete_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.visa&quot;&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;person&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;Stephane Grappelli&lt;/natural&gt;&lt;/field&gt;&lt;field to=&quot;auth.permission&quot; name=&quot;permissions&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;object&gt;&lt;natural&gt;add_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;object&gt;&lt;natural&gt;delete_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.visa&quot;&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;person&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;Artist formerly known as &quot;Prince&quot;&lt;/natural&gt;&lt;/field&gt;&lt;field to=&quot;auth.permission&quot; name=&quot;permissions&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;object&gt;&lt;natural&gt;change_user&lt;/natural&gt;&lt;natural&gt;auth&lt;/natural&gt;&lt;natural&gt;user&lt;/natural&gt;&lt;/object&gt;&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.book&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Music for all ages&lt;/field&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;authors&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;object&gt;&lt;natural&gt;Artist formerly known as &quot;Prince&quot;&lt;/natural&gt;&lt;/object&gt;&lt;object&gt;&lt;natural&gt;Django Reinhardt&lt;/natural&gt;&lt;/object&gt;&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;10&quot; model=&quot;fixtures.book&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Achieving self-awareness of Python programs&lt;/field&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;authors&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;/field&gt;&lt;/object&gt;&lt;/django-objects&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;xml&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_dumpdata_with_excludes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Load fixture1 which has a site, two articles, and a category</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture1.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Excluding fixtures app should only leave sites</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;sites&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures&#39;</span><span class="p">],</span>
            <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;sites.site&quot;, &quot;fields&quot;: {&quot;domain&quot;: &quot;example.com&quot;, &quot;name&quot;: &quot;example.com&quot;}}]&#39;</span><span class="p">,</span>
            <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fixtures&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Excluding fixtures.Article/Book should leave fixtures.Category</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;sites&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures&#39;</span><span class="p">],</span>
            <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;sites.site&quot;, &quot;fields&quot;: {&quot;domain&quot;: &quot;example.com&quot;, &quot;name&quot;: &quot;example.com&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}]&#39;</span><span class="p">,</span>
            <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures.Book&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Excluding fixtures and fixtures.Article/Book should be a no-op</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;sites&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures&#39;</span><span class="p">],</span>
            <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;sites.site&quot;, &quot;fields&quot;: {&quot;domain&quot;: &quot;example.com&quot;, &quot;name&quot;: &quot;example.com&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}]&#39;</span><span class="p">,</span>
            <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures.Book&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Excluding sites and fixtures.Article/Book should only leave fixtures.Category</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">(</span>
            <span class="p">[</span><span class="s">&#39;sites&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures&#39;</span><span class="p">],</span>
            <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}]&#39;</span><span class="p">,</span>
            <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fixtures.Article&#39;</span><span class="p">,</span> <span class="s">&#39;fixtures.Book&#39;</span><span class="p">,</span> <span class="s">&#39;sites&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>Excluding a bogus app should throw an error</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">management</span><span class="o">.</span><span class="n">CommandError</span><span class="p">,</span>
                <span class="s">&quot;Unknown app in excludes: foo_app&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">,</span> <span class="s">&#39;sites&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;foo_app&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>Excluding a bogus model should throw an error</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">management</span><span class="o">.</span><span class="n">CommandError</span><span class="p">,</span>
                <span class="s">&quot;Unknown model in excludes: fixtures.FooModel&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">,</span> <span class="s">&#39;sites&#39;</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">exclude_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fixtures.FooModel&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_dumpdata_with_filtering_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spy1</span> <span class="o">=</span> <span class="n">Spy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul&#39;</span><span class="p">)</span>
        <span class="n">spy2</span> <span class="o">=</span> <span class="n">Spy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Alex&#39;</span><span class="p">,</span> <span class="n">cover_blown</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Spy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
                                 <span class="p">[</span><span class="s">&#39;&lt;Spy: Paul&gt;&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>Use the default manager</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Spy&#39;</span><span class="p">],</span><span class="s">&#39;[{&quot;pk&quot;: </span><span class="si">%d</span><span class="s">, &quot;model&quot;: &quot;fixtures.spy&quot;, &quot;fields&quot;: {&quot;cover_blown&quot;: false}}]&#39;</span> <span class="o">%</span> <span class="n">spy1</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Dump using Django's base manager. Should return all objects,
even those normally filtered by the manager</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures.Spy&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: </span><span class="si">%d</span><span class="s">, &quot;model&quot;: &quot;fixtures.spy&quot;, &quot;fields&quot;: {&quot;cover_blown&quot;: true}}, {&quot;pk&quot;: </span><span class="si">%d</span><span class="s">, &quot;model&quot;: &quot;fixtures.spy&quot;, &quot;fields&quot;: {&quot;cover_blown&quot;: false}}]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spy2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">spy1</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="n">use_base_manager</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_compress_format_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Load fixture 4 (compressed), using format specification</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture4.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Django pets kitten&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_compressed_specified_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>Load fixture 5 (compressed), using format <em>and</em> compression specification</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture5.json.zip&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: WoW subscribers now outnumber readers&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_compressed_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>Load fixture 5 (compressed), only compression specification</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture5.zip&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: WoW subscribers now outnumber readers&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_ambiguous_compressed_fixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>The name "fixture5" is ambigous, so loading it will raise an error</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">management</span><span class="o">.</span><span class="n">CommandError</span><span class="p">,</span>
                <span class="s">&quot;Multiple fixtures named &#39;fixture5&#39;&quot;</span><span class="p">):</span>
            <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture5&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_db_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Load db fixtures 1 and 2. These will load using the 'default' database identifier implicitly</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_1&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_2&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Who needs more than one database?&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Who needs to use compressed data?&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_loaddata_error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies that loading a fixture which contains an invalid object</span>
<span class="sd">        outputs an error message which contains the pk of the object</span>
<span class="sd">        that triggered the error.</span>
<span class="sd">        &quot;&quot;&quot;</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>MySQL needs a little prodding to reject invalid data.
This won't affect other tests because the database connection
is closed at the end of each test.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">vendor</span> <span class="o">==</span> <span class="s">&#39;mysql&#39;</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SET sql_mode = &#39;TRADITIONAL&#39;&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">IntegrityError</span><span class="p">,</span>
                <span class="s">&quot;Could not load fixtures.Article\(pk=1\): .*$&quot;</span><span class="p">):</span>
            <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;invalid.json&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_loading_using</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Load db fixtures 1 and 2. These will load using the 'default' database identifier explicitly</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_1&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_2&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Who needs more than one database?&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Who needs to use compressed data?&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_unmatched_identifier_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Try to load db fixture 3. This won't load because the database identifier doesn't match</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_3&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[])</span>

        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;db_fixture_3&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">test_output_formats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>Load back in fixture 1, we need the articles from it</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture1&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>Try to load fixture 6 using format discovery</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture6&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Time to reform copyright&gt; tagged &quot;copyright&quot;&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Tag: &lt;Article: Time to reform copyright&gt; tagged &quot;law&quot;&gt;&#39;</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>Dump the current contents of the database as a JSON fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;copyright&quot;, &quot;tagged_id&quot;: 3}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.tag&quot;, &quot;fields&quot;: {&quot;tagged_type&quot;: [&quot;fixtures&quot;, &quot;article&quot;], &quot;name&quot;: &quot;law&quot;, &quot;tagged_id&quot;: 3}}, {&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Django Reinhardt&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Stephane Grappelli&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.person&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Prince&quot;}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>Dump the current contents of the database as an XML fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="s">&lt;django-objects version=&quot;1.0&quot;&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.category&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;title&quot;&gt;News Stories&lt;/field&gt;&lt;field type=&quot;TextField&quot; name=&quot;description&quot;&gt;Latest news stories&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;Poker has no place on ESPN&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T12:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.article&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;headline&quot;&gt;Time to reform copyright&lt;/field&gt;&lt;field type=&quot;DateTimeField&quot; name=&quot;pub_date&quot;&gt;2006-06-16T13:00:00&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;copyright&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;3&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.tag&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;law&lt;/field&gt;&lt;field to=&quot;contenttypes.contenttype&quot; name=&quot;tagged_type&quot; rel=&quot;ManyToOneRel&quot;&gt;&lt;natural&gt;fixtures&lt;/natural&gt;&lt;natural&gt;article&lt;/natural&gt;&lt;/field&gt;&lt;field type=&quot;PositiveIntegerField&quot; name=&quot;tagged_id&quot;&gt;3&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;1&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Django Reinhardt&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;2&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Stephane Grappelli&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;3&quot; model=&quot;fixtures.person&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Prince&lt;/field&gt;&lt;/object&gt;&lt;object pk=&quot;10&quot; model=&quot;fixtures.book&quot;&gt;&lt;field type=&quot;CharField&quot; name=&quot;name&quot;&gt;Achieving self-awareness of Python programs&lt;/field&gt;&lt;field to=&quot;fixtures.person&quot; name=&quot;authors&quot; rel=&quot;ManyToManyRel&quot;&gt;&lt;/field&gt;&lt;/object&gt;&lt;/django-objects&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;xml&#39;</span><span class="p">,</span> <span class="n">natural_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FixtureTransactionTests</span><span class="p">(</span><span class="n">TransactionTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_dumpdata_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">):</span>
        <span class="n">new_io</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;dumpdata&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s">&#39;format&#39;</span><span class="p">:</span><span class="n">format</span><span class="p">,</span> <span class="s">&#39;stdout&#39;</span><span class="p">:</span><span class="n">new_io</span><span class="p">})</span>
        <span class="n">command_output</span> <span class="o">=</span> <span class="n">new_io</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">command_output</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

    <span class="nd">@skipUnlessDBFeature</span><span class="p">(</span><span class="s">&#39;supports_forward_references&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_format_discovery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>Load fixture 1 again, using format discovery</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture1&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Time to reform copyright&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>Try to load fixture 2 using format discovery; this will fail
because there are two fixture2's in the fixtures directory</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegexp</span><span class="p">(</span><span class="n">management</span><span class="o">.</span><span class="n">CommandError</span><span class="p">,</span>
                <span class="s">&quot;Multiple fixtures named &#39;fixture2&#39;&quot;</span><span class="p">):</span>
            <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture2&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>object list is unaffected</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Time to reform copyright&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>Dump the current contents of the database as a JSON fixture</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_dumpdata_assert</span><span class="p">([</span><span class="s">&#39;fixtures&#39;</span><span class="p">],</span> <span class="s">&#39;[{&quot;pk&quot;: 1, &quot;model&quot;: &quot;fixtures.category&quot;, &quot;fields&quot;: {&quot;description&quot;: &quot;Latest news stories&quot;, &quot;title&quot;: &quot;News Stories&quot;}}, {&quot;pk&quot;: 2, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Poker has no place on ESPN&quot;, &quot;pub_date&quot;: &quot;2006-06-16T12:00:00&quot;}}, {&quot;pk&quot;: 3, &quot;model&quot;: &quot;fixtures.article&quot;, &quot;fields&quot;: {&quot;headline&quot;: &quot;Time to reform copyright&quot;, &quot;pub_date&quot;: &quot;2006-06-16T13:00:00&quot;}}, {&quot;pk&quot;: 10, &quot;model&quot;: &quot;fixtures.book&quot;, &quot;fields&quot;: {&quot;name&quot;: &quot;Achieving self-awareness of Python programs&quot;, &quot;authors&quot;: []}}]&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>Load fixture 4 (compressed), using format discovery</p></td><td class="code"><div class="highlight"><pre>        <span class="n">management</span><span class="o">.</span><span class="n">call_command</span><span class="p">(</span><span class="s">&#39;loaddata&#39;</span><span class="p">,</span> <span class="s">&#39;fixture4&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Article: Django pets kitten&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Time to reform copyright&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Article: Poker has no place on ESPN&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
