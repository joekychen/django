<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › model_formsets › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_get_foreign_key</span><span class="p">,</span> <span class="n">inlineformset_factory</span><span class="p">,</span>
    <span class="n">modelformset_factory</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span><span class="p">,</span> <span class="n">skipUnlessDBFeature</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">BetterAuthor</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">BookWithCustomPK</span><span class="p">,</span>
    <span class="n">BookWithOptionalAltEditor</span><span class="p">,</span> <span class="n">AlternateBook</span><span class="p">,</span> <span class="n">AuthorMeeting</span><span class="p">,</span> <span class="n">CustomPrimaryKey</span><span class="p">,</span>
    <span class="n">Place</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">OwnerProfile</span><span class="p">,</span> <span class="n">Restaurant</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span>
    <span class="n">MexicanRestaurant</span><span class="p">,</span> <span class="n">ClassyMexicanRestaurant</span><span class="p">,</span> <span class="n">Repository</span><span class="p">,</span> <span class="n">Revision</span><span class="p">,</span>
    <span class="n">Person</span><span class="p">,</span> <span class="n">Membership</span><span class="p">,</span> <span class="n">Team</span><span class="p">,</span> <span class="n">Player</span><span class="p">,</span> <span class="n">Poet</span><span class="p">,</span> <span class="n">Poem</span><span class="p">,</span> <span class="n">Post</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DeletionTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PoetFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Poet</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">poet</span> <span class="o">=</span> <span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">poet</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;test&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;on&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_add_form_deletion_when_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that an add form that is filled out, but marked for deletion</span>
<span class="sd">        doesn&#39;t cause validation errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PoetFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Poet</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Make sure this form doesn't pass validation.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Then make sure that it <em>does</em> pass validation and delete the object,
even though the data isn't actually valid.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span><span class="p">[</span><span class="s">&#39;form-0-DELETE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;on&#39;</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_change_form_deletion_when_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure that an add form that is filled out, but marked for deletion</span>
<span class="sd">        doesn&#39;t cause validation errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PoetFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Poet</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">poet</span> <span class="o">=</span> <span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">poet</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;x&#39;</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Make sure this form doesn't pass validation.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Then make sure that it <em>does</em> pass validation and delete the object,
even though the data isn't actually valid.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span><span class="p">[</span><span class="s">&#39;form-0-DELETE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;on&#39;</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ModelFormsetTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_simple_save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; id=&quot;id_form-0-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-1-name&quot; type=&quot;text&quot; name=&quot;form-1-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; id=&quot;id_form-1-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-2-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-2-name&quot; type=&quot;text&quot; name=&quot;form-2-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-2-id&quot; id=&quot;id_form-2-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Arthur Rimbaud&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">author1</span><span class="p">,</span> <span class="n">author2</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">author1</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">author2</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Arthur Rimbaud&#39;</span><span class="p">))</span>

        <span class="n">authors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="p">[</span><span class="n">author2</span><span class="p">,</span> <span class="n">author1</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Gah! We forgot Paul Verlaine. Let's create a formset to edit the
existing authors with an extra form to add him. We <em>could</em> pass in a
queryset to restrict the Author objects we edit, but in this case
we'll use it to display them in alphabetical order by name.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">qs</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; value=&quot;Arthur Rimbaud&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-0-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-1-name&quot; type=&quot;text&quot; name=&quot;form-1-name&quot; value=&quot;Charles Baudelaire&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-1-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-2-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-2-name&quot; type=&quot;text&quot; name=&quot;form-2-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-2-id&quot; id=&quot;id_form-2-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Arthur Rimbaud&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;Paul Verlaine&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Only changed or new objects are returned from formset.save()</p></td><td class="code"><div class="highlight"><pre>        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">author3</span> <span class="o">=</span> <span class="n">saved</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">author3</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul Verlaine&#39;</span><span class="p">))</span>

        <span class="n">authors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="p">[</span><span class="n">author2</span><span class="p">,</span> <span class="n">author1</span><span class="p">,</span> <span class="n">author3</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>This probably shouldn't happen, but it will. If an add form was
marked for deletion, make sure we don't save that form.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">qs</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; value=&quot;Arthur Rimbaud&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-DELETE&quot;&gt;Delete:&lt;/label&gt; &lt;input type=&quot;checkbox&quot; name=&quot;form-0-DELETE&quot; id=&quot;id_form-0-DELETE&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-0-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-1-name&quot; type=&quot;text&quot; name=&quot;form-1-name&quot; value=&quot;Charles Baudelaire&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-DELETE&quot;&gt;Delete:&lt;/label&gt; &lt;input type=&quot;checkbox&quot; name=&quot;form-1-DELETE&quot; id=&quot;id_form-1-DELETE&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-1-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-2-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-2-name&quot; type=&quot;text&quot; name=&quot;form-2-name&quot; value=&quot;Paul Verlaine&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-2-DELETE&quot;&gt;Delete:&lt;/label&gt; &lt;input type=&quot;checkbox&quot; name=&quot;form-2-DELETE&quot; id=&quot;id_form-2-DELETE&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-2-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-2-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-3-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-3-name&quot; type=&quot;text&quot; name=&quot;form-3-name&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-3-DELETE&quot;&gt;Delete:&lt;/label&gt; &lt;input type=&quot;checkbox&quot; name=&quot;form-3-DELETE&quot; id=&quot;id_form-3-DELETE&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-3-id&quot; id=&quot;id_form-3-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Arthur Rimbaud&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-2-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;Paul Verlaine&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-3-name&#39;</span><span class="p">:</span> <span class="s">&#39;Walt Whitman&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-3-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;on&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>No objects were changed or saved so nothing will come back.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(),</span> <span class="p">[])</span>

        <span class="n">authors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="p">[</span><span class="n">author2</span><span class="p">,</span> <span class="n">author1</span><span class="p">,</span> <span class="n">author3</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Let's edit a record to ensure save only returns that one record.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Walt Whitman&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-2-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;Paul Verlaine&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-3-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-3-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>One record has changed.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">saved</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Walt Whitman&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_commit_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Test the behavior of commit=False and save_m2m</p></td><td class="code"><div class="highlight"><pre>        <span class="n">author1</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>
        <span class="n">author2</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul Verlaine&#39;</span><span class="p">)</span>
        <span class="n">author3</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Walt Whitman&#39;</span><span class="p">)</span>

        <span class="n">meeting</span> <span class="o">=</span> <span class="n">AuthorMeeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">created</span><span class="o">=</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
        <span class="n">meeting</span><span class="o">.</span><span class="n">authors</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>create an Author instance to add to the meeting.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">author4</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;John Steinbeck&#39;</span><span class="p">)</span>

        <span class="n">AuthorMeetingFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">AuthorMeeting</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">meeting</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;2nd Tuesday of the Week Meeting&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-authors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">author2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">author1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">author3</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">author4</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-authors&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorMeetingFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">AuthorMeeting</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">formset</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Author: Charles Baudelaire&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: John Steinbeck&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Paul Verlaine&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Walt Whitman&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_max_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Test the behavior of max<em>num with model formsets. It should allow
all existing related objects/inlines for a given object to be
displayed, but not allow the creation of new inlines beyond max</em>num.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">author1</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>
        <span class="n">author2</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Paul Verlaine&#39;</span><span class="p">)</span>
        <span class="n">author3</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Walt Whitman&#39;</span><span class="p">)</span>

        <span class="n">qs</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">extra_forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">extra_forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">extra_forms</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Author: Charles Baudelaire&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Paul Verlaine&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Walt Whitman&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Author: Charles Baudelaire&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Paul Verlaine&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Walt Whitman&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

        <span class="n">AuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorFormSet</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">(),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Author: Charles Baudelaire&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Paul Verlaine&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Author: Walt Whitman&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_custom_save_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">PoetForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>change the name to "Vladimir Mayakovsky" just to be a jerk.</p></td><td class="code"><div class="highlight"><pre>                <span class="n">author</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PoetForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">author</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Vladimir Mayakovsky&quot;</span>
                <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
                    <span class="n">author</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">author</span>

        <span class="n">PoetFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Poet</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">PoetForm</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Walt Whitman&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">qs</span> <span class="o">=</span> <span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoetFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">poets</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">poets</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">poet1</span><span class="p">,</span> <span class="n">poet2</span> <span class="o">=</span> <span class="n">poets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">poet1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Vladimir Mayakovsky&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">poet2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Vladimir Mayakovsky&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_custom_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test that model_formset respects fields and exclude parameters of</span>
<span class="sd">            custom form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">class</span> <span class="nc">PostForm1</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">PostForm2</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;subtitle&#39;</span><span class="p">,)</span>

        <span class="n">PostFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">PostForm1</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PostFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s">&quot;subtitle&quot;</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

        <span class="n">PostFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">PostForm2</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PostFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="s">&quot;subtitle&quot;</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_model_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">BetterAuthorFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">BetterAuthor</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">BetterAuthorFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-write_speed&quot;&gt;Write speed:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;form-0-write_speed&quot; id=&quot;id_form-0-write_speed&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-author_ptr&quot; id=&quot;id_form-0-author_ptr&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-author_ptr&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Ernest Hemingway&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-write_speed&#39;</span><span class="p">:</span> <span class="s">&#39;10&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">BetterAuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">author1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">author1</span><span class="p">,</span> <span class="n">BetterAuthor</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ernest Hemingway&#39;</span><span class="p">))</span>
        <span class="n">hemingway_id</span> <span class="o">=</span> <span class="n">BetterAuthor</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ernest Hemingway&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pk</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">BetterAuthorFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-0-name&quot; type=&quot;text&quot; name=&quot;form-0-name&quot; value=&quot;Ernest Hemingway&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-write_speed&quot;&gt;Write speed:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;form-0-write_speed&quot; value=&quot;10&quot; id=&quot;id_form-0-write_speed&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-0-author_ptr&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_form-0-author_ptr&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">hemingway_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_form-1-name&quot; type=&quot;text&quot; name=&quot;form-1-name&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-1-write_speed&quot;&gt;Write speed:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;form-1-write_speed&quot; id=&quot;id_form-1-write_speed&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;form-1-author_ptr&quot; id=&quot;id_form-1-author_ptr&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;form-0-author_ptr&#39;</span><span class="p">:</span> <span class="n">hemingway_id</span><span class="p">,</span>
            <span class="s">&#39;form-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Ernest Hemingway&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-write_speed&#39;</span><span class="p">:</span> <span class="s">&#39;10&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-author_ptr&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-write_speed&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">BetterAuthorFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(),</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">test_inline_formsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>We can also create a formset that is tied to a parent model. This is
how the admin system's edit inline functionality works.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-0-title&quot; type=&quot;text&quot; name=&quot;book_set-0-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-id&quot; id=&quot;id_book_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span>  <span class="o">%</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-1-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-1-title&quot; type=&quot;text&quot; name=&quot;book_set-1-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-1-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-id&quot; id=&quot;id_book_set-1-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-2-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-2-title&quot; type=&quot;text&quot; name=&quot;book_set-2-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-2-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-id&quot; id=&quot;id_book_set-2-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-2-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">book1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">book_set</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;&lt;Book: Les Fleurs du Mal&gt;&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Now that we've added a book to Charles Baudelaire, let's try adding
another one. This time though, an edit form will be available for
every existing book.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-0-title&quot; type=&quot;text&quot; name=&quot;book_set-0-title&quot; value=&quot;Les Fleurs du Mal&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">book1</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-1-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-1-title&quot; type=&quot;text&quot; name=&quot;book_set-1-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-1-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-id&quot; id=&quot;id_book_set-1-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-2-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-2-title&quot; type=&quot;text&quot; name=&quot;book_set-2-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-author&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_book_set-2-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-id&quot; id=&quot;id_book_set-2-id&quot; /&gt;&lt;/p&gt;&#39;</span> <span class="o">%</span> <span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;book_set-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-2-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">book2</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book2</span><span class="p">,</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>As you can see, 'Les Paradis Artificiels' is now a book belonging to
Charles Baudelaire.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">book_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">),</span> <span class="p">[</span>
            <span class="s">&#39;&lt;Book: Les Fleurs du Mal&gt;&#39;</span><span class="p">,</span>
            <span class="s">&#39;&lt;Book: Les Paradis Artificiels&gt;&#39;</span><span class="p">,</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_inline_formsets_save_as_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>The save<em>as</em>new parameter lets you re-associate the data to a new
instance.  This is used in the admin for save_as functionality.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;book_set-0-id&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-id&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-2-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">Author</span><span class="p">(),</span> <span class="n">save_as_new</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">new_author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">new_author</span><span class="p">,</span> <span class="n">save_as_new</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">book1</span><span class="p">,</span> <span class="n">book2</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book2</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Test using a custom prefix on an inline formset.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_test-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_test-0-title&quot; type=&quot;text&quot; name=&quot;test-0-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;test-0-author&quot; id=&quot;id_test-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;test-0-id&quot; id=&quot;id_test-0-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_test-1-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_test-1-title&quot; type=&quot;text&quot; name=&quot;test-1-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;test-1-author&quot; id=&quot;id_test-1-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;test-1-id&quot; id=&quot;id_test-1-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inline_formsets_with_custom_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>Test inline formsets where the inline-edited object has a custom
primary key that is not the fk to the parent object.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet2</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">BookWithCustomPK</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet2</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_bookwithcustompk_set-0-my_pk&quot;&gt;My pk:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;bookwithcustompk_set-0-my_pk&quot; id=&quot;id_bookwithcustompk_set-0-my_pk&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_bookwithcustompk_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_bookwithcustompk_set-0-title&quot; type=&quot;text&quot; name=&quot;bookwithcustompk_set-0-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;bookwithcustompk_set-0-author&quot; value=&quot;1&quot; id=&quot;id_bookwithcustompk_set-0-author&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;bookwithcustompk_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;bookwithcustompk_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;bookwithcustompk_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;bookwithcustompk_set-0-my_pk&#39;</span><span class="p">:</span> <span class="s">&#39;77777&#39;</span><span class="p">,</span>
            <span class="s">&#39;bookwithcustompk_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">book1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="mi">77777</span><span class="p">)</span>

        <span class="n">book1</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">bookwithcustompk_set</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inline_formsets_with_multi_table_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Test inline formsets where the inline-edited object uses multi-table
inheritance, thus has a non AutoField yet auto-created primary key.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet3</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">AlternateBook</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet3</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_alternatebook_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_alternatebook_set-0-title&quot; type=&quot;text&quot; name=&quot;alternatebook_set-0-title&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_alternatebook_set-0-notes&quot;&gt;Notes:&lt;/label&gt; &lt;input id=&quot;id_alternatebook_set-0-notes&quot; type=&quot;text&quot; name=&quot;alternatebook_set-0-notes&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;alternatebook_set-0-author&quot; value=&quot;1&quot; id=&quot;id_alternatebook_set-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;alternatebook_set-0-book_ptr&quot; id=&quot;id_alternatebook_set-0-book_ptr&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;alternatebook_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;alternatebook_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;alternatebook_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;alternatebook_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Flowers of Evil&#39;</span><span class="p">,</span>
            <span class="s">&#39;alternatebook_set-0-notes&#39;</span><span class="p">:</span> <span class="s">&#39;English translation of Les Fleurs du Mal&#39;</span>
        <span class="p">}</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">book1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Flowers of Evil&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="s">&#39;English translation of Les Fleurs du Mal&#39;</span><span class="p">)</span>

    <span class="nd">@skipUnlessDBFeature</span><span class="p">(</span><span class="s">&#39;ignores_nulls_in_unique_constraints&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_inline_formsets_with_nullable_unique_together</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Test inline formsets where the inline-edited object has a
unique_together constraint with a nullable member</p></td><td class="code"><div class="highlight"><pre>        <span class="n">AuthorBooksFormSet4</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">BookWithOptionalAltEditor</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-0-author&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-1-author&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;bookwithoptionalalteditor_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet4</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">book1</span><span class="p">,</span> <span class="n">book2</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">author_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book2</span><span class="o">.</span><span class="n">author_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">book2</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_inline_formsets_with_custom_save_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">AuthorBooksFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>
        <span class="n">book1</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">)</span>
        <span class="n">book2</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>
        <span class="n">book3</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Flowers of Evil&#39;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">PoemForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>change the name to "Brooklyn Bridge" just to be a jerk.</p></td><td class="code"><div class="highlight"><pre>                <span class="n">poem</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PoemForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">poem</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Brooklyn Bridge&quot;</span>
                <span class="k">if</span> <span class="n">commit</span><span class="p">:</span>
                    <span class="n">poem</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">poem</span>

        <span class="n">PoemFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Poet</span><span class="p">,</span> <span class="n">Poem</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">PoemForm</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;poem_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;poem_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;poem_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;poem_set-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;The Cloud in Trousers&#39;</span><span class="p">,</span>
            <span class="s">&#39;poem_set-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;I&#39;</span><span class="p">,</span>
            <span class="s">&#39;poem_set-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">poet</span> <span class="o">=</span> <span class="n">Poet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Vladimir Mayakovsky&#39;</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PoemFormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">poet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">poem1</span><span class="p">,</span> <span class="n">poem2</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">poem1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Brooklyn Bridge&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">poem2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Brooklyn Bridge&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>We can provide a custom queryset to our InlineFormSet:</p></td><td class="code"><div class="highlight"><pre>        <span class="n">custom_qs</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-title&#39;</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">custom_qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-0-title&quot; type=&quot;text&quot; name=&quot;book_set-0-title&quot; value=&quot;Les Paradis Artificiels&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-author&quot; value=&quot;1&quot; id=&quot;id_book_set-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-id&quot; value=&quot;1&quot; id=&quot;id_book_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-1-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-1-title&quot; type=&quot;text&quot; name=&quot;book_set-1-title&quot; value=&quot;Les Fleurs du Mal&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-author&quot; value=&quot;1&quot; id=&quot;id_book_set-1-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-id&quot; value=&quot;2&quot; id=&quot;id_book_set-1-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-2-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-2-title&quot; type=&quot;text&quot; name=&quot;book_set-2-title&quot; value=&quot;Flowers of Evil&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-author&quot; value=&quot;1&quot; id=&quot;id_book_set-2-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-id&quot; value=&quot;3&quot; id=&quot;id_book_set-2-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-3-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-3-title&quot; type=&quot;text&quot; name=&quot;book_set-3-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-3-author&quot; value=&quot;1&quot; id=&quot;id_book_set-3-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-3-id&quot; id=&quot;id_book_set-3-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-4-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-4-title&quot; type=&quot;text&quot; name=&quot;book_set-4-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-4-author&quot; value=&quot;1&quot; id=&quot;id_book_set-4-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-4-id&quot; id=&quot;id_book_set-4-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;5&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;book_set-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-2-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-2-title&#39;</span><span class="p">:</span> <span class="s">&#39;Flowers of Evil&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-3-title&#39;</span><span class="p">:</span> <span class="s">&#39;Revue des deux mondes&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-4-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">custom_qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">custom_qs</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__startswith</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">custom_qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-0-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-0-title&quot; type=&quot;text&quot; name=&quot;book_set-0-title&quot; value=&quot;Flowers of Evil&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-author&quot; value=&quot;1&quot; id=&quot;id_book_set-0-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-0-id&quot; value=&quot;3&quot; id=&quot;id_book_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-1-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-1-title&quot; type=&quot;text&quot; name=&quot;book_set-1-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-author&quot; value=&quot;1&quot; id=&quot;id_book_set-1-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-1-id&quot; id=&quot;id_book_set-1-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_book_set-2-title&quot;&gt;Title:&lt;/label&gt; &lt;input id=&quot;id_book_set-2-title&quot; type=&quot;text&quot; name=&quot;book_set-2-title&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-author&quot; value=&quot;1&quot; id=&quot;id_book_set-2-author&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;book_set-2-id&quot; id=&quot;id_book_set-2-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="c"># the number of forms rendered</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="c"># the number of forms with initial data</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># the max number of forms</span>
            <span class="s">&#39;book_set-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;Flowers of Evil&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;Revue des deux mondes&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-2-title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">AuthorBooksFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">custom_qs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_custom_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>We need to ensure that it is displayed</p></td><td class="code"><div class="highlight"><pre>        <span class="n">CustomPrimaryKeyFormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">CustomPrimaryKey</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">CustomPrimaryKeyFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-my_pk&quot;&gt;My pk:&lt;/label&gt; &lt;input id=&quot;id_form-0-my_pk&quot; type=&quot;text&quot; name=&quot;form-0-my_pk&quot; maxlength=&quot;10&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-some_field&quot;&gt;Some field:&lt;/label&gt; &lt;input id=&quot;id_form-0-some_field&quot; type=&quot;text&quot; name=&quot;form-0-some_field&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Custom primary keys with ForeignKey, OneToOneField and AutoField ############</p></td><td class="code"><div class="highlight"><pre>        <span class="n">place</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Giordanos&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Chicago&#39;</span><span class="p">)</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Place</span><span class="p">,</span> <span class="n">Owner</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_owner_set-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_owner_set-0-name&quot; type=&quot;text&quot; name=&quot;owner_set-0-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-0-place&quot; value=&quot;1&quot; id=&quot;id_owner_set-0-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-0-auto_id&quot; id=&quot;id_owner_set-0-auto_id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_owner_set-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_owner_set-1-name&quot; type=&quot;text&quot; name=&quot;owner_set-1-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-1-place&quot; value=&quot;1&quot; id=&quot;id_owner_set-1-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-1-auto_id&quot; id=&quot;id_owner_set-1-auto_id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;owner_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-0-auto_id&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Joe Perry&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-1-auto_id&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">owner1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">owner1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Joe Perry&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">owner1</span><span class="o">.</span><span class="n">place</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Giordanos&#39;</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_owner_set-0-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_owner_set-0-name&quot; type=&quot;text&quot; name=&quot;owner_set-0-name&quot; value=&quot;Joe Perry&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-0-place&quot; value=&quot;1&quot; id=&quot;id_owner_set-0-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-0-auto_id&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_owner_set-0-auto_id&quot; /&gt;&lt;/p&gt;&#39;</span>
            <span class="o">%</span> <span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_owner_set-1-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_owner_set-1-name&quot; type=&quot;text&quot; name=&quot;owner_set-1-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-1-place&quot; value=&quot;1&quot; id=&quot;id_owner_set-1-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-1-auto_id&quot; id=&quot;id_owner_set-1-auto_id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_owner_set-2-name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_owner_set-2-name&quot; type=&quot;text&quot; name=&quot;owner_set-2-name&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-2-place&quot; value=&quot;1&quot; id=&quot;id_owner_set-2-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;owner_set-2-auto_id&quot; id=&quot;id_owner_set-2-auto_id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;owner_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;3&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-0-auto_id&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">),</span>
            <span class="s">&#39;owner_set-0-name&#39;</span><span class="p">:</span> <span class="s">&#39;Joe Perry&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-1-auto_id&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-1-name&#39;</span><span class="p">:</span> <span class="s">&#39;Jack Berry&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-2-auto_id&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;owner_set-2-name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">owner2</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">owner2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Jack Berry&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">owner2</span><span class="o">.</span><span class="n">place</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Giordanos&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Ensure a custom primary key that is a ForeignKey or OneToOneField get rendered for the user to choose.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">OwnerProfile</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-owner&quot;&gt;Owner:&lt;/label&gt; &lt;select name=&quot;form-0-owner&quot; id=&quot;id_form-0-owner&quot;&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;option value=&quot;</span><span class="si">%d</span><span class="s">&quot;&gt;Joe Perry at Giordanos&lt;/option&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;option value=&quot;</span><span class="si">%d</span><span class="s">&quot;&gt;Jack Berry at Giordanos&lt;/option&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;/select&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_form-0-age&quot;&gt;Age:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;form-0-age&quot; id=&quot;id_form-0-age&quot; /&gt;&lt;/p&gt;&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">,</span> <span class="n">owner2</span><span class="o">.</span><span class="n">auto_id</span><span class="p">))</span>

        <span class="n">owner1</span> <span class="o">=</span> <span class="n">Owner</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Joe Perry&#39;</span><span class="p">)</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Owner</span><span class="p">,</span> <span class="n">OwnerProfile</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FormSet</span><span class="o">.</span><span class="n">max_num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_ownerprofile-0-age&quot;&gt;Age:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;ownerprofile-0-age&quot; id=&quot;id_ownerprofile-0-age&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;ownerprofile-0-owner&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_ownerprofile-0-owner&quot; /&gt;&lt;/p&gt;&#39;</span>
            <span class="o">%</span> <span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;ownerprofile-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-0-owner&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-0-age&#39;</span><span class="p">:</span> <span class="s">&#39;54&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">profile1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">profile1</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">profile1</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="mi">54</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_ownerprofile-0-age&quot;&gt;Age:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;ownerprofile-0-age&quot; value=&quot;54&quot; id=&quot;id_ownerprofile-0-age&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;ownerprofile-0-owner&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_ownerprofile-0-owner&quot; /&gt;&lt;/p&gt;&#39;</span>
            <span class="o">%</span> <span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;ownerprofile-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;ownerprofile-0-owner&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">owner1</span><span class="o">.</span><span class="n">auto_id</span><span class="p">),</span>
            <span class="s">&#39;ownerprofile-0-age&#39;</span><span class="p">:</span> <span class="s">&#39;55&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">profile1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">profile1</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span> <span class="n">owner1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">profile1</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_unique_true_enforces_max_num_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>ForeignKey with unique=True should enforce max_num=1</p></td><td class="code"><div class="highlight"><pre>        <span class="n">place</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Giordanos&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;Chicago&#39;</span><span class="p">)</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Place</span><span class="p">,</span> <span class="n">Location</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">FormSet</span><span class="o">.</span><span class="n">max_num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">place</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_location_set-0-lat&quot;&gt;Lat:&lt;/label&gt; &lt;input id=&quot;id_location_set-0-lat&quot; type=&quot;text&quot; name=&quot;location_set-0-lat&quot; maxlength=&quot;100&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_location_set-0-lon&quot;&gt;Lon:&lt;/label&gt; &lt;input id=&quot;id_location_set-0-lon&quot; type=&quot;text&quot; name=&quot;location_set-0-lon&quot; maxlength=&quot;100&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;location_set-0-place&quot; value=&quot;1&quot; id=&quot;id_location_set-0-place&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;location_set-0-id&quot; id=&quot;id_location_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_foreign_keys_in_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_get_foreign_key</span><span class="p">(</span><span class="n">Restaurant</span><span class="p">,</span> <span class="n">Owner</span><span class="p">)),</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_get_foreign_key</span><span class="p">(</span><span class="n">MexicanRestaurant</span><span class="p">,</span> <span class="n">Owner</span><span class="p">)),</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_unique_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Product</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;car-red&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">product1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">product1</span><span class="o">.</span><span class="n">slug</span><span class="p">,</span> <span class="s">&#39;car-red&#39;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;car-red&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Product with this Slug already exists.&#39;</span><span class="p">]}])</span>

    <span class="k">def</span> <span class="nf">test_unique_together_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Price</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-price&#39;</span><span class="p">:</span> <span class="s">&#39;12.00&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-quantity&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">price1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">price1</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;12.00&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">price1</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-price&#39;</span><span class="p">:</span> <span class="s">&#39;12.00&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-quantity&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Price with this Price and Quantity already exists.&#39;</span><span class="p">]}])</span>

    <span class="k">def</span> <span class="nf">test_unique_together_with_inlineformset_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>Also see bug #8882.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">repository</span> <span class="o">=</span> <span class="n">Repository</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Test Repo&#39;</span><span class="p">)</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Repository</span><span class="p">,</span> <span class="n">Revision</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;revision_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-repository&#39;</span><span class="p">:</span> <span class="n">repository</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-revision&#39;</span><span class="p">:</span> <span class="s">&#39;146239817507f148d448db38840db7c3cbf47c76&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">repository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">saved</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">saved</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">revision1</span><span class="p">,</span> <span class="o">=</span> <span class="n">saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">revision1</span><span class="o">.</span><span class="n">repository</span><span class="p">,</span> <span class="n">repository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">revision1</span><span class="o">.</span><span class="n">revision</span><span class="p">,</span> <span class="s">&#39;146239817507f148d448db38840db7c3cbf47c76&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>attempt to save the same revision against against the same repo.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;revision_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-repository&#39;</span><span class="p">:</span> <span class="n">repository</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-revision&#39;</span><span class="p">:</span> <span class="s">&#39;146239817507f148d448db38840db7c3cbf47c76&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">repository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">[{</span><span class="s">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Revision with this Repository and Revision already exists.&#39;</span><span class="p">]}])</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>unique<em>together with inlineformset</em>factory with overridden form fields
Also see #9494</p></td><td class="code"><div class="highlight"><pre>        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Repository</span><span class="p">,</span> <span class="n">Revision</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;revision&#39;</span><span class="p">,),</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;revision_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-repository&#39;</span><span class="p">:</span> <span class="n">repository</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-revision&#39;</span><span class="p">:</span> <span class="s">&#39;146239817507f148d448db38840db7c3cbf47c76&#39;</span><span class="p">,</span>
            <span class="s">&#39;revision_set-0-DELETE&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">repository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_callable_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Use of callable defaults (see bug #7975).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Ringo&#39;</span><span class="p">)</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">Membership</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">person</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>Django will render a hidden field for model fields that have a callable
default. This is required to ensure the value is tested for change correctly
when determine what extra forms have changed to save.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># this formset only has one form</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;date_joined&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">initial</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">as_p</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:\.\d+)?&#39;</span><span class="p">,</span> <span class="s">&#39;__DATETIME__&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_membership_set-0-date_joined&quot;&gt;Date joined:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;membership_set-0-date_joined&quot; value=&quot;__DATETIME__&quot; id=&quot;id_membership_set-0-date_joined&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;initial-membership_set-0-date_joined&quot; value=&quot;__DATETIME__&quot; id=&quot;initial-membership_set-0-id_membership_set-0-date_joined&quot; /&gt;&lt;/p&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="s">&#39;&lt;p&gt;&lt;label for=&quot;id_membership_set-0-karma&quot;&gt;Karma:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;membership_set-0-karma&quot; id=&quot;id_membership_set-0-karma&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;membership_set-0-person&quot; value=&quot;</span><span class="si">%d</span><span class="s">&quot; id=&quot;id_membership_set-0-person&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;membership_set-0-id&quot; id=&quot;id_membership_set-0-id&quot; /&gt;&lt;/p&gt;&#39;</span>
            <span class="o">%</span> <span class="n">person</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>test for validation with callable defaults. Validations rely on hidden fields</p></td><td class="code"><div class="highlight"><pre>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;membership_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-0-date_joined&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;initial-membership_set-0-date_joined&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;membership_set-0-karma&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>now test for when the data changes</p></td><td class="code"><div class="highlight"><pre>        <span class="n">one_day_later</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">filled_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;membership_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-0-date_joined&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">one_day_later</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;initial-membership_set-0-date_joined&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;membership_set-0-karma&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">filled_data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>now test with split datetime fields</p></td><td class="code"><div class="highlight"><pre>        <span class="k">class</span> <span class="nc">MembershipForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="n">date_joined</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">SplitDateTimeField</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">now</span><span class="p">)</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Membership</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">MembershipForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;date_joined&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">SplitDateTimeWidget</span><span class="p">()</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">Membership</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">MembershipForm</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;membership_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;membership_set-0-date_joined_0&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)),</span>
            <span class="s">&#39;membership_set-0-date_joined_1&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;initial-membership_set-0-date_joined&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)),</span>
            <span class="s">&#39;membership_set-0-karma&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">person</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_inlineformset_factory_with_null_fk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>inlineformset_factory tests with fk having null=True. see #9462.
create some data that will exbit the issue</p></td><td class="code"><div class="highlight"><pre>        <span class="n">team</span> <span class="o">=</span> <span class="n">Team</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Red Vipers&quot;</span><span class="p">)</span>
        <span class="n">Player</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Timmy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">Player</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bobby&quot;</span><span class="p">,</span> <span class="n">team</span><span class="o">=</span><span class="n">team</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">PlayerInlineFormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Team</span><span class="p">,</span> <span class="n">Player</span><span class="p">)</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">PlayerInlineFormSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">(),</span> <span class="p">[])</span>

        <span class="n">formset</span> <span class="o">=</span> <span class="n">PlayerInlineFormSet</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">team</span><span class="p">)</span>
        <span class="n">players</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">player1</span><span class="p">,</span> <span class="o">=</span> <span class="n">players</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">player1</span><span class="o">.</span><span class="n">team</span><span class="p">,</span> <span class="n">team</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">player1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Bobby&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_model_formset_with_custom_pk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>a formset for a Model that has a custom primary key that still needs to be
added to the formset automatically</p></td><td class="code"><div class="highlight"><pre>        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">ClassyMexicanRestaurant</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tacos_are_yummy&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">FormSet</span><span class="p">()</span><span class="o">.</span><span class="n">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">[</span><span class="s">&#39;restaurant&#39;</span><span class="p">,</span> <span class="s">&#39;tacos_are_yummy&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_prevent_duplicates_from_with_the_same_formset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Product</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;red_car&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-slug&#39;</span><span class="p">:</span> <span class="s">&#39;red_car&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for slug.&#39;</span><span class="p">])</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Price</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-price&#39;</span><span class="p">:</span> <span class="s">&#39;25&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-quantity&#39;</span><span class="p">:</span> <span class="s">&#39;7&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-price&#39;</span><span class="p">:</span> <span class="s">&#39;25&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-quantity&#39;</span><span class="p">:</span> <span class="s">&#39;7&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for price and quantity, which must be unique.&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Only the price field is specified, this should skip any unique checks since
the unique_together is not fulfilled. This will fail with a KeyError if broken.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Price</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,),</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-price&#39;</span><span class="p">:</span> <span class="s">&#39;24&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-price&#39;</span><span class="p">:</span> <span class="s">&#39;24&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">inlineformset_factory</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">author</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Charles Baudelaire&#39;</span><span class="p">)</span>
        <span class="n">book1</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Paradis Artificiels&#39;</span><span class="p">)</span>
        <span class="n">book2</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Les Fleurs du Mal&#39;</span><span class="p">)</span>
        <span class="n">book3</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Flowers of Evil&#39;</span><span class="p">)</span>

        <span class="n">book_ids</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">book_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;book_set-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>

            <span class="s">&#39;book_set-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;The 2008 Election&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-0-author&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-0-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>

            <span class="s">&#39;book_set-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;The 2008 Election&#39;</span><span class="p">,</span>
            <span class="s">&#39;book_set-1-author&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s">&#39;book_set-1-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for title.&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="p">[{},</span> <span class="p">{</span><span class="s">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Please correct the duplicate values below.&#39;</span><span class="p">]}])</span>

        <span class="n">FormSet</span> <span class="o">=</span> <span class="n">modelformset_factory</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>

            <span class="s">&#39;form-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;blah&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Morning&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2009-01-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;blah&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Morning in Prague&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;rawr&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2009-01-01&#39;</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for title which must be unique for the date in posted.&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span>
            <span class="p">[{},</span> <span class="p">{</span><span class="s">&#39;__all__&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Please correct the duplicate values below.&#39;</span><span class="p">]}])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>

            <span class="s">&#39;form-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Morning in Prague&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2009-01-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;blah&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Morning in Prague&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;rawr&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2009-08-02&#39;</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for slug which must be unique for the year in posted.&#39;</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-MAX_NUM_FORMS&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>

            <span class="s">&#39;form-0-title&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Morning in Prague&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;rawr&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-0-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-08-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-title&#39;</span><span class="p">:</span> <span class="s">&#39;blah&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-slug&#39;</span><span class="p">:</span> <span class="s">&#39;Prague&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-subtitle&#39;</span><span class="p">:</span> <span class="s">&#39;rawr&#39;</span><span class="p">,</span>
            <span class="s">&#39;form-1-posted&#39;</span><span class="p">:</span> <span class="s">&#39;2009-08-02&#39;</span>
        <span class="p">}</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">FormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">_non_form_errors</span><span class="p">,</span>
            <span class="p">[</span><span class="s">&#39;Please correct the duplicate data for subtitle which must be unique for the month in posted.&#39;</span><span class="p">])</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
