<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › model_forms › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.core.files.uploadedfile</span> <span class="kn">import</span> <span class="n">SimpleUploadedFile</span>
<span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>
<span class="kn">from</span> <span class="nn">django.utils.unittest</span> <span class="kn">import</span> <span class="n">skipUnless</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Article</span><span class="p">,</span> <span class="n">ArticleStatus</span><span class="p">,</span> <span class="n">BetterWriter</span><span class="p">,</span> <span class="n">BigInt</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span>
    <span class="n">Category</span><span class="p">,</span> <span class="n">CommaSeparatedInteger</span><span class="p">,</span> <span class="n">CustomFieldForExclusionModel</span><span class="p">,</span> <span class="n">DerivedBook</span><span class="p">,</span>
    <span class="n">DerivedPost</span><span class="p">,</span> <span class="n">ExplicitPK</span><span class="p">,</span> <span class="n">FlexibleDatePost</span><span class="p">,</span> <span class="n">ImprovedArticle</span><span class="p">,</span>
    <span class="n">ImprovedArticleWithParentLink</span><span class="p">,</span> <span class="n">Inventory</span><span class="p">,</span> <span class="n">PhoneNumber</span><span class="p">,</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span>
    <span class="n">Product</span><span class="p">,</span> <span class="n">TextFile</span><span class="p">,</span> <span class="n">Writer</span><span class="p">,</span> <span class="n">WriterProfile</span><span class="p">,</span> <span class="n">test_images</span><span class="p">)</span>

<span class="k">if</span> <span class="n">test_images</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">ImageFile</span><span class="p">,</span> <span class="n">OptionalImageFile</span>
    <span class="k">class</span> <span class="nc">ImageFileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ImageFile</span>

    <span class="k">class</span> <span class="nc">OptionalImageFileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">OptionalImageFile</span>

<span class="k">class</span> <span class="nc">ProductForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Product</span>


<span class="k">class</span> <span class="nc">PriceForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Price</span>


<span class="k">class</span> <span class="nc">BookForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
       <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>


<span class="k">class</span> <span class="nc">DerivedBookForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DerivedBook</span>


<span class="k">class</span> <span class="nc">ExplicitPKForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ExplicitPK</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="s">&#39;desc&#39;</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">PostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">DerivedPostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DerivedPost</span>


<span class="k">class</span> <span class="nc">CustomWriterForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
   <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

   <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
       <span class="n">model</span> <span class="o">=</span> <span class="n">Writer</span>


<span class="k">class</span> <span class="nc">FlexDatePostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">FlexibleDatePost</span>


<span class="k">class</span> <span class="nc">BaseCategoryForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>


<span class="k">class</span> <span class="nc">ArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>


<span class="k">class</span> <span class="nc">ArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>

<span class="k">class</span> <span class="nc">PartialArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;headline&#39;</span><span class="p">,</span><span class="s">&#39;pub_date&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RoykoForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Writer</span>

<span class="k">class</span> <span class="nc">TestArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>

<span class="k">class</span> <span class="nc">PartialArticleFormWithSlug</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;headline&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ArticleStatusForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ArticleStatus</span>

<span class="k">class</span> <span class="nc">InventoryForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Inventory</span>

<span class="k">class</span> <span class="nc">SelectInventoryForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">to_field_name</span><span class="o">=</span><span class="s">&#39;barcode&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CustomFieldForExclusionForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">CustomFieldForExclusionModel</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;markup&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">ShortCategory</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ImprovedArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ImprovedArticle</span>

<span class="k">class</span> <span class="nc">ImprovedArticleWithParentLinkForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ImprovedArticleWithParentLink</span>

<span class="k">class</span> <span class="nc">BetterWriterForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BetterWriter</span>

<span class="k">class</span> <span class="nc">WriterProfileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">WriterProfile</span>

<span class="k">class</span> <span class="nc">PhoneNumberForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">PhoneNumber</span>

<span class="k">class</span> <span class="nc">TextFileForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">TextFile</span>

<span class="k">class</span> <span class="nc">BigIntForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BigInt</span>

<span class="k">class</span> <span class="nc">ModelFormWithMedia</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Media</span><span class="p">:</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;/some/form/javascript&#39;</span><span class="p">,)</span>
        <span class="n">css</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;all&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;/some/form/css&#39;</span><span class="p">,)</span>
        <span class="p">}</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">PhoneNumber</span>

<span class="k">class</span> <span class="nc">CommaSeparatedIntegerForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
   <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
       <span class="n">model</span> <span class="o">=</span> <span class="n">CommaSeparatedInteger</span>

<span class="k">class</span> <span class="nc">PriceFormWithoutQuantity</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Price</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;quantity&#39;</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ModelFormBaseTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_base_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">BaseCategoryForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_extra_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">ExtraFields</span><span class="p">(</span><span class="n">BaseCategoryForm</span><span class="p">):</span>
            <span class="n">some_extra_field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ExtraFields</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;some_extra_field&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_replace_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">ReplaceField</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ReplaceField</span><span class="o">.</span><span class="n">base_fields</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">],</span>
                                     <span class="n">forms</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_override_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">WriterForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Writer</span>

        <span class="n">wf</span> <span class="o">=</span> <span class="n">WriterForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Richard Lockridge&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">wf</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_limit_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">LimitFields</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">LimitFields</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_exclude_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">ExcludeFields</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ExcludeFields</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_confused_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">ConfusedForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Using &#39;fields&#39; *and* &#39;exclude&#39;. Not sure why you&#39;d want to do</span>
<span class="sd">            this, but uh, &quot;be liberal in what you accept&quot; and all.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">]</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ConfusedForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_mixmodel_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">MixModelForm</span><span class="p">(</span><span class="n">BaseCategoryForm</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Don&#39;t allow more than one &#39;model&#39; definition in the</span>
<span class="sd">            inheritance hierarchy.  Technically, it would generate a valid</span>
<span class="sd">            form, but the fact that the resulting save method won&#39;t deal with</span>
<span class="sd">            multiple objects is likely to trip up people not familiar with the</span>
<span class="sd">            mechanics.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Article</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>MixModelForm is now an Article-related thing, because MixModelForm.Meta
overrides BaseCategoryForm.Meta.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">MixModelForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="p">[</span><span class="s">&#39;headline&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s">&#39;writer&#39;</span><span class="p">,</span> <span class="s">&#39;article&#39;</span><span class="p">,</span> <span class="s">&#39;categories&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_article_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">ArticleForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="p">[</span><span class="s">&#39;headline&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s">&#39;writer&#39;</span><span class="p">,</span> <span class="s">&#39;article&#39;</span><span class="p">,</span> <span class="s">&#39;categories&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_bad_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>First class with a Meta class wins...</p></td><td class="code"><div class="highlight"><pre>        <span class="k">class</span> <span class="nc">BadForm</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">BaseCategoryForm</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">BadForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="p">[</span><span class="s">&#39;headline&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s">&#39;writer&#39;</span><span class="p">,</span> <span class="s">&#39;article&#39;</span><span class="p">,</span> <span class="s">&#39;categories&#39;</span><span class="p">,</span> <span class="s">&#39;status&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_subcategory_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">SubCategoryForm</span><span class="p">(</span><span class="n">BaseCategoryForm</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Subclassing without specifying a Meta on the class will use</span>
<span class="sd">            the parent&#39;s Meta (or the first parent in the MRO if there are</span>
<span class="sd">            multiple parent classes).</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">SubCategoryForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_subclassmeta_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">SomeCategoryForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
             <span class="n">checkbox</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>

             <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                 <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>

        <span class="k">class</span> <span class="nc">SubclassMeta</span><span class="p">(</span><span class="n">SomeCategoryForm</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; We can also subclass the Meta inner class to change the fields</span>
<span class="sd">            list.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">SomeCategoryForm</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">SubclassMeta</span><span class="p">()),</span>
            <span class="sd">&quot;&quot;&quot;&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_slug&quot;&gt;Slug:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_slug&quot; type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;20&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_checkbox&quot;&gt;Checkbox:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;checkbox&quot; id=&quot;id_checkbox&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_orderfields_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">OrderFields</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">OrderFields</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">OrderFields</span><span class="p">()),</span>
            <span class="sd">&quot;&quot;&quot;&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_url&quot;&gt;The URL:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_url&quot; type=&quot;text&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_orderfields2_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">OrderFields2</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">OrderFields2</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">TestWidgetForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">]</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">,</span>
            <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;url&#39;</span><span class="p">})</span>
        <span class="p">}</span>



<span class="k">class</span> <span class="nc">TestWidgets</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_base_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">frm</span> <span class="o">=</span> <span class="n">TestWidgetForm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]),</span>
            <span class="s">&#39;&lt;textarea id=&quot;id_name&quot; rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;name&quot;&gt;&lt;/textarea&gt;&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]),</span>
            <span class="s">&#39;&lt;input id=&quot;id_url&quot; type=&quot;text&quot; class=&quot;url&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">frm</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">]),</span>
            <span class="s">&#39;&lt;input id=&quot;id_slug&quot; type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;20&quot; /&gt;&#39;</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">IncompleteCategoryFormWithFields</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A form that replaces the model&#39;s url field with a custom one. This should</span>
<span class="sd">    prevent the model field&#39;s validation from being called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>

<span class="k">class</span> <span class="nc">IncompleteCategoryFormWithExclude</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A form that replaces the model&#39;s url field with a custom one. This should</span>
<span class="sd">    prevent the model field&#39;s validation from being called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>


<span class="k">class</span> <span class="nc">ValidationTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_validates_with_replaced_field_not_specified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">IncompleteCategoryFormWithFields</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;some name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;some-slug&#39;</span><span class="p">})</span>
        <span class="k">assert</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_validates_with_replaced_field_excluded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">IncompleteCategoryFormWithExclude</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;some name&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;some-slug&#39;</span><span class="p">})</span>
        <span class="k">assert</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_notrequired_overrides_notblank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CustomWriterForm</span><span class="p">({})</span>
        <span class="k">assert</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>unique/unique_together validation</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UniqueTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Mike Royko&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_simple_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ProductForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;teddy-bear-blue&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ProductForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;teddy-bear-blue&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Product with this Slug already exists.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ProductForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;teddy-bear-blue&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_unique_together</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ModelForm test of unique_together constraint&quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PriceForm</span><span class="p">({</span><span class="s">&#39;price&#39;</span><span class="p">:</span> <span class="s">&#39;6.00&#39;</span><span class="p">,</span> <span class="s">&#39;quantity&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PriceForm</span><span class="p">({</span><span class="s">&#39;price&#39;</span><span class="p">:</span> <span class="s">&#39;6.00&#39;</span><span class="p">,</span> <span class="s">&#39;quantity&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Price with this Price and Quantity already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_unique_null</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;I May Be Wrong But I Doubt It&#39;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Book with this Title and Author already exists.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_inherited_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Boss&#39;</span>
        <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span> <span class="n">special_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedBookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;Other&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;special_id&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;isbn&#39;</span><span class="p">:</span> <span class="s">&#39;12345&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;special_id&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Book with this Special id already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_inherited_unique_together</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Boss&#39;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedBookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;isbn&#39;</span><span class="p">:</span> <span class="s">&#39;12345&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Book with this Title and Author already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_abstract_inherited_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Boss&#39;</span>
        <span class="n">isbn</span> <span class="o">=</span> <span class="s">&#39;12345&#39;</span>
        <span class="n">dbook</span> <span class="o">=</span> <span class="n">DerivedBook</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span> <span class="n">isbn</span><span class="o">=</span><span class="n">isbn</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedBookForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;Other&#39;</span><span class="p">,</span> <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;isbn&#39;</span><span class="p">:</span> <span class="n">isbn</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;isbn&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Derived book with this Isbn already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_abstract_inherited_unique_together</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Boss&#39;</span>
        <span class="n">isbn</span> <span class="o">=</span> <span class="s">&#39;12345&#39;</span>
        <span class="n">dbook</span> <span class="o">=</span> <span class="n">DerivedBook</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span> <span class="n">isbn</span><span class="o">=</span><span class="n">isbn</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedBookForm</span><span class="p">({</span>
                    <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;Other&#39;</span><span class="p">,</span>
                    <span class="s">&#39;author&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
                    <span class="s">&#39;isbn&#39;</span><span class="p">:</span> <span class="s">&#39;9876&#39;</span><span class="p">,</span>
                    <span class="s">&#39;suffix1&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span><span class="p">,</span>
                    <span class="s">&#39;suffix2&#39;</span><span class="p">:</span> <span class="s">&#39;0&#39;</span>
                <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">],</span>
                         <span class="p">[</span><span class="s">&#39;Derived book with this Suffix1 and Suffix2 already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_explicitpk_unspecified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test for primary_key being in the form and failing validation.&quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExplicitPKForm</span><span class="p">({</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;desc&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span> <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_explicitpk_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensure keys and blank character strings are tested for uniqueness.&quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExplicitPKForm</span><span class="p">({</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;key1&#39;</span><span class="p">,</span> <span class="s">&#39;desc&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ExplicitPKForm</span><span class="p">({</span><span class="s">&#39;key&#39;</span><span class="p">:</span> <span class="s">&#39;key1&#39;</span><span class="p">,</span> <span class="s">&#39;desc&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;__all__&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Explicit pk with this Key and Desc already exists.&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;desc&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Explicit pk with this Desc already exists.&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Explicit pk with this Key already exists.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_unique_for_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="n">posted</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Title must be unique for Posted date.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Work on Django 1.1 begins&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-04&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-01-01&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Slug must be unique for Posted year.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-30&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;subtitle&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Subtitle must be unique for Posted month.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;posted&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;This field is required.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_inherited_unique_for_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="n">posted</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Title must be unique for Posted date.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Work on Django 1.1 begins&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-04&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-01-01&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Slug must be unique for Posted year.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-30&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;subtitle&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;Subtitle must be unique for Posted month.&#39;</span><span class="p">])</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">DerivedPostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="s">&#39;posted&#39;</span><span class="p">:</span> <span class="s">&#39;2008-09-03&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_unique_for_date_with_nullable_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">FlexibleDatePost</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;Django 1.0&quot;</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="n">posted</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">FlexDatePostForm</span><span class="p">({</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">FlexDatePostForm</span><span class="p">({</span><span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">FlexDatePostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">FlexDatePostForm</span><span class="p">({</span><span class="s">&#39;subtitle&#39;</span><span class="p">:</span> <span class="s">&quot;Finally&quot;</span><span class="p">,</span> <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0 is released&quot;</span><span class="p">,</span>
            <span class="s">&quot;slug&quot;</span><span class="p">:</span> <span class="s">&quot;Django 1.0&quot;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">OldFormForXTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_base_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
            <span class="sd">&quot;&quot;&quot;&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_slug&quot;&gt;Slug:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_slug&quot; type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;20&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_url&quot;&gt;The URL:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_url&quot; type=&quot;text&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">()),</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt; &lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&lt;/li&gt;</span>
<span class="sd">&lt;li&gt;&lt;label for=&quot;id_slug&quot;&gt;Slug:&lt;/label&gt; &lt;input id=&quot;id_slug&quot; type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;20&quot; /&gt;&lt;/li&gt;</span>
<span class="sd">&lt;li&gt;&lt;label for=&quot;id_url&quot;&gt;The URL:&lt;/label&gt; &lt;input id=&quot;id_url&quot; type=&quot;text&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&lt;/li&gt;&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]),</span>
            <span class="sd">&quot;&quot;&quot;&lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_auto_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">()),</span>
            <span class="sd">&quot;&quot;&quot;&lt;li&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;20&quot; /&gt;&lt;/li&gt;</span>
<span class="sd">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;20&quot; /&gt;&lt;/li&gt;</span>
<span class="sd">&lt;li&gt;The URL: &lt;input type=&quot;text&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&lt;/li&gt;&quot;&quot;&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_with_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">,</span>
                              <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;entertainment&#39;</span><span class="p">,</span>
                              <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;entertainment&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="s">&#39;entertainment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">],</span> <span class="s">&#39;entertainment&#39;</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Testing wether the same object is returned from the
ORM... not the fastest way...</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Entertainment&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">,</span>
                              <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;its-test&#39;</span><span class="p">,</span>
                              <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;test&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="s">&#39;its-test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">],</span> <span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Testing wether the same object is returned from the
ORM... not the fastest way...</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>If you call save() with commit=False, then it will return an object that
hasn't yet been saved to the database. In this case, it's up to you to call
save() on the resulting model instance.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Third test&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;third-test&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;third&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">],</span> <span class="s">&#39;third&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="s">&#39;Third test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="s">&#39;third-test&#39;</span><span class="p">)</span>
        <span class="n">c3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Third test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>If you call save() with invalid data, you'll get a ValueError.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;not a slug!&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;This field is required.&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;slug&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;Enter a valid &#39;slug&#39; consisting of letters, numbers, underscores or hyphens.&quot;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">BaseCategoryForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">})</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Create a couple of Writers.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">w_royko</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Mike Royko&#39;</span><span class="p">)</span>
        <span class="n">w_royko</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">w_woodward</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Bob Woodward&#39;</span><span class="p">)</span>
        <span class="n">w_woodward</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>ManyToManyFields are represented by a MultipleChoiceField, ForeignKeys and any
fields with the 'choices' attribute are represented by a ChoiceField.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;Headline:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Slug:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;50&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Pub date:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;pub_date&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Writer:&lt;/th&gt;&lt;td&gt;&lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Article:&lt;/th&gt;&lt;td&gt;&lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Categories:&lt;/th&gt;&lt;td&gt;&lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third test&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;br /&gt;&lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Status:&lt;/th&gt;&lt;td&gt;&lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>You can restrict a form to a subset of the complete list of fields
by providing a 'fields' argument. If you try to save a
model created with such a form, you need to ensure that the fields
that are <em>not</em> on the form have default values, or are allowed to have
a value of None. If a field isn't specified on a form, the object created
from the form can't provide a value for that field!</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">PartialArticleForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;Headline:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;Pub date:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;pub_date&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>When the ModelForm is passed an instance, that instance's current values are
inserted as 'initial' data in each Field.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">w</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Mike Royko&#39;</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">RoykoForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;Name:&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;Mike Royko&quot; maxlength=&quot;50&quot; /&gt;&lt;br /&gt;&lt;span class=&quot;helptext&quot;&gt;Use both first and last names.&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">art</span> <span class="o">=</span> <span class="n">Article</span><span class="p">(</span>
                    <span class="n">headline</span><span class="o">=</span><span class="s">&#39;Test article&#39;</span><span class="p">,</span>
                    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;test-article&#39;</span><span class="p">,</span>
                    <span class="n">pub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="n">writer</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                    <span class="n">article</span><span class="o">=</span><span class="s">&#39;Hello.&#39;</span>
                <span class="p">)</span>
        <span class="n">art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">art_id_1</span> <span class="o">=</span> <span class="n">art</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_id_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">art</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; value=&quot;Test article&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; value=&quot;test-article&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; value=&quot;1988-01-04&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Writer: &lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Article: &lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;Hello.&lt;/textarea&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Categories: &lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third test&lt;/option&gt;</span>
<span class="s">&lt;/select&gt; &lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Status: &lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">({</span>
                <span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;Test headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;test-headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1984-02-06&#39;</span><span class="p">,</span>
                <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
                <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Hello.&#39;</span>
            <span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">art</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">test_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_art</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">test_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">test_art</span><span class="o">.</span><span class="n">headline</span><span class="p">,</span> <span class="s">&#39;Test headline&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>You can create a form over a subset of the available fields
by specifying a 'fields' argument to form<em>for</em>instance.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">PartialArticleFormWithSlug</span><span class="p">({</span>
                <span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;New headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;new-headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1988-01-04&#39;</span>
            <span class="p">},</span> <span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">art</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; value=&quot;New headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; value=&quot;new-headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; value=&quot;1988-01-04&quot; /&gt;&lt;/li&gt;&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_art</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_art</span><span class="o">.</span><span class="n">headline</span><span class="p">,</span> <span class="s">&#39;New headline&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Add some categories and test the many-to-many form output.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="p">[])</span>
        <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Entertainment&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">new_art</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; value=&quot;New headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; value=&quot;new-headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; value=&quot;1988-01-04&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Writer: &lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Article: &lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;Hello.&lt;/textarea&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Categories: &lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third test&lt;/option&gt;</span>
<span class="s">&lt;/select&gt; &lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Status: &lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Initial values can be provided for model forms</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">(</span>
                <span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">initial</span><span class="o">=</span><span class="p">{</span>
                    <span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;Your headline here&#39;</span><span class="p">,</span>
                    <span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
                <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; value=&quot;Your headline here&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Writer: &lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Article: &lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;&lt;/textarea&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Categories: &lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third test&lt;/option&gt;</span>
<span class="s">&lt;/select&gt; &lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Status: &lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">({</span>
                <span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;New headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;new-headline&#39;</span><span class="p">,</span>
                <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1988-01-04&#39;</span><span class="p">,</span>
                <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
                <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Hello.&#39;</span><span class="p">,</span>
                <span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
            <span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">new_art</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_art</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)),</span>
                         <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Now, submit form data with no categories. This deletes the existing categories.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TestArticleForm</span><span class="p">({</span><span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;New headline&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;new-headline&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1988-01-04&#39;</span><span class="p">,</span>
            <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Hello.&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">new_art</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">new_art</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="p">[])</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Create a new article, with categories, via the form.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">({</span><span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;The walrus was Paul&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;walrus-was-paul&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1967-11-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Test.&#39;</span><span class="p">,</span> <span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)]})</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">art_id_2</span> <span class="o">=</span> <span class="n">new_art</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_id_2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">art_id_1</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Create a new article, with no categories, via the form.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">({</span><span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;The walrus was Paul&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;walrus-was-paul&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1967-11-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Test.&#39;</span><span class="p">})</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">art_id_3</span> <span class="o">=</span> <span class="n">new_art</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_id_3</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="n">art_id_2</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="p">[])</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Create a new article, with categories, via the form, but use commit=False.
The m2m data won't be saved until save_m2m() is invoked on the form.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">({</span><span class="s">&#39;headline&#39;</span><span class="p">:</span> <span class="s">&#39;The walrus was Paul&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;walrus-was-paul&#39;</span><span class="p">,</span> <span class="s">&#39;pub_date&#39;</span><span class="p">:</span> <span class="s">&#39;1967-11-01&#39;</span><span class="p">,</span>
            <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span> <span class="s">&#39;article&#39;</span><span class="p">:</span> <span class="s">&#39;Test.&#39;</span><span class="p">,</span> <span class="s">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)]})</span>
        <span class="n">new_art</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>Manually save the instance</p></td><td class="code"><div class="highlight"><pre>        <span class="n">new_art</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">art_id_4</span> <span class="o">=</span> <span class="n">new_art</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">art_id_4</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">art_id_1</span><span class="p">,</span> <span class="n">art_id_2</span><span class="p">,</span> <span class="n">art_id_3</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>The instance doesn't have m2m data yet</p></td><td class="code"><div class="highlight"><pre>        <span class="n">new_art</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">art_id_4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="p">[])</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Save the m2m data on the form</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_art</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Here, we define a custom ModelForm. Because it happens to have the same fields as
the Category model, we can just call the form's save() to apply its changes to an
existing Category instance.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">cat</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Third test&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Third test&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ShortCategory</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Third&#39;</span><span class="p">,</span> <span class="s">&#39;slug&#39;</span><span class="p">:</span> <span class="s">&#39;third&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="s">&#39;3rd&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Here, we demonstrate that choices for a ForeignKey ChoiceField are determined
at runtime, based on the data in the database when the form is displayed, not
the data in the database when the form is instantiated.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">(</span><span class="n">auto_id</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Writer: &lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Article: &lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;&lt;/textarea&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Categories: &lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third&lt;/option&gt;</span>
<span class="s">&lt;/select&gt; &lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Status: &lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>

        <span class="n">c4</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Fourth&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">&#39;4th&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Fourth&#39;</span><span class="p">)</span>
        <span class="n">w_bernstein</span> <span class="o">=</span> <span class="n">Writer</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Carl Bernstein&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">w_bernstein</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Carl Bernstein&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">as_ul</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;li&gt;Headline: &lt;input type=&quot;text&quot; name=&quot;headline&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Slug: &lt;input type=&quot;text&quot; name=&quot;slug&quot; maxlength=&quot;50&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Pub date: &lt;input type=&quot;text&quot; name=&quot;pub_date&quot; /&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Writer: &lt;select name=&quot;writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Carl Bernstein&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Article: &lt;textarea rows=&quot;10&quot; cols=&quot;40&quot; name=&quot;article&quot;&gt;&lt;/textarea&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Categories: &lt;select multiple=&quot;multiple&quot; name=&quot;categories&quot;&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Entertainment&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;It&amp;#39;s a test&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Third&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Fourth&lt;/option&gt;</span>
<span class="s">&lt;/select&gt; &lt;span class=&quot;helptext&quot;&gt; Hold down &quot;Control&quot;, or &quot;Command&quot; on a Mac, to select more than one.&lt;/span&gt;&lt;/li&gt;</span>
<span class="s">&lt;li&gt;Status: &lt;select name=&quot;status&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;1&quot;&gt;Draft&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;2&quot;&gt;Pending&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;3&quot;&gt;Live&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/li&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_bernstein</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">c4</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>ModelChoiceField ############################################################</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;---------&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Fourth&#39;</span><span class="p">)])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Add a Category object <em>after</em> the ModelChoiceField has already been
instantiated. This proves clean() checks the database during clean() rather
than caching it at time of instantiation.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">c5</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Fifth&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">&#39;5th&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c5</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Fifth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c5</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Fifth&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Delete a Category object <em>after</em> the ModelChoiceField has already been
instantiated. This proves clean() checks the database during clean() rather
than caching it at time of instantiation.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;5th&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c5</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Entertainment&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;100&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>queryset can be changed after the field is created.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Fourth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;---------&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>check that we can safely iterate choices repeatedly</p></td><td class="code"><div class="highlight"><pre>        <span class="n">gen_one</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span>
        <span class="n">gen_two</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">gen_one</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">gen_two</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;---------&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)])</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>check that we can override the label<em>from</em>instance method to print custom labels (#4620)</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">label_from_instance</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;category &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;---------&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;category Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;category It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;category Third&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;category Fourth&#39;</span><span class="p">)])</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>ModelMultipleChoiceField ####################################################</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Fourth&#39;</span><span class="p">)])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">])),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">])),</span> <span class="p">[</span><span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">)])),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)])),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)])),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">((</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">)))),</span> <span class="p">[</span><span class="s">&quot;Entertainment&quot;</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="s">&#39;100&#39;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;hello&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="s">&#39;fail&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Add a Category object <em>after</em> the ModelMultipleChoiceField has already been
instantiated. This proves clean() checks the database during clean() rather
than caching it at time of instantiation.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">c6</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Sixth&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">&#39;6th&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c6</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Sixth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c6</span><span class="o">.</span><span class="n">id</span><span class="p">])),</span> <span class="p">[</span><span class="s">&quot;Sixth&quot;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>Delete a Category object <em>after</em> the ModelMultipleChoiceField has already been
instantiated. This proves clean() checks the database during clean() rather
than caching it at time of instantiation.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">&#39;6th&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c6</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([]),</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">(()),</span> <span class="p">[])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="s">&#39;10&#39;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s">&#39;10&#39;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s">&#39;10&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>queryset can be changed after the field is created.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Fourth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;Third&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">])),</span> <span class="p">[</span><span class="s">&quot;Third&quot;</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="n">c4</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>

        <span class="n">f</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">label_from_instance</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="s">&quot;multicategory &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;multicategory Entertainment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&quot;multicategory It&#39;s a test&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c3</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;multicategory Third&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">c4</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="s">&#39;multicategory Fourth&#39;</span><span class="p">)])</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>OneToOneField ###############################################################</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ImprovedArticleForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;article&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ImprovedArticleWithParentLinkForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[])</span>

        <span class="n">bw</span> <span class="o">=</span> <span class="n">BetterWriter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Joe Better&#39;</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">bw</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">model_to_dict</span><span class="p">(</span><span class="n">bw</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                         <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;score&#39;</span><span class="p">,</span> <span class="s">&#39;writer_ptr&#39;</span><span class="p">])</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">BetterWriterForm</span><span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;Some Name&#39;</span><span class="p">,</span> <span class="s">&#39;score&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">bw2</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">bw2</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">WriterProfileForm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;p&gt;&lt;label for=&quot;id_writer&quot;&gt;Writer:&lt;/label&gt; &lt;select name=&quot;writer&quot; id=&quot;id_writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Carl Bernstein&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Joe Better&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/p&gt;</span>
<span class="s">&lt;p&gt;&lt;label for=&quot;id_age&quot;&gt;Age:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;age&quot; id=&quot;id_age&quot; /&gt;&lt;/p&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_bernstein</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">bw</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;writer&#39;</span><span class="p">:</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">),</span>
            <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="s">&#39;65&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">WriterProfileForm</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">instance</span><span class="p">),</span> <span class="s">&#39;Bob Woodward is 65&#39;</span><span class="p">)</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">WriterProfileForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_p</span><span class="p">(),</span> <span class="s">&#39;&#39;&#39;&lt;p&gt;&lt;label for=&quot;id_writer&quot;&gt;Writer:&lt;/label&gt; &lt;select name=&quot;writer&quot; id=&quot;id_writer&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot; selected=&quot;selected&quot;&gt;Bob Woodward&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Carl Bernstein&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Joe Better&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;Mike Royko&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&lt;/p&gt;</span>
<span class="s">&lt;p&gt;&lt;label for=&quot;id_age&quot;&gt;Age:&lt;/label&gt; &lt;input type=&quot;text&quot; name=&quot;age&quot; value=&quot;65&quot; id=&quot;id_age&quot; /&gt;&lt;/p&gt;&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w_woodward</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_bernstein</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">bw</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">w_royko</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_phone_number_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">PhoneNumberForm</span><span class="p">({</span><span class="s">&#39;phone&#39;</span><span class="p">:</span> <span class="s">&#39;(312) 555-1212&#39;</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;phone&#39;</span><span class="p">],</span> <span class="s">&#39;312-555-1212&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">],</span> <span class="s">&#39;Assistance&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_file_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>Test conditions when files is either not given or empty.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span> <span class="n">files</span><span class="o">=</span><span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Upload a file and ensure it all works as expected.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test1.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]),</span> <span class="n">SimpleUploadedFile</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test1.txt&#39;</span><span class="p">)</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test1.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]),</span> <span class="n">SimpleUploadedFile</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test1.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>Check if the max_length attribute has been inherited from the model.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test-maxlength.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Edit an instance that already has the file defined in the model. This will not
save the file again, but leave it exactly as it is.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test1.txt&#39;</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test1.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>Override the file by uploading a new one.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test2.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)},</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test2.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test2.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test2.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>Test the non-required FileField</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">})</span>
        <span class="n">f</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test3.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)},</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test3.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>Instance can be edited w/out re-uploading the file and existing file should be preserved.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;New Description&#39;</span><span class="p">},</span>
                <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;New Description&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test3.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">TextFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Assistance&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test3.txt&#39;</span><span class="p">,</span> <span class="n">b</span><span class="s">&#39;hello world&#39;</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test3.txt&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_big_integer_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bif</span> <span class="o">=</span> <span class="n">BigIntForm</span><span class="p">({</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="s">&#39;-9223372036854775808&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">bif</span> <span class="o">=</span> <span class="n">BigIntForm</span><span class="p">({</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="s">&#39;-9223372036854775809&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Ensure this value is greater than or equal to -9223372036854775808.&#39;</span><span class="p">]})</span>
        <span class="n">bif</span> <span class="o">=</span> <span class="n">BigIntForm</span><span class="p">({</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="s">&#39;9223372036854775807&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">bif</span> <span class="o">=</span> <span class="n">BigIntForm</span><span class="p">({</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="s">&#39;9223372036854775808&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bif</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;biggie&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Ensure this value is less than or equal to 9223372036854775807.&#39;</span><span class="p">]})</span>

    <span class="nd">@skipUnless</span><span class="p">(</span><span class="n">test_images</span><span class="p">,</span> <span class="s">&quot;PIL not installed&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_image_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>ImageField and FileField are nearly identical, but they differ slighty when
it comes to validation. This specifically tests that #6302 is fixed for
both file fields and image fields.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;test.png&quot;</span><span class="p">),</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">image_data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&quot;test2.png&quot;</span><span class="p">),</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">image_data2</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;An image&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test.png&#39;</span><span class="p">,</span> <span class="n">image_data</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]),</span> <span class="n">SimpleUploadedFile</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>Delete the current file since this is not done by Django, but don't save
because the dimension fields are not null=True.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;An image&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test.png&#39;</span><span class="p">,</span> <span class="n">image_data</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]),</span> <span class="n">SimpleUploadedFile</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>Edit an instance that already has the (required) image defined in the model. This will not
save the image again, but leave it exactly as it is.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Look, it changed&#39;</span><span class="p">},</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;image&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test.png&#39;</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>Delete the current file since this is not done by Django, but don't save
because the dimension fields are not null=True.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>Override the file by uploading a new one.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Changed it&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test2.png&#39;</span><span class="p">,</span> <span class="n">image_data2</span><span class="p">)},</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test2.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>Delete the current file since this is not done by Django, but don't save
because the dimension fields are not null=True.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Changed it&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test2.png&#39;</span><span class="p">,</span> <span class="n">image_data2</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test2.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>Delete the current file since this is not done by Django, but don't save
because the dimension fields are not null=True.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>Test the non-required ImageField
Note: In Oracle, we expect a null ImageField to return '' instead of
None.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">interprets_empty_strings_as_nulls</span><span class="p">:</span>
            <span class="n">expected_null_imagefield_repr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_null_imagefield_repr</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">OptionalImageFileForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;Test&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">expected_null_imagefield_repr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">OptionalImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;And a final one&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test3.png&#39;</span><span class="p">,</span> <span class="n">image_data</span><span class="p">)},</span> <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test3.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>Editing the instance without re-uploading the image should not affect the image or its width/height properties</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">OptionalImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;New Description&#39;</span><span class="p">},</span>
                <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="s">&#39;New Description&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test3.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>Delete the current file since this is not done by Django.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">OptionalImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;And a final one&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test4.png&#39;</span><span class="p">,</span> <span class="n">image_data2</span><span class="p">)}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tests/test4.png&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>Test callable upload_to behavior that's dependent on the value of another field in the model</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ImageFileForm</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="s">&#39;And a final one&#39;</span><span class="p">,</span> <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;foo&#39;</span><span class="p">},</span>
                <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;image&#39;</span><span class="p">:</span> <span class="n">SimpleUploadedFile</span><span class="p">(</span><span class="s">&#39;test4.png&#39;</span><span class="p">,</span> <span class="n">image_data</span><span class="p">)})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;foo/test4.png&#39;</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_media_on_modelform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>Similar to a regular Form class you can define custom media to be used on
the ModelForm.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ModelFormWithMedia</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">media</span><span class="p">),</span> <span class="s">&#39;&#39;&#39;&lt;link href=&quot;/some/form/css&quot; type=&quot;text/css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; /&gt;</span>
<span class="s">&lt;script type=&quot;text/javascript&quot; src=&quot;/some/form/javascript&quot;&gt;&lt;/script&gt;&#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1,2,3&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1,2,3&#39;</span><span class="p">})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1a,2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Enter only digits separated by commas.&#39;</span><span class="p">]})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;,,,,&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;,,,,&#39;</span><span class="p">})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1.2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Enter only digits separated by commas.&#39;</span><span class="p">]})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1,a,2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Enter only digits separated by commas.&#39;</span><span class="p">]})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1,,2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1,,2&#39;</span><span class="p">})</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">CommaSeparatedIntegerForm</span><span class="p">({</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;field&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">})</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>This Price instance generated by this form is not valid because the quantity
field is required, but the form is valid because the field is excluded from
the form. This is for backwards compatibility.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">form</span> <span class="o">=</span> <span class="n">PriceFormWithoutQuantity</span><span class="p">({</span><span class="s">&#39;price&#39;</span><span class="p">:</span> <span class="s">&#39;6.00&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">price</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>The form should not validate fields that it doesn't contain even if they are
specified using 'fields', not 'exclude'.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Price</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;price&#39;</span><span class="p">,)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PriceFormWithoutQuantity</span><span class="p">({</span><span class="s">&#39;price&#39;</span><span class="p">:</span> <span class="s">&#39;6.00&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>The form should still have an instance of a model that is not complete and
not saved into a DB yet.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;6.00&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">quantity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">pk</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>Choices on CharField and IntegerField</p></td><td class="code"><div class="highlight"><pre>        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleForm</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;42&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">ArticleStatusForm</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_foreignkeys_which_use_to_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">apple</span> <span class="o">=</span> <span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">barcode</span><span class="o">=</span><span class="mi">86</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Apple&#39;</span><span class="p">)</span>
        <span class="n">pear</span> <span class="o">=</span> <span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">barcode</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Pear&#39;</span><span class="p">)</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">barcode</span><span class="o">=</span><span class="mi">87</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Core&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">apple</span><span class="p">)</span>

        <span class="n">field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">to_field_name</span><span class="o">=</span><span class="s">&#39;barcode&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">(</span>
            <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;---------&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="s">&#39;Apple&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="s">&#39;Core&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="s">&#39;Pear&#39;</span><span class="p">)))</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">InventoryForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">core</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;parent&#39;</span><span class="p">]),</span> <span class="s">&#39;&#39;&#39;&lt;select name=&quot;parent&quot; id=&quot;id_parent&quot;&gt;</span>
<span class="s">&lt;option value=&quot;&quot;&gt;---------&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;86&quot; selected=&quot;selected&quot;&gt;Apple&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;87&quot;&gt;Core&lt;/option&gt;</span>
<span class="s">&lt;option value=&quot;22&quot;&gt;Pear&lt;/option&gt;</span>
<span class="s">&lt;/select&gt;&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;22&#39;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">InventoryForm</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">core</span><span class="p">)</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;Pear&#39;</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">CategoryForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">CategoryForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                         <span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">,</span> <span class="s">&#39;url&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">CategoryForm</span><span class="p">()),</span> <span class="s">&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_description&quot;&gt;Description:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;description&quot; id=&quot;id_description&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_url&quot;&gt;The URL:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_url&quot; type=&quot;text&quot; name=&quot;url&quot; maxlength=&quot;40&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-64"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-64">&#182;</a></div><p>to<em>field</em>name should also work on ModelMultipleChoiceField ##################</p></td><td class="code"><div class="highlight"><pre>        <span class="n">field</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelMultipleChoiceField</span><span class="p">(</span><span class="n">Inventory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">to_field_name</span><span class="o">=</span><span class="s">&#39;barcode&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">choices</span><span class="p">),</span> <span class="p">((</span><span class="mi">86</span><span class="p">,</span> <span class="s">&#39;Apple&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="s">&#39;Core&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="s">&#39;Pear&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">clean</span><span class="p">([</span><span class="mi">86</span><span class="p">])),</span> <span class="p">[</span><span class="s">&#39;Apple&#39;</span><span class="p">])</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">SelectInventoryForm</span><span class="p">({</span><span class="s">&#39;items&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">87</span><span class="p">,</span> <span class="mi">22</span><span class="p">]})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s">&#39;Core&#39;</span><span class="p">,</span> <span class="s">&#39;Pear&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">test_model_field_that_returns_none_to_exclude_itself_with_explicit_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">CustomFieldForExclusionForm</span><span class="o">.</span><span class="n">base_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">CustomFieldForExclusionForm</span><span class="p">()),</span>
                         <span class="sd">&#39;&#39;&#39;&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_name&quot;&gt;Name:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input id=&quot;id_name&quot; type=&quot;text&quot; name=&quot;name&quot; maxlength=&quot;10&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;&#39;&#39;&#39;</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
