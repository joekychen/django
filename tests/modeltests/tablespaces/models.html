<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › tablespaces › models.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>models.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Since the test database doesn't have tablespaces, it's impossible for Django
to create the tables for models where db<em>tablespace is set. To avoid this
problem, we mark the models as unmanaged, and temporarily revert them to
managed during each test. We also set them to use the same tables as the
"reference" models to avoid errors when other tests run 'syncdb'
(proxy</em>models_inheritance does).</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ScientistRef</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ArticleRef</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">ScientistRef</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;articles_written_set&#39;</span><span class="p">)</span>
    <span class="n">reviewers</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">ScientistRef</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;articles_reviewed_set&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Scientist</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;tablespaces_scientistref&#39;</span>
        <span class="n">db_tablespace</span> <span class="o">=</span> <span class="s">&#39;tbl_tbsp&#39;</span>
        <span class="n">managed</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">db_tablespace</span><span class="o">=</span><span class="s">&#39;idx_tbsp&#39;</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Scientist</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;articles_written_set&#39;</span><span class="p">)</span>
    <span class="n">reviewers</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Scientist</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;articles_reviewed_set&#39;</span><span class="p">,</span> <span class="n">db_tablespace</span><span class="o">=</span><span class="s">&#39;idx_tbsp&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;tablespaces_articleref&#39;</span>
        <span class="n">db_tablespace</span> <span class="o">=</span> <span class="s">&#39;tbl_tbsp&#39;</span>
        <span class="n">managed</span> <span class="o">=</span> <span class="bp">False</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Also set the tables for automatically created models</p></td><td class="code"><div class="highlight"><pre><span class="n">Authors</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s">&#39;authors&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rel</span><span class="o">.</span><span class="n">through</span>
<span class="n">Authors</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;tablespaces_articleref_authors&#39;</span>

<span class="n">Reviewers</span> <span class="o">=</span> <span class="n">Article</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="s">&#39;reviewers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rel</span><span class="o">.</span><span class="n">through</span>
<span class="n">Reviewers</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;tablespaces_articleref_reviewers&#39;</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
