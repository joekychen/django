<!DOCTYPE html>
<html><head><title>joekychen/django » tests › modeltests › model_inheritance › tests.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tests.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">attrgetter</span>

<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">FieldError</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Chef</span><span class="p">,</span> <span class="n">CommonInfo</span><span class="p">,</span> <span class="n">ItalianRestaurant</span><span class="p">,</span> <span class="n">ParkingLot</span><span class="p">,</span> <span class="n">Place</span><span class="p">,</span>
    <span class="n">Post</span><span class="p">,</span> <span class="n">Restaurant</span><span class="p">,</span> <span class="n">Student</span><span class="p">,</span> <span class="n">StudentWorker</span><span class="p">,</span> <span class="n">Supplier</span><span class="p">,</span> <span class="n">Worker</span><span class="p">,</span> <span class="n">MixinModel</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ModelInheritanceTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_abstract</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>The Student and Worker models both have 'name' and 'age' fields on
them and inherit the <strong>unicode</strong>() method, just as with normal Python
subclassing. This is useful if you want to factor out common
information for programming purposes, but still completely
independent separate models at the database level.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">w1</span> <span class="o">=</span> <span class="n">Worker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Fred&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">job</span><span class="o">=</span><span class="s">&quot;Quarry worker&quot;</span><span class="p">)</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="n">Worker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Barney&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">34</span><span class="p">,</span> <span class="n">job</span><span class="o">=</span><span class="s">&quot;Quarry worker&quot;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Pebbles&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">school_class</span><span class="o">=</span><span class="s">&quot;1B&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">w1</span><span class="p">),</span> <span class="s">&quot;Worker Fred&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s">&quot;Student Pebbles&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>The children inherit the Meta class of their parents (if they don't
specify their own).</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">Worker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Barney&quot;</span><span class="p">},</span>
                <span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Fred&quot;</span><span class="p">},</span>
            <span class="p">],</span>
            <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Since Student does not subclass CommonInfo's Meta, it has the effect
of completely overriding it. So ordering by name doesn't take place
for Students.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Student</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ordering</span><span class="p">,</span> <span class="p">[])</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>However, the CommonInfo class cannot be used as a normal model (it
doesn't exist as a model).</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">CommonInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>A StudentWorker which does not exist is both a Student and Worker
which does not exist.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Student</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span>
            <span class="n">StudentWorker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="mi">12321321</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Worker</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span>
            <span class="n">StudentWorker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="mi">12321321</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>MultipleObjectsReturned is also inherited.
This is written out "long form", rather than using <strong>init</strong>/create()
because of a bug with diamond inheritance (#10808)</p></td><td class="code"><div class="highlight"><pre>        <span class="n">sw1</span> <span class="o">=</span> <span class="n">StudentWorker</span><span class="p">()</span>
        <span class="n">sw1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Wilma&quot;</span>
        <span class="n">sw1</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">35</span>
        <span class="n">sw1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">sw2</span> <span class="o">=</span> <span class="n">StudentWorker</span><span class="p">()</span>
        <span class="n">sw2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Betty&quot;</span>
        <span class="n">sw2</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="n">sw2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Student</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">,</span>
            <span class="n">StudentWorker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">pk__lt</span><span class="o">=</span><span class="n">sw2</span><span class="o">.</span><span class="n">pk</span> <span class="o">+</span> <span class="mi">100</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Worker</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">,</span>
            <span class="n">StudentWorker</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">pk__lt</span><span class="o">=</span><span class="n">sw2</span><span class="o">.</span><span class="n">pk</span> <span class="o">+</span> <span class="mi">100</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_multiple_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Lorem Ipsum&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>The Post model has distinct accessors for the Comment and Link models.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">post</span><span class="o">.</span><span class="n">attached_comment_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="s">&quot;Save $ on V1agr@&quot;</span><span class="p">,</span> <span class="n">is_spam</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">post</span><span class="o">.</span><span class="n">attached_link_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="s">&quot;The Web framework for perfections with deadlines.&quot;</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="s">&quot;http://www.djangoproject.com/&quot;</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>The Post model doesn't have an attribute called
'attached<em>%(class)s</em>set'.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="s">&quot;attached_</span><span class="si">%(class)s</span><span class="s">_set&quot;</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>The Place/Restaurant/ItalianRestaurant models all exist as
independent models. However, the subclasses also have transparent
access to the fields of their ancestors.
Create a couple of Places.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">p1</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Master Shakes&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;666 W. Jersey&quot;</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ace Harware&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;1013 N. Ashland&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Test constructor for Restaurant.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">r</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Demon Dogs&quot;</span><span class="p">,</span>
            <span class="n">address</span><span class="o">=</span><span class="s">&quot;944 W. Fullerton&quot;</span><span class="p">,</span>
            <span class="n">serves_hot_dogs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">serves_pizza</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">rating</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>Test the constructor for ItalianRestaurant.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">c</span> <span class="o">=</span> <span class="n">Chef</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Albert&quot;</span><span class="p">)</span>
        <span class="n">ir</span> <span class="o">=</span> <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="n">address</span><span class="o">=</span><span class="s">&quot;1234 W. Ash&quot;</span><span class="p">,</span>
            <span class="n">serves_hot_dogs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">serves_pizza</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">serves_gnocchi</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">rating</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">chef</span><span class="o">=</span><span class="n">c</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s">&quot;1234 W. Ash&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ir</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s">&quot;1234 W. Elm&quot;</span>
        <span class="n">ir</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s">&quot;1234 W. Elm&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Make sure Restaurant and ItalianRestaurant have the right fields in
the right order.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;address&quot;</span><span class="p">,</span> <span class="s">&quot;place_ptr&quot;</span><span class="p">,</span> <span class="s">&quot;rating&quot;</span><span class="p">,</span> <span class="s">&quot;serves_hot_dogs&quot;</span><span class="p">,</span> <span class="s">&quot;serves_pizza&quot;</span><span class="p">,</span> <span class="s">&quot;chef&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;address&quot;</span><span class="p">,</span> <span class="s">&quot;place_ptr&quot;</span><span class="p">,</span> <span class="s">&quot;rating&quot;</span><span class="p">,</span> <span class="s">&quot;serves_hot_dogs&quot;</span><span class="p">,</span> <span class="s">&quot;serves_pizza&quot;</span><span class="p">,</span> <span class="s">&quot;chef&quot;</span><span class="p">,</span> <span class="s">&quot;restaurant_ptr&quot;</span><span class="p">,</span> <span class="s">&quot;serves_gnocchi&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">ordering</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;-rating&quot;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>Even though p.supplier for a Place 'p' (a parent of a Supplier), a
Restaurant object cannot access that reverse relation, since it's not
part of the Place-Supplier Hierarchy.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">supplier__name</span><span class="o">=</span><span class="s">&quot;foo&quot;</span><span class="p">),</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">FieldError</span><span class="p">,</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="n">supplier__name</span><span class="o">=</span><span class="s">&quot;foo&quot;</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Parent fields can be used directly in filters on the child model.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Demon Dogs&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Demon Dogs&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="s">&quot;1234 W. Elm&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>Filters against the parent model return objects of the parent's type.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">p</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Demon Dogs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">Place</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Since the parent and child are linked by an automatically created
OneToOneField, you can get from the parent to the child by using the
child's name.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">restaurant</span><span class="p">,</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Demon Dogs&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">italianrestaurant</span><span class="p">,</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">italianrestaurant</span><span class="p">,</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">)</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>This won't work because the Demon Dogs restaurant is not an Italian
restaurant.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">restaurant</span><span class="o">.</span><span class="n">italianrestaurant</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>An ItalianRestaurant which does not exist is also a Place which does
not exist.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Place</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;The Noodle Void&quot;</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>MultipleObjectsReturned is also inherited.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Place</span><span class="o">.</span><span class="n">MultipleObjectsReturned</span><span class="p">,</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">id__lt</span><span class="o">=</span><span class="mi">12321</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>Related objects work just as they normally do.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">s1</span> <span class="o">=</span> <span class="n">Supplier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Joe&#39;s Chickens&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;123 Sesame St&quot;</span><span class="p">)</span>
        <span class="n">s1</span><span class="o">.</span><span class="n">customers</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">ir</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">Supplier</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Luigi&#39;s Pasta&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;456 Sesame St&quot;</span><span class="p">)</span>
        <span class="n">s2</span><span class="o">.</span><span class="n">customers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ir</span><span class="p">]</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>This won't work because the Place we select is not a Restaurant (it's
a Supplier).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">p</span> <span class="o">=</span> <span class="n">Place</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Joe&#39;s Chickens&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">Restaurant</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">restaurant</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">supplier</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ir</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&quot;-name&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Luigi&#39;s Pasta&quot;</span><span class="p">,</span>
                <span class="s">&quot;Joe&#39;s Chickens&quot;</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">provider__name__contains</span><span class="o">=</span><span class="s">&quot;Chickens&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
                <span class="s">&quot;Demon Dogs&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">provider__name__contains</span><span class="o">=</span><span class="s">&quot;Chickens&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">attrgetter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">park1</span> <span class="o">=</span> <span class="n">ParkingLot</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Main St&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;111 Main St&quot;</span><span class="p">,</span> <span class="n">main_site</span><span class="o">=</span><span class="n">s1</span>
        <span class="p">)</span>
        <span class="n">park2</span> <span class="o">=</span> <span class="n">ParkingLot</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Well Lit&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="s">&quot;124 Sesame St&quot;</span><span class="p">,</span> <span class="n">main_site</span><span class="o">=</span><span class="n">ir</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lot__name</span><span class="o">=</span><span class="s">&quot;Well Lit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s">&quot;Ristorante Miron&quot;</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>The update() command can update fields in parent and child classes at
once (although it executed multiple SQL queries to do so).</p></td><td class="code"><div class="highlight"><pre>        <span class="n">rows</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">serves_hot_dogs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name__contains</span><span class="o">=</span><span class="s">&quot;D&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Demon Puppies&quot;</span><span class="p">,</span> <span class="n">serves_hot_dogs</span><span class="o">=</span><span class="bp">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">Restaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">serves_hot_dogs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Demon Puppies&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>The values() command also works on fields from parent models.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span>
            <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;rating&quot;</span><span class="p">),</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">&quot;rating&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Ristorante Miron&quot;</span><span class="p">}</span>
            <span class="p">],</span>
            <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span>
        <span class="p">)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>select_related works with fields from the parent object as if they
were a normal part of the model.</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">chef</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s">&quot;chef&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">chef</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_mixin_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">MixinModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">other_attr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_update_query_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that update queries do not generate non-necessary queries.</span>
<span class="sd">        Refs #18304.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Chef</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Albert&quot;</span><span class="p">)</span>
        <span class="n">ir</span> <span class="o">=</span> <span class="n">ItalianRestaurant</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Ristorante Miron&quot;</span><span class="p">,</span>
            <span class="n">address</span><span class="o">=</span><span class="s">&quot;1234 W. Ash&quot;</span><span class="p">,</span>
            <span class="n">serves_hot_dogs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">serves_pizza</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">serves_gnocchi</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">rating</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">chef</span><span class="o">=</span><span class="n">c</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNumQueries</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">ir</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
