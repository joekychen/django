<!DOCTYPE html>
<html><head><title>joekychen/django » django › db › backends › mysql › base.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>base.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MySQL database backend for Django.</span>

<span class="sd">Requires MySQLdb: http://sourceforge.net/projects/mysql-python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">MySQLdb</span> <span class="kn">as</span> <span class="nn">Database</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ImproperlyConfigured</span>
    <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="s">&quot;Error loading MySQLdb module: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">cached_property</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>We want version (1, 2, 1, 'final', 2) or later. We can't just use
lexicographic ordering in this check because then (1, 2, 1, 'gamma')
inadvertently passes the version test.</p></td><td class="code"><div class="highlight"><pre><span class="n">version</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">version_info</span>
<span class="k">if</span> <span class="p">(</span><span class="n">version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">version</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;final&#39;</span> <span class="ow">or</span> <span class="n">version</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">))):</span>
    <span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ImproperlyConfigured</span>
    <span class="k">raise</span> <span class="n">ImproperlyConfigured</span><span class="p">(</span><span class="s">&quot;MySQLdb-1.2.1p2 or newer is required; you have </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">Database</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">MySQLdb.converters</span> <span class="kn">import</span> <span class="n">conversions</span><span class="p">,</span> <span class="n">Thing2Literal</span>
<span class="kn">from</span> <span class="nn">MySQLdb.constants</span> <span class="kn">import</span> <span class="n">FIELD_TYPE</span><span class="p">,</span> <span class="n">CLIENT</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">django.db.backends</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.db.backends.signals</span> <span class="kn">import</span> <span class="n">connection_created</span>
<span class="kn">from</span> <span class="nn">django.db.backends.mysql.client</span> <span class="kn">import</span> <span class="n">DatabaseClient</span>
<span class="kn">from</span> <span class="nn">django.db.backends.mysql.creation</span> <span class="kn">import</span> <span class="n">DatabaseCreation</span>
<span class="kn">from</span> <span class="nn">django.db.backends.mysql.introspection</span> <span class="kn">import</span> <span class="n">DatabaseIntrospection</span>
<span class="kn">from</span> <span class="nn">django.db.backends.mysql.validation</span> <span class="kn">import</span> <span class="n">DatabaseValidation</span>
<span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="kn">import</span> <span class="n">cached_property</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="kn">import</span> <span class="n">SafeString</span><span class="p">,</span> <span class="n">SafeUnicode</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Raise exceptions for database warnings if DEBUG is on</p></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">Database</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>

<span class="n">DatabaseError</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">DatabaseError</span>
<span class="n">IntegrityError</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">IntegrityError</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>It's impossible to import datetime<em>or</em>None directly from MySQLdb.times</p></td><td class="code"><div class="highlight"><pre><span class="n">parse_datetime</span> <span class="o">=</span> <span class="n">conversions</span><span class="p">[</span><span class="n">FIELD_TYPE</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">parse_datetime_with_timezone_support</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">parse_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Confirm that dt is naive before overwriting its tzinfo.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_TZ</span> <span class="ow">and</span> <span class="n">timezone</span><span class="o">.</span><span class="n">is_naive</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dt</span>

<span class="k">def</span> <span class="nf">adapt_datetime_with_timezone_support</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">conv</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Equivalent to DateTimeField.get<em>db</em>prep_value. Used only by raw SQL.</p></td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_TZ</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">timezone</span><span class="o">.</span><span class="n">is_naive</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;SQLite received a naive datetime (</span><span class="si">%s</span><span class="s">)&quot;</span>
                          <span class="s">&quot; while time zone support is active.&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">,</span>
                          <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="n">default_timezone</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">get_default_timezone</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">make_aware</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default_timezone</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Thing2Literal</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">),</span> <span class="n">conv</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>MySQLdb-1.2.1 returns TIME columns as timedelta -- they are more like
timedelta in terms of actual behavior as they are signed and include days --
and Django expects time, so we still need to override that. We also need to
add special handling for SafeUnicode and SafeString as MySQLdb's type
checking is too tight to catch those (see Django ticket #6052).
Finally, MySQLdb always returns naive datetime objects. However, when
timezone support is active, Django expects timezone-aware datetime objects.</p></td><td class="code"><div class="highlight"><pre><span class="n">django_conversions</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">django_conversions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="n">FIELD_TYPE</span><span class="o">.</span><span class="n">TIME</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">typecast_time</span><span class="p">,</span>
    <span class="n">FIELD_TYPE</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">typecast_decimal</span><span class="p">,</span>
    <span class="n">FIELD_TYPE</span><span class="o">.</span><span class="n">NEWDECIMAL</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">typecast_decimal</span><span class="p">,</span>
    <span class="n">FIELD_TYPE</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span> <span class="n">parse_datetime_with_timezone_support</span><span class="p">,</span>
    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span> <span class="n">adapt_datetime_with_timezone_support</span><span class="p">,</span>
<span class="p">})</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>This should match the numerical portion of the version numbers (we can treat
versions like 5.0.24 and 5.0.24a as the same). Based on the list of version
at http://dev.mysql.com/doc/refman/4.1/en/news.html and
http://dev.mysql.com/doc/refman/5.0/en/news.html .</p></td><td class="code"><div class="highlight"><pre><span class="n">server_version_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\d{1,2})\.(\d{1,2})\.(\d{1,2})&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>MySQLdb-1.2.1 and newer automatically makes use of SHOW WARNINGS on
MySQL-4.1 and newer, so the MysqlDebugWrapper is unnecessary. Since the
point is to raise Warnings as exceptions, this can be done with the Python
warning module, and this is setup when the connection is created, and the
standard util.CursorDebugWrapper can be used. Also, using sql_mode
TRADITIONAL will automatically cause most warnings to be treated as errors.</p></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CursorWrapper</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A thin wrapper around MySQLdb&#39;s normal cursor class so that we can catch</span>
<span class="sd">    particular exception instances and reraise them with the right types.</span>

<span class="sd">    Implemented as a wrapper, rather than a subclass, so that we aren&#39;t stuck</span>
<span class="sd">    to the particular underlying representation returned by Connection.cursor().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">codes_for_integrityerror</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1048</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">cursor</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Map some error codes to IntegrityError, since they seem to be
misclassified and Django would prefer the more logical place.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_for_integrityerror</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">executemany</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">IntegrityError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Map some error codes to IntegrityError, since they seem to be
misclassified and Django would prefer the more logical place.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes_for_integrityerror</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DatabaseFeatures</span><span class="p">(</span><span class="n">BaseDatabaseFeatures</span><span class="p">):</span>
    <span class="n">empty_fetchmany_value</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">update_can_self_select</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">allows_group_by_pk</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">related_fields_match_type</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">allow_sliced_subqueries</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">has_bulk_insert</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">has_select_for_update</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">has_select_for_update_nowait</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_forward_references</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_long_model_names</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_microsecond_precision</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_regex_backreferencing</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_date_lookup_using_string</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">supports_timezones</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">requires_explicit_null_ordering_when_grouping</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">allows_primary_key_0</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">uses_savepoints</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DatabaseFeatures</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_mysql_storage_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Internal method used in Django tests. Don&#39;t rely on this from your code&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;CREATE TABLE INTROSPECT_TEST (X INT)&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>This command is MySQL specific; the second column
will tell you the default table type of the created
table. Since all Django's test tables will have the same
table type, that's enough to evaluate the feature.</p></td><td class="code"><div class="highlight"><pre>        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SHOW TABLE STATUS WHERE Name=&#39;INTROSPECT_TEST&#39;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;DROP TABLE INTROSPECT_TEST&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">can_introspect_foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Confirm support for introspected foreign keys&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mysql_storage_engine</span> <span class="o">!=</span> <span class="s">&#39;MyISAM&#39;</span>

<span class="k">class</span> <span class="nc">DatabaseOperations</span><span class="p">(</span><span class="n">BaseDatabaseOperations</span><span class="p">):</span>
    <span class="n">compiler_module</span> <span class="o">=</span> <span class="s">&quot;django.db.backends.mysql.compiler&quot;</span>

    <span class="k">def</span> <span class="nf">date_extract_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>http://dev.mysql.com/doc/mysql/en/date-and-time-functions.html</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">lookup_type</span> <span class="o">==</span> <span class="s">&#39;week_day&#39;</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>DAYOFWEEK() returns an integer, 1-7, Sunday=1.
Note: WEEKDAY() returns 0-6, Monday=0.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">return</span> <span class="s">&quot;DAYOFWEEK(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">field_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;EXTRACT(</span><span class="si">%s</span><span class="s"> FROM </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lookup_type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">field_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">date_trunc_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lookup_type</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="s">&#39;month&#39;</span><span class="p">,</span> <span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="s">&#39;hour&#39;</span><span class="p">,</span> <span class="s">&#39;minute&#39;</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">]</span>
        <span class="n">format</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%%</span><span class="s">Y-&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">m&#39;</span><span class="p">,</span> <span class="s">&#39;-</span><span class="si">%%</span><span class="s">d&#39;</span><span class="p">,</span> <span class="s">&#39; </span><span class="si">%%</span><span class="s">H:&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">i&#39;</span><span class="p">,</span> <span class="s">&#39;:</span><span class="si">%%</span><span class="s">s&#39;</span><span class="p">)</span> <span class="c"># Use double percents to escape.</span>
        <span class="n">format_def</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;0000-&#39;</span><span class="p">,</span> <span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;-01&#39;</span><span class="p">,</span> <span class="s">&#39; 00:&#39;</span><span class="p">,</span> <span class="s">&#39;00&#39;</span><span class="p">,</span> <span class="s">&#39;:00&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">lookup_type</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">field_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">format</span><span class="p">[:</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">format_def</span><span class="p">[</span><span class="n">i</span><span class="p">:]])</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;CAST(DATE_FORMAT(</span><span class="si">%s</span><span class="s">, &#39;</span><span class="si">%s</span><span class="s">&#39;) AS DATETIME)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">format_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sql</span>

    <span class="k">def</span> <span class="nf">date_interval_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> INTERVAL &#39;</span><span class="si">%d</span><span class="s"> 0:0:</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&#39; DAY_MICROSECOND)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">connector</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="n">timedelta</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="n">timedelta</span><span class="o">.</span><span class="n">microseconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drop_foreignkey_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;DROP FOREIGN KEY&quot;</span>

    <span class="k">def</span> <span class="nf">force_no_ordering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;ORDER BY NULL&quot; prevents MySQL from implicitly ordering by grouped</span>
<span class="sd">        columns. If no ordering would otherwise be applied, we don&#39;t want any</span>
<span class="sd">        implicit sorting going on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&quot;NULL&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">fulltext_search_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;MATCH (</span><span class="si">%s</span><span class="s">) AGAINST (</span><span class="si">%%</span><span class="s">s IN BOOLEAN MODE)&#39;</span> <span class="o">%</span> <span class="n">field_name</span>

    <span class="k">def</span> <span class="nf">last_executed_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>With MySQLdb, cursor objects have an (undocumented) "<em>last</em>executed"
attribute where the exact query sent to the database is saved.
See MySQLdb/cursors.py in the source distribution.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">return</span> <span class="n">cursor</span><span class="o">.</span><span class="n">_last_executed</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">no_limit_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>2**64 - 1, as recommended by the MySQL documentation</p></td><td class="code"><div class="highlight"><pre>        <span class="k">return</span> <span class="il">18446744073709551615L</span>

    <span class="k">def</span> <span class="nf">quote_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span> <span class="c"># Quoting once is enough.</span>
        <span class="k">return</span> <span class="s">&quot;`</span><span class="si">%s</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">random_function_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;RAND()&#39;</span>

    <span class="k">def</span> <span class="nf">sql_flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">sequences</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>NB: The generated SQL below is specific to MySQL
'TRUNCATE x;', 'TRUNCATE y;', 'TRUNCATE z;'... style SQL statements
to clear all tables of all data</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">tables</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SET FOREIGN_KEY_CHECKS = 0;&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">SQL_KEYWORD</span><span class="p">(</span><span class="s">&#39;TRUNCATE&#39;</span><span class="p">),</span> <span class="n">style</span><span class="o">.</span><span class="n">SQL_FIELD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quote_name</span><span class="p">(</span><span class="n">table</span><span class="p">))))</span>
            <span class="n">sql</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;SET FOREIGN_KEY_CHECKS = 1;&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>Truncate already resets the AUTO_INCREMENT field from
MySQL version 5.0.13 onwards. Refs #16961.</p></td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">mysql_version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
                <span class="n">sql</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">;&quot;</span> <span class="o">%</span> \
                     <span class="p">(</span><span class="n">style</span><span class="o">.</span><span class="n">SQL_KEYWORD</span><span class="p">(</span><span class="s">&#39;ALTER&#39;</span><span class="p">),</span>
                      <span class="n">style</span><span class="o">.</span><span class="n">SQL_KEYWORD</span><span class="p">(</span><span class="s">&#39;TABLE&#39;</span><span class="p">),</span>
                      <span class="n">style</span><span class="o">.</span><span class="n">SQL_TABLE</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quote_name</span><span class="p">(</span><span class="n">sequence</span><span class="p">[</span><span class="s">&#39;table&#39;</span><span class="p">])),</span>
                      <span class="n">style</span><span class="o">.</span><span class="n">SQL_KEYWORD</span><span class="p">(</span><span class="s">&#39;AUTO_INCREMENT&#39;</span><span class="p">),</span>
                      <span class="n">style</span><span class="o">.</span><span class="n">SQL_FIELD</span><span class="p">(</span><span class="s">&#39;= 1&#39;</span><span class="p">),</span>
                     <span class="p">)</span> <span class="k">for</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="n">sequences</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">sql</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">validate_autopk_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>MySQLism: zero in AUTO_INCREMENT field does not work. Refs #17653.</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The database backend does not accept 0 as a &#39;</span>
                             <span class="s">&#39;value for AutoField.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">value_to_db_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>MySQL doesn't support tz-aware datetimes</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">timezone</span><span class="o">.</span><span class="n">is_aware</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">USE_TZ</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;MySQL backend does not support timezone-aware datetimes when USE_TZ is False.&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>MySQL doesn't support microseconds</p></td><td class="code"><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">value_to_db_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>MySQL doesn't support tz-aware times</p></td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="n">timezone</span><span class="o">.</span><span class="n">is_aware</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;MySQL backend does not support timezone-aware times.&quot;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>MySQL doesn't support microseconds</p></td><td class="code"><div class="highlight"><pre>        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">year_lookup_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Again, no microseconds</p></td><td class="code"><div class="highlight"><pre>        <span class="n">first</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-01-01 00:00:00&#39;</span>
        <span class="n">second</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-12-31 23:59:59.99&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">first</span> <span class="o">%</span> <span class="n">value</span><span class="p">,</span> <span class="n">second</span> <span class="o">%</span> <span class="n">value</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">max_name_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">64</span>

    <span class="k">def</span> <span class="nf">bulk_insert_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">num_values</span><span class="p">):</span>
        <span class="n">items_sql</span> <span class="o">=</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&quot;VALUES &quot;</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">items_sql</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">savepoint_create_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;SAVEPOINT </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sid</span>

    <span class="k">def</span> <span class="nf">savepoint_commit_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;RELEASE SAVEPOINT </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sid</span>

    <span class="k">def</span> <span class="nf">savepoint_rollback_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;ROLLBACK TO SAVEPOINT </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sid</span>

<span class="k">class</span> <span class="nc">DatabaseWrapper</span><span class="p">(</span><span class="n">BaseDatabaseWrapper</span><span class="p">):</span>
    <span class="n">vendor</span> <span class="o">=</span> <span class="s">&#39;mysql&#39;</span>
    <span class="n">operators</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;exact&#39;</span><span class="p">:</span> <span class="s">&#39;= </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;iexact&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;contains&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE BINARY </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;icontains&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;regex&#39;</span><span class="p">:</span> <span class="s">&#39;REGEXP BINARY </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;iregex&#39;</span><span class="p">:</span> <span class="s">&#39;REGEXP </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;gt&#39;</span><span class="p">:</span> <span class="s">&#39;&gt; </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;gte&#39;</span><span class="p">:</span> <span class="s">&#39;&gt;= </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;lt&#39;</span><span class="p">:</span> <span class="s">&#39;&lt; </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;lte&#39;</span><span class="p">:</span> <span class="s">&#39;&lt;= </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;startswith&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE BINARY </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;endswith&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE BINARY </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;istartswith&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;iendswith&#39;</span><span class="p">:</span> <span class="s">&#39;LIKE </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DatabaseWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">DatabaseFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">DatabaseOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">DatabaseClient</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation</span> <span class="o">=</span> <span class="n">DatabaseCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">introspection</span> <span class="o">=</span> <span class="n">DatabaseIntrospection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">DatabaseValidation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_valid_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="n">DatabaseError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_connection</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_connection</span><span class="p">():</span>
            <span class="n">new_connection</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;conv&#39;</span><span class="p">:</span> <span class="n">django_conversions</span><span class="p">,</span>
                <span class="s">&#39;charset&#39;</span><span class="p">:</span> <span class="s">&#39;utf8&#39;</span><span class="p">,</span>
                <span class="s">&#39;use_unicode&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">settings_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings_dict</span>
            <span class="k">if</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;USER&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;USER&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;NAME&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;NAME&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;PASSWORD&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;passwd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;PASSWORD&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;HOST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;unix_socket&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;HOST&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;HOST&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;HOST&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;PORT&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;PORT&#39;</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>We need the number of potentially affected rows after an
"UPDATE", not the number of changed rows.</p></td><td class="code"><div class="highlight"><pre>            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;client_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CLIENT</span><span class="o">.</span><span class="n">FOUND_ROWS</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">[</span><span class="s">&#39;OPTIONS&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">encoders</span><span class="p">[</span><span class="n">SafeUnicode</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">encoders</span><span class="p">[</span><span class="nb">unicode</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">encoders</span><span class="p">[</span><span class="n">SafeString</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">encoders</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
            <span class="n">connection_created</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">new_connection</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>SQL<em>AUTO</em>IS<em>NULL in MySQL controls whether an AUTO</em>INCREMENT column
on a recently-inserted row will return when the field is tested for
NULL.  Disabling this value brings this aspect of MySQL in line with
SQL standards.</p></td><td class="code"><div class="highlight"><pre>            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SET SQL_AUTO_IS_NULL = 0&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">CursorWrapper</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">BaseDatabaseWrapper</span><span class="o">.</span><span class="n">_rollback</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Database</span><span class="o">.</span><span class="n">NotSupportedError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">mysql_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">:</span>
            <span class="n">new_connection</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_connection</span><span class="p">():</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Ensure we have a connection with the DB by using a temporary
cursor</p></td><td class="code"><div class="highlight"><pre>                <span class="n">new_connection</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">server_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_connection</span><span class="p">:</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Make sure we close the connection</p></td><td class="code"><div class="highlight"><pre>                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">server_version_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">server_info</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unable to determine MySQL version from version string </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">server_info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span>

    <span class="k">def</span> <span class="nf">disable_constraint_checking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disables foreign key checks, primarily for use in adding rows with forward references. Always returns True,</span>
<span class="sd">        to indicate constraint checks need to be re-enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SET foreign_key_checks=0&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">enable_constraint_checking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-enable foreign key checks after they have been disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;SET foreign_key_checks=1&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each table name in `table_names` for rows with invalid foreign key references. This method is</span>
<span class="sd">        intended to be used in conjunction with `disable_constraint_checking()` and `enable_constraint_checking()`, to</span>
<span class="sd">        determine if rows with invalid references were entered while constraint checks were off.</span>

<span class="sd">        Raises an IntegrityError on the first invalid foreign key reference encountered (if any) and provides</span>
<span class="sd">        detailed information about the invalid reference in the error message.</span>

<span class="sd">        Backends can override this method if they can more directly apply constraint checking (e.g. via &quot;SET CONSTRAINTS</span>
<span class="sd">        ALL IMMEDIATE&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">table_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">table_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">introspection</span><span class="o">.</span><span class="n">table_names</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">:</span>
            <span class="n">primary_key_column_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">introspection</span><span class="o">.</span><span class="n">get_primary_key_column</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">primary_key_column_name</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">key_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">introspection</span><span class="o">.</span><span class="n">get_key_columns</span><span class="p">(</span><span class="n">cursor</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">referenced_table_name</span><span class="p">,</span> <span class="n">referenced_column_name</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                    SELECT REFERRING.`</span><span class="si">%s</span><span class="s">`, REFERRING.`</span><span class="si">%s</span><span class="s">` FROM `</span><span class="si">%s</span><span class="s">` as REFERRING</span>
<span class="s">                    LEFT JOIN `</span><span class="si">%s</span><span class="s">` as REFERRED</span>
<span class="s">                    ON (REFERRING.`</span><span class="si">%s</span><span class="s">` = REFERRED.`</span><span class="si">%s</span><span class="s">`)</span>
<span class="s">                    WHERE REFERRING.`</span><span class="si">%s</span><span class="s">` IS NOT NULL AND REFERRED.`</span><span class="si">%s</span><span class="s">` IS NULL&quot;&quot;&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">primary_key_column_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">referenced_table_name</span><span class="p">,</span>
                    <span class="n">column_name</span><span class="p">,</span> <span class="n">referenced_column_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">referenced_column_name</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">bad_row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">(</span><span class="s">&quot;The row in table &#39;</span><span class="si">%s</span><span class="s">&#39; with primary key &#39;</span><span class="si">%s</span><span class="s">&#39; has an invalid &quot;</span>
                        <span class="s">&quot;foreign key: </span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> contains a value &#39;</span><span class="si">%s</span><span class="s">&#39; that does not have a corresponding value in </span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">.&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">bad_row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">table_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">bad_row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">referenced_table_name</span><span class="p">,</span> <span class="n">referenced_column_name</span><span class="p">))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
