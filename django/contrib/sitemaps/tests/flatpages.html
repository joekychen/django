<!DOCTYPE html>
<html><head><title>joekychen/django » django › contrib › sitemaps › tests › flatpages.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>flatpages.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.utils.unittest</span> <span class="kn">import</span> <span class="n">skipUnless</span>

<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">SitemapTestsBase</span>

<span class="k">class</span> <span class="nc">FlatpagesSitemapTests</span><span class="p">(</span><span class="n">SitemapTestsBase</span><span class="p">):</span>

    <span class="nd">@skipUnless</span><span class="p">(</span><span class="s">&quot;django.contrib.flatpages&quot;</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">INSTALLED_APPS</span><span class="p">,</span>
                <span class="s">&quot;django.contrib.flatpages app not installed.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_flatpage_sitemap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Basic FlatPage sitemap test&quot;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Import FlatPage inside the test so that when django.contrib.flatpages
is not installed we don't get problems trying to delete Site
objects (FlatPage has an M2M to Site, Site.delete() tries to
delete related objects, but the M2M table doesn't exist.</p></td><td class="code"><div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">django.contrib.flatpages.models</span> <span class="kn">import</span> <span class="n">FlatPage</span>

        <span class="n">public</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s">&#39;/public/&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Public Page&#39;</span><span class="p">,</span>
            <span class="n">enable_comments</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">registration_required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">public</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SITE_ID</span><span class="p">)</span>
        <span class="n">private</span> <span class="o">=</span> <span class="n">FlatPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="s">&#39;/private/&#39;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Private Page&#39;</span><span class="p">,</span>
            <span class="n">enable_comments</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">registration_required</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        <span class="n">private</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SITE_ID</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/flatpages/sitemap.xml&#39;</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Public flatpage should be in the sitemap</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;loc&gt;</span><span class="si">%s%s</span><span class="s">&lt;/loc&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">public</span><span class="o">.</span><span class="n">url</span><span class="p">))</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Private flatpage should not be in the sitemap</p></td><td class="code"><div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">&#39;&lt;loc&gt;</span><span class="si">%s%s</span><span class="s">&lt;/loc&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="n">private</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
