<!DOCTYPE html>
<html><head><title>joekychen/django » django › views › csrf.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>csrf.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseForbidden</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>We include the template inline since we need to be able to reliably display
this error message, especially for the sake of developers, and there isn't any
other way of making it available independent of what is in the settings file.</p></td><td class="code"><div class="highlight"><pre><span class="n">CSRF_FAILURE_TEMPLATE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;!DOCTYPE html&gt;</span>
<span class="s">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span>
<span class="s">  &lt;meta name=&quot;robots&quot; content=&quot;NONE,NOARCHIVE&quot;&gt;</span>
<span class="s">  &lt;title&gt;403 Forbidden&lt;/title&gt;</span>
<span class="s">  &lt;style type=&quot;text/css&quot;&gt;</span>
<span class="s">    html * { padding:0; margin:0; }</span>
<span class="s">    body * { padding:10px 20px; }</span>
<span class="s">    body * * { padding:0; }</span>
<span class="s">    body { font:small sans-serif; background:#eee; }</span>
<span class="s">    body&gt;div { border-bottom:1px solid #ddd; }</span>
<span class="s">    h1 { font-weight:normal; margin-bottom:.4em; }</span>
<span class="s">    h1 span { font-size:60%; color:#666; font-weight:normal; }</span>

<span class="s">#DIVIDER</span>
<span class="s">  &lt;/style&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">&lt;div id=&quot;summary&quot;&gt;</span>
<span class="s">  &lt;h1&gt;Forbidden &lt;span&gt;(403)&lt;/span&gt;&lt;/h1&gt;</span>
<span class="s">  &lt;p&gt;CSRF verification failed. Request aborted.&lt;/p&gt;</span>
<span class="s">{</span><span class="si">% i</span><span class="s">f no_referer %}</span>
<span class="s">  &lt;p&gt;You are seeing this message because this HTTPS site requires a &#39;Referer</span>
<span class="s">   header&#39; to be sent by your Web browser, but none was sent. This header is</span>
<span class="s">   required for security reasons, to ensure that your browser is not being</span>
<span class="s">   hijacked by third parties.&lt;/p&gt;</span>

<span class="s">  &lt;p&gt;If you have configured your browser to disable &#39;Referer&#39; headers, please</span>
<span class="s">   re-enable them, at least for this site, or for HTTPS connections, or for</span>
<span class="s">   &#39;same-origin&#39; requests.&lt;/p&gt;</span>
<span class="s">{</span><span class="si">% e</span><span class="s">ndif %}</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">{</span><span class="si">% i</span><span class="s">f DEBUG %}</span>
<span class="s">&lt;div id=&quot;info&quot;&gt;</span>
<span class="s">  &lt;h2&gt;Help&lt;/h2&gt;</span>
<span class="s">    {</span><span class="si">% i</span><span class="s">f reason %}</span>
<span class="s">    &lt;p&gt;Reason given for failure:&lt;/p&gt;</span>
<span class="s">    &lt;pre&gt;</span>
<span class="s">    {{ reason }}</span>
<span class="s">    &lt;/pre&gt;</span>
<span class="s">    {</span><span class="si">% e</span><span class="s">ndif %}</span>

<span class="s">  &lt;p&gt;In general, this can occur when there is a genuine Cross Site Request Forgery, or when</span>
<span class="s">  &lt;a</span>
<span class="s">  href=&#39;http://docs.djangoproject.com/en/dev/ref/contrib/csrf/#ref-contrib-csrf&#39;&gt;Django&#39;s</span>
<span class="s">  CSRF mechanism&lt;/a&gt; has not been used correctly.  For POST forms, you need to</span>
<span class="s">  ensure:&lt;/p&gt;</span>

<span class="s">  &lt;ul&gt;</span>
<span class="s">    &lt;li&gt;Your browser is accepting cookies.&lt;/li&gt;</span>

<span class="s">    &lt;li&gt;The view function uses &lt;a</span>
<span class="s">    href=&#39;http://docs.djangoproject.com/en/dev/ref/templates/api/#subclassing-context-requestcontext&#39;&gt;&lt;code&gt;RequestContext&lt;/code&gt;&lt;/a&gt;</span>
<span class="s">    for the template, instead of &lt;code&gt;Context&lt;/code&gt;.&lt;/li&gt;</span>

<span class="s">    &lt;li&gt;In the template, there is a &lt;code&gt;{% templatetag openblock %} csrf_token</span>
<span class="s">    {% templatetag closeblock %}&lt;/code&gt; template tag inside each POST form that</span>
<span class="s">    targets an internal URL.&lt;/li&gt;</span>

<span class="s">    &lt;li&gt;If you are not using &lt;code&gt;CsrfViewMiddleware&lt;/code&gt;, then you must use</span>
<span class="s">    &lt;code&gt;csrf_protect&lt;/code&gt; on any views that use the &lt;code&gt;csrf_token&lt;/code&gt;</span>
<span class="s">    template tag, as well as those that accept the POST data.&lt;/li&gt;</span>

<span class="s">  &lt;/ul&gt;</span>

<span class="s">  &lt;p&gt;You&#39;re seeing the help section of this page because you have &lt;code&gt;DEBUG =</span>
<span class="s">  True&lt;/code&gt; in your Django settings file. Change that to &lt;code&gt;False&lt;/code&gt;,</span>
<span class="s">  and only the initial error message will be displayed.  &lt;/p&gt;</span>

<span class="s">  &lt;p&gt;You can customize this page using the CSRF_FAILURE_VIEW setting.&lt;/p&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">{</span><span class="si">% e</span><span class="s">lse %}</span>
<span class="s">&lt;div id=&quot;explanation&quot;&gt;</span>
<span class="s">  &lt;p&gt;&lt;small&gt;More information is available with DEBUG=True.&lt;/small&gt;&lt;/p&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">{</span><span class="si">% e</span><span class="s">ndif %}</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">csrf_failure</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Default view used when request fails CSRF protection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">django.middleware.csrf</span> <span class="kn">import</span> <span class="n">REASON_NO_REFERER</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">CSRF_FAILURE_TEMPLATE</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span>
                 <span class="s">&#39;reason&#39;</span><span class="p">:</span> <span class="n">reason</span><span class="p">,</span>
                 <span class="s">&#39;no_referer&#39;</span><span class="p">:</span> <span class="n">reason</span> <span class="o">==</span> <span class="n">REASON_NO_REFERER</span>
                 <span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponseForbidden</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;text/html&#39;</span><span class="p">)</span>

</pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>info { background:#f6f6f6; }
info ul { margin: 0.5em 4em; }
info p, #summary p { padding-top:10px; }
summary { background: #ffc; }
explanation { background:#eee; border-bottom: 0px none; }</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/django",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
